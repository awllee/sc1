<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Profiling - SC1</title>
    <meta property="og:title" content="Profiling - SC1">
    
    <meta name="twitter:card" content="summary">

    
      
    

    
      
      <meta property="description" content="Profiling in R is fairly straightforward using the profvis package, which builds upon base R’s Rprof functionality.
library(profvis) This is a statistical profiler: it operates by regularly (e.g. &amp;hellip;">
      <meta property="og:description" content="Profiling in R is fairly straightforward using the profvis package, which builds upon base R’s Rprof functionality.
library(profvis) This is a statistical profiler: it operates by regularly (e.g. &amp;hellip;">
      
    

    
    

    

    
    


<link href='//cdn.bootcss.com/highlight.js/9.12.0/styles/github.min.css' rel='stylesheet' type='text/css' />



    <link rel="stylesheet" href="/sc1/css/style.css" />
    <link rel="stylesheet" href="/sc1/css/fonts.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Arvo">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Marcellus">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro">

<link rel="stylesheet" href="/sc1/css/custom.css" />

<link rel="icon" href="/sc1/favicon.ico" type="image/x-icon" />























<nav class="breadcrumbs">
    
        <a href="https://awllee.github.io/sc1/">home / </a>
    
        <a href="https://awllee.github.io/sc1/profile-debug/">profile-debug / </a>
    
        <a href="https://awllee.github.io/sc1/profile-debug/profile/">profile / </a>
    
</nav>

  </head>

  
  <body class="sc1">
    <header class="masthead">
      <h1><a href="/sc1/">SC1</a></h1>

<p class="tagline">Statistical Computing 1</p>

      <nav class="menu">
  <input id="menu-check" type="checkbox" />
  <label id="menu-label" for="menu-check" class="unselectable">
    <span class="icon close-icon">✕</span>
    <span class="icon open-icon">☰</span>
    <span class="text">Menu</span>
  </label>
  <ul>
  
  
  <li><a href="/sc1/">Home</a></li>
  
  <li><a href="/sc1/intro-r/">Intro to R</a></li>
  
  <li><a href="/sc1/reproducibility/">Reproducibility</a></li>
  
  <li><a href="/sc1/common-r/">Common R</a></li>
  
  <li><a href="/sc1/tidyverse/">Tidyverse</a></li>
  
  <li><a href="/sc1/packages/">Packages</a></li>
  
  <li><a href="/sc1/functional-oo/">Functional / OO</a></li>
  
  <li><a href="/sc1/profile-debug/">Performance / Bugs</a></li>
  
  <li><a href="/sc1/matrices/">Matrices</a></li>
  
  <li><a href="/sc1/optimization/">Optimization</a></li>
  
  <li><a href="/sc1/integration/">Integration</a></li>
  
  
  </ul>
</nav>

    </header>

    <article class="main">
      <header class="title">
      
<h1>Profiling</h1>

<h3>
</h3>
<hr>


      </header>




<link href="/sc1/rmarkdown-libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="/sc1/rmarkdown-libs/anchor-sections/anchor-sections.js"></script>
<script src="/sc1/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/sc1/rmarkdown-libs/jquery/jquery.min.js"></script>
<script src="/sc1/rmarkdown-libs/d3/d3.min.js"></script>
<link href="/sc1/rmarkdown-libs/profvis/profvis.css" rel="stylesheet" />
<script src="/sc1/rmarkdown-libs/profvis/profvis.js"></script>
<script src="/sc1/rmarkdown-libs/profvis/scroll.js"></script>
<link href="/sc1/rmarkdown-libs/highlight/textmate.css" rel="stylesheet" />
<script src="/sc1/rmarkdown-libs/highlight/highlight.js"></script>
<script src="/sc1/rmarkdown-libs/profvis-binding/profvis.js"></script>

<div id="TOC">
<ul>
<li><a href="#updating-a-list-of-primes">Updating a list of primes</a></li>
<li><a href="#the-sieve-of-eratosthenes">The Sieve of Eratosthenes</a></li>
<li><a href="#comments">Comments</a></li>
</ul>
</div>

<p><a href="https://en.wikipedia.org/wiki/Profiling_(computer_programming)">Profiling</a> in R is fairly straightforward using the <a href="https://rstudio.github.io/profvis/"><code>profvis</code></a> package, which builds upon base R’s <code>Rprof</code> functionality.</p>
<pre class="r"><code>library(profvis)</code></pre>
<p>This is a <em>statistical profiler</em>: it operates by regularly (e.g. every few milliseconds) using operating system interrupts to determine what code is being executed. This enables one to build a picture of where the computation is spending most of its time, and is essentially an application of the Monte Carlo method. Although the results are not deterministic, the profiling operation adds very little overhead to the computation.</p>
<p>Statistical profilers can be viewed in contrast to <em>instrumenting profilers</em> of various flavours, which often involve incrementing counters whenever certain events occur. This often involves instrumenting existing code by adding instructions to increment the counters either manually or automatically. For example, incrementing a counter whenever a function is called. Instrumenting profilers can provide very accurate results, but can add substantial overhead to the computation. These tools can be important not only for understanding performance, but also for checking the validity and robustness of code: for example, <a href="https://en.wikipedia.org/wiki/Valgrind">Valgrind</a> is often used in C code to detect memory leaks and memory reference errors.</p>
<p>We consider here profiling various R functions for generating an array of all primes less than or equal to some number.</p>
<div id="updating-a-list-of-primes" class="section level2">
<h2>Updating a list of primes</h2>
<p>A straightforward approach to generating all prime numbers less than some number <span class="math inline">\(N\)</span> is to iterate through the numbers <span class="math inline">\(3,\ldots,N\)</span> and add the current number to the list of primes if there is no divisor of that number in the current list of primes.</p>
<p>In the following, we profile 3 variants of this approach. The first variant is a very inefficient implementation.</p>
<pre class="r"><code>source(&quot;generate-primes-1.R&quot;, keep.source=TRUE)
profvis(generate.primes.upto.1(10000))</code></pre>
<div id="htmlwidget-1" style="width:100%;height:600px;" class="profvis html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"message":{"prof":{"time":[1,2,3,3,3,3,3,4,4,4,4,4,4,5,6,7,8,8,8,8,8,9,10,10,10,10,10,11,11,11,11,11,12,13,13,13,13,13,14,14,15,15,15,15,15,16,16,16,16,16,17,18,18,18,18,18,19,19,19,19,19,20,20,20,20,20,21,21,21,21,21,22,23,24,25,25,25,25,25,25,26,26,26,26,26,27,27,27,27,27,27,28,29,29,29,29,29,29,30,31,31,31,31,31,32,32,32,32,32,33,34,34,34,34,34,35,35,35,35,35,36,36,36,36,36,37,37,37,37,37,38,39,39,39,39,39,40,40,40,40,40,41,41,41,41,41,42,42,42,42,42,42,43,43,43,43,43,44,45,45,45,45,45,46,46,46,46,46,47,48,49,50,50,50,50,50,51,52,52,52,52,52,53,54,54,54,54,54,55,55,55,55,55,55,56,56,56,56,56,57,57,57,57,57,57,58,58,58,58,58,59,59,59,59,59,60,61,61,61,61,61,62,62,62,62,62,63,64,64,64,64,64,65,66,66,66,66,66,67,67,67,67,67,68,68,68,68,68,69,70,70,70,70,70,70,71,72,72,72,72,72,72,73,73,73,73,73,74,74,74,74,74,75,75,75,75,75,76,77,78,78,78,78,78,79,79,79,79,79,80,80,80,80,80,81,81,81,81,81,82,82,82,82,82,83,84,85,85,85,85,85,86,86,87,87,87,87,87,88,88,88,88,88,89,89,89,89,89,90,91,91,91,91,91,91,92,92,93,93,93,93,93,93,94,95,95,95,95,95,96,96,96,96,96,97,97,97,97,97,98,98,98,98,98,99,99,99,99,99,100,101,101,101,101,101,102,102,102,102,102,103,103,103,103,103,104,104,104,104,104,104,105,106,106,106,106,106,106,107,108,109,109,109,109,109,110,111,111,111,111,111,112,112,112,112,112,113,113,113,113,113,114,115,115,115,115,115,116,116,116,116,116,117,118,118,118,118,118,119,120,120,120,120,120,121,122,122,122,122,122,123,123,123,123,123,124,125,125,125,125,125,125,126,127,127,127,127,127,127,128,128,128,128,128,129,130,130,130,130,130,131,131,131,131,131,132,133,133,133,133,133,134,134,134,134,134,134,135,135,135,135,135,136,136,136,136,136],"depth":[1,1,5,4,3,2,1,6,5,4,3,2,1,1,1,1,5,4,3,2,1,1,5,4,3,2,1,5,4,3,2,1,1,5,4,3,2,1,2,1,5,4,3,2,1,5,4,3,2,1,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,1,1,1,6,5,4,3,2,1,5,4,3,2,1,6,5,4,3,2,1,1,6,5,4,3,2,1,1,5,4,3,2,1,5,4,3,2,1,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,6,5,4,3,2,1,5,4,3,2,1,1,5,4,3,2,1,5,4,3,2,1,1,1,1,5,4,3,2,1,1,5,4,3,2,1,1,5,4,3,2,1,6,5,4,3,2,1,5,4,3,2,1,6,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,1,5,4,3,2,1,5,4,3,2,1,1,5,4,3,2,1,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,1,6,5,4,3,2,1,1,6,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,1,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,1,1,5,4,3,2,1,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,6,5,4,3,2,1,1,6,5,4,3,2,1,1,1,5,4,3,2,1,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,1,5,4,3,2,1,5,4,3,2,1,1,5,4,3,2,1,1,5,4,3,2,1,1,5,4,3,2,1,5,4,3,2,1,1,6,5,4,3,2,1,1,6,5,4,3,2,1,5,4,3,2,1,1,5,4,3,2,1,5,4,3,2,1,1,5,4,3,2,1,6,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1],"label":["local","local","if (i %% j == 0) {","eval","eval","eval.parent","local","<GC>","if (i %% j == 0) {","eval","eval","eval.parent","local","local","local","local","if (i %% j == 0) {","eval","eval","eval.parent","local","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","local","local","local","<GC>","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","<GC>","if (i %% j == 0) {","eval","eval","eval.parent","local","local","<GC>","if (i %% j == 0) {","eval","eval","eval.parent","local","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","local","if (i %% j == 0) {","eval","eval","eval.parent","local","for (j in primes) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","<GC>","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","local","local","local","if (i %% j == 0) {","eval","eval","eval.parent","local","local","if (i %% j == 0) {","eval","eval","eval.parent","local","local","if (i %% j == 0) {","eval","eval","eval.parent","local","<GC>","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","<GC>","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","local","if (i %% j == 0) {","eval","eval","eval.parent","local","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","local","<GC>","if (i %% j == 0) {","eval","eval","eval.parent","local","local","<GC>","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","local","local","for (j in primes) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","local","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","local","<GC>","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","local","<GC>","if (i %% j == 0) {","eval","eval","eval.parent","local","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","local","if (i %% j == 0) {","eval","eval","eval.parent","local","for (j in primes) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","<GC>","if (i %% j == 0) {","eval","eval","eval.parent","local","local","<GC>","if (i %% j == 0) {","eval","eval","eval.parent","local","local","local","for (j in primes) {","eval","eval","eval.parent","local","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","local","if (i %% j == 0) {","eval","eval","eval.parent","local","local","if (i %% j == 0) {","eval","eval","eval.parent","local","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","local","<GC>","if (i %% j == 0) {","eval","eval","eval.parent","local","local","<GC>","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","local","if (i %% j == 0) {","eval","eval","eval.parent","local","<GC>","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local"],"filenum":[null,null,1,null,null,null,null,null,1,null,null,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,1,null,1,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,null,null,null,null,1,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,1,null,null,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,null,null,1,null,null,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,null,null,1,null,null,null,null,1,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,null,null,1,null,null,null,null,1,null,null,1,null,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,null,1,null,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,1,null,null,null,null,null,null,1,null,null,null,null,null,null,1,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null],"linenum":[null,null,6,null,null,null,null,null,6,null,null,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,6,null,6,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,6,null,null,null,null,6,null,null,null,null,6,null,null,null,null,null,null,null,null,6,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,6,null,null,null,null,6,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,5,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,6,null,null,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,6,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,6,null,null,null,null,6,null,null,null,null,null,null,6,null,null,null,null,null,null,6,null,null,null,null,6,null,null,null,null,6,null,null,null,null,6,null,null,null,null,null,null,5,null,null,null,null,6,null,null,null,null,6,null,null,null,null,6,null,null,null,null,6,null,null,null,null,null,null,6,null,null,null,null,6,null,6,null,null,null,null,6,null,null,null,null,6,null,null,null,null,null,null,6,null,null,null,null,6,null,null,6,null,null,null,null,null,6,null,null,null,null,6,null,null,null,null,6,null,null,null,null,6,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,5,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,null,6,null,null,null,null,null,null,5,null,null,null,null,null,6,null,null,null,null,6,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,6,null,null,null,null,null,null,6,null,null,null,null,null,null,6,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,6,null,null,null,null,6,null,null,null,null],"memalloc":[10.0452041625977,10.6773223876953,11.5763931274414,11.5763931274414,11.5763931274414,11.5763931274414,11.5763931274414,12.0362548828125,12.0362548828125,12.0362548828125,12.0362548828125,12.0362548828125,12.0362548828125,7.80139923095703,8.53033447265625,7.69597625732422,8.42093658447266,8.42093658447266,8.42093658447266,8.42093658447266,8.42093658447266,7.60736083984375,8.34672546386719,8.34672546386719,8.34672546386719,8.34672546386719,8.34672546386719,7.5284423828125,7.5284423828125,7.5284423828125,7.5284423828125,7.5284423828125,8.26709747314453,7.4525146484375,7.4525146484375,7.4525146484375,7.4525146484375,7.4525146484375,8.18802642822266,8.18802642822266,7.38016510009766,7.38016510009766,7.38016510009766,7.38016510009766,7.38016510009766,8.11320495605469,8.11320495605469,8.11320495605469,8.11320495605469,8.11320495605469,7.30953979492188,8.03568267822266,8.03568267822266,8.03568267822266,8.03568267822266,8.03568267822266,7.22259521484375,7.22259521484375,7.22259521484375,7.22259521484375,7.22259521484375,7.96585083007812,7.96585083007812,7.96585083007812,7.96585083007812,7.96585083007812,7.15559387207031,7.15559387207031,7.15559387207031,7.15559387207031,7.15559387207031,7.90040588378906,7.10164642333984,7.82721710205078,8.73996734619141,8.73996734619141,8.73996734619141,8.73996734619141,8.73996734619141,8.73996734619141,7.75296020507812,7.75296020507812,7.75296020507812,7.75296020507812,7.75296020507812,8.74393463134766,8.74393463134766,8.74393463134766,8.74393463134766,8.74393463134766,8.74393463134766,7.67935943603516,8.74761962890625,8.74761962890625,8.74761962890625,8.74761962890625,8.74761962890625,8.74761962890625,7.59176635742188,8.61974334716797,8.61974334716797,8.61974334716797,8.61974334716797,8.61974334716797,7.46778106689453,7.46778106689453,7.46778106689453,7.46778106689453,7.46778106689453,8.55480194091797,7.38267517089844,7.38267517089844,7.38267517089844,7.38267517089844,7.38267517089844,8.48178100585938,8.48178100585938,8.48178100585938,8.48178100585938,8.48178100585938,7.30181121826172,7.30181121826172,7.30181121826172,7.30181121826172,7.30181121826172,8.38410186767578,8.38410186767578,8.38410186767578,8.38410186767578,8.38410186767578,7.23348236083984,8.34669494628906,8.34669494628906,8.34669494628906,8.34669494628906,8.34669494628906,7.17249298095703,7.17249298095703,7.17249298095703,7.17249298095703,7.17249298095703,8.24859619140625,8.24859619140625,8.24859619140625,8.24859619140625,8.24859619140625,8.76348876953125,8.76348876953125,8.76348876953125,8.76348876953125,8.76348876953125,8.76348876953125,7.59632110595703,7.59632110595703,7.59632110595703,7.59632110595703,7.59632110595703,8.26542663574219,7.41230010986328,7.41230010986328,7.41230010986328,7.41230010986328,7.41230010986328,8.14283752441406,8.14283752441406,8.14283752441406,8.14283752441406,8.14283752441406,7.30815124511719,8.0322265625,7.22690582275391,7.95060729980469,7.95060729980469,7.95060729980469,7.95060729980469,7.95060729980469,7.15626525878906,7.90452575683594,7.90452575683594,7.90452575683594,7.90452575683594,7.90452575683594,7.08925628662109,7.78992462158203,7.78992462158203,7.78992462158203,7.78992462158203,7.78992462158203,8.71251678466797,8.71251678466797,8.71251678466797,8.71251678466797,8.71251678466797,8.71251678466797,7.72858428955078,7.72858428955078,7.72858428955078,7.72858428955078,7.72858428955078,8.73778533935547,8.73778533935547,8.73778533935547,8.73778533935547,8.73778533935547,8.73778533935547,7.65275573730469,7.65275573730469,7.65275573730469,7.65275573730469,7.65275573730469,8.73987579345703,8.73987579345703,8.73987579345703,8.73987579345703,8.73987579345703,7.56561279296875,8.65207672119141,8.65207672119141,8.65207672119141,8.65207672119141,8.65207672119141,7.49240112304688,7.49240112304688,7.49240112304688,7.49240112304688,7.49240112304688,8.56417846679688,7.41698455810547,7.41698455810547,7.41698455810547,7.41698455810547,7.41698455810547,8.4534912109375,7.29537200927734,7.29537200927734,7.29537200927734,7.29537200927734,7.29537200927734,8.36887359619141,8.36887359619141,8.36887359619141,8.36887359619141,8.36887359619141,7.18448638916016,7.18448638916016,7.18448638916016,7.18448638916016,7.18448638916016,8.27245330810547,8.78526306152344,8.78526306152344,8.78526306152344,8.78526306152344,8.78526306152344,8.78526306152344,8.19725799560547,8.80040740966797,8.80040740966797,8.80040740966797,8.80040740966797,8.80040740966797,8.80040740966797,8.08116912841797,8.08116912841797,8.08116912841797,8.08116912841797,8.08116912841797,8.76449584960938,8.76449584960938,8.76449584960938,8.76449584960938,8.76449584960938,7.9925537109375,7.9925537109375,7.9925537109375,7.9925537109375,7.9925537109375,8.70362854003906,7.87149047851562,8.58119964599609,8.58119964599609,8.58119964599609,8.58119964599609,8.58119964599609,7.77365112304688,7.77365112304688,7.77365112304688,7.77365112304688,7.77365112304688,8.47582244873047,8.47582244873047,8.47582244873047,8.47582244873047,8.47582244873047,7.66118621826172,7.66118621826172,7.66118621826172,7.66118621826172,7.66118621826172,8.39192962646484,8.39192962646484,8.39192962646484,8.39192962646484,8.39192962646484,7.54884338378906,8.26392364501953,7.45611572265625,7.45611572265625,7.45611572265625,7.45611572265625,7.45611572265625,8.17812347412109,8.17812347412109,7.24113464355469,7.24113464355469,7.24113464355469,7.24113464355469,7.24113464355469,7.95639801025391,7.95639801025391,7.95639801025391,7.95639801025391,7.95639801025391,7.15212249755859,7.15212249755859,7.15212249755859,7.15212249755859,7.15212249755859,7.87284851074219,8.71672821044922,8.71672821044922,8.71672821044922,8.71672821044922,8.71672821044922,8.71672821044922,7.730712890625,7.730712890625,8.72535705566406,8.72535705566406,8.72535705566406,8.72535705566406,8.72535705566406,8.72535705566406,7.6146240234375,8.67561340332031,8.67561340332031,8.67561340332031,8.67561340332031,8.67561340332031,7.53517150878906,7.53517150878906,7.53517150878906,7.53517150878906,7.53517150878906,8.6082763671875,8.6082763671875,8.6082763671875,8.6082763671875,8.6082763671875,7.41255950927734,7.41255950927734,7.41255950927734,7.41255950927734,7.41255950927734,8.47158050537109,8.47158050537109,8.47158050537109,8.47158050537109,8.47158050537109,7.32701873779297,8.37110137939453,8.37110137939453,8.37110137939453,8.37110137939453,8.37110137939453,7.20081329345703,7.20081329345703,7.20081329345703,7.20081329345703,7.20081329345703,8.27706909179688,8.27706909179688,8.27706909179688,8.27706909179688,8.27706909179688,8.76936340332031,8.76936340332031,8.76936340332031,8.76936340332031,8.76936340332031,8.76936340332031,8.14002990722656,8.79499053955078,8.79499053955078,8.79499053955078,8.79499053955078,8.79499053955078,8.79499053955078,8.04944610595703,8.73849487304688,7.94712829589844,7.94712829589844,7.94712829589844,7.94712829589844,7.94712829589844,8.64543914794922,7.81276702880859,7.81276702880859,7.81276702880859,7.81276702880859,7.81276702880859,8.52959442138672,8.52959442138672,8.52959442138672,8.52959442138672,8.52959442138672,7.73081207275391,7.73081207275391,7.73081207275391,7.73081207275391,7.73081207275391,8.44675445556641,7.60985565185547,7.60985565185547,7.60985565185547,7.60985565185547,7.60985565185547,8.31349945068359,8.31349945068359,8.31349945068359,8.31349945068359,8.31349945068359,7.50358581542969,8.22843170166016,8.22843170166016,8.22843170166016,8.22843170166016,8.22843170166016,7.40624237060547,8.124755859375,8.124755859375,8.124755859375,8.124755859375,8.124755859375,7.30426788330078,8.02850341796875,8.02850341796875,8.02850341796875,8.02850341796875,8.02850341796875,7.226318359375,7.226318359375,7.226318359375,7.226318359375,7.226318359375,7.94255828857422,8.85507965087891,8.85507965087891,8.85507965087891,8.85507965087891,8.85507965087891,8.85507965087891,7.82572174072266,8.84674072265625,8.84674072265625,8.84674072265625,8.84674072265625,8.84674072265625,8.84674072265625,7.73280334472656,7.73280334472656,7.73280334472656,7.73280334472656,7.73280334472656,8.78462982177734,7.61811828613281,7.61811828613281,7.61811828613281,7.61811828613281,7.61811828613281,8.66641998291016,8.66641998291016,8.66641998291016,8.66641998291016,8.66641998291016,7.17448425292969,8.18283081054688,8.18283081054688,8.18283081054688,8.18283081054688,8.18283081054688,8.71846771240234,8.71846771240234,8.71846771240234,8.71846771240234,8.71846771240234,8.71846771240234,8.01721954345703,8.01721954345703,8.01721954345703,8.01721954345703,8.01721954345703,8.70892333984375,8.70892333984375,8.70892333984375,8.70892333984375,8.70892333984375],"meminc":[0,0.632118225097656,0.899070739746094,0,0,0,0,0.459861755371094,0,0,0,0,0,-4.23485565185547,0.728935241699219,-0.834358215332031,0.724960327148438,0,0,0,0,-0.813575744628906,0.739364624023438,0,0,0,0,-0.818283081054688,0,0,0,0,0.738655090332031,-0.814582824707031,0,0,0,0,0.735511779785156,0,-0.807861328125,0,0,0,0,0.733039855957031,0,0,0,0,-0.803665161132812,0.726142883300781,0,0,0,0,-0.813087463378906,0,0,0,0,0.743255615234375,0,0,0,0,-0.810256958007812,0,0,0,0,0.74481201171875,-0.798759460449219,0.725570678710938,0.912750244140625,0,0,0,0,0,-0.987007141113281,0,0,0,0,0.990974426269531,0,0,0,0,0,-1.0645751953125,1.06826019287109,0,0,0,0,0,-1.15585327148438,1.02797698974609,0,0,0,0,-1.15196228027344,0,0,0,0,1.08702087402344,-1.17212677001953,0,0,0,0,1.09910583496094,0,0,0,0,-1.17996978759766,0,0,0,0,1.08229064941406,0,0,0,0,-1.15061950683594,1.11321258544922,0,0,0,0,-1.17420196533203,0,0,0,0,1.07610321044922,0,0,0,0,0.514892578125,0,0,0,0,0,-1.16716766357422,0,0,0,0,0.669105529785156,-0.853126525878906,0,0,0,0,0.730537414550781,0,0,0,0,-0.834686279296875,0.724075317382812,-0.805320739746094,0.723701477050781,0,0,0,0,-0.794342041015625,0.748260498046875,0,0,0,0,-0.815269470214844,0.700668334960938,0,0,0,0,0.922592163085938,0,0,0,0,0,-0.983932495117188,0,0,0,0,1.00920104980469,0,0,0,0,0,-1.08502960205078,0,0,0,0,1.08712005615234,0,0,0,0,-1.17426300048828,1.08646392822266,0,0,0,0,-1.15967559814453,0,0,0,0,1.07177734375,-1.14719390869141,0,0,0,0,1.03650665283203,-1.15811920166016,0,0,0,0,1.07350158691406,0,0,0,0,-1.18438720703125,0,0,0,0,1.08796691894531,0.512809753417969,0,0,0,0,0,-0.588005065917969,0.6031494140625,0,0,0,0,0,-0.71923828125,0,0,0,0,0.683326721191406,0,0,0,0,-0.771942138671875,0,0,0,0,0.711074829101562,-0.832138061523438,0.709709167480469,0,0,0,0,-0.807548522949219,0,0,0,0,0.702171325683594,0,0,0,0,-0.81463623046875,0,0,0,0,0.730743408203125,0,0,0,0,-0.843086242675781,0.715080261230469,-0.807807922363281,0,0,0,0,0.722007751464844,0,-0.936988830566406,0,0,0,0,0.715263366699219,0,0,0,0,-0.804275512695312,0,0,0,0,0.720726013183594,0.843879699707031,0,0,0,0,0,-0.986015319824219,0,0.994644165039062,0,0,0,0,0,-1.11073303222656,1.06098937988281,0,0,0,0,-1.14044189453125,0,0,0,0,1.07310485839844,0,0,0,0,-1.19571685791016,0,0,0,0,1.05902099609375,0,0,0,0,-1.14456176757812,1.04408264160156,0,0,0,0,-1.1702880859375,0,0,0,0,1.07625579833984,0,0,0,0,0.492294311523438,0,0,0,0,0,-0.62933349609375,0.654960632324219,0,0,0,0,0,-0.74554443359375,0.689048767089844,-0.791366577148438,0,0,0,0,0.698310852050781,-0.832672119140625,0,0,0,0,0.716827392578125,0,0,0,0,-0.798782348632812,0,0,0,0,0.7159423828125,-0.836898803710938,0,0,0,0,0.703643798828125,0,0,0,0,-0.809913635253906,0.724845886230469,0,0,0,0,-0.822189331054688,0.718513488769531,0,0,0,0,-0.820487976074219,0.724235534667969,0,0,0,0,-0.80218505859375,0,0,0,0,0.716239929199219,0.912521362304688,0,0,0,0,0,-1.02935791015625,1.02101898193359,0,0,0,0,0,-1.11393737792969,0,0,0,0,1.05182647705078,-1.16651153564453,0,0,0,0,1.04830169677734,0,0,0,0,-1.49193572998047,1.00834655761719,0,0,0,0,0.535636901855469,0,0,0,0,0,-0.701248168945312,0,0,0,0,0.691703796386719,0,0,0,0],"filename":[null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null,"generate-primes-1.R",null,null,null,null]},"interval":10,"files":[{"filename":"generate-primes-1.R","content":"generate.primes.upto.1 <- function(N) {\n  primes <- 2\n  for (i in 3:N) {\n    found.divisor <- FALSE\n    for (j in primes) {\n      if (i %% j == 0) {\n        found.divisor <- TRUE\n      }\n    }\n    if (!found.divisor) primes <- c(primes,i)\n  }\n  return(primes)\n}\n","normpath":"/home/travis/build/awllee/sc1/content/profile-debug/generate-primes-1.R"}],"prof_output":"/tmp/RtmpyITxnf/file44b02490b4c8.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>We see from the <code>profvis</code> results that most of the time is spent in line 6 performing the integer modulus operation. If we look at the code more closely, we can see that it is possible to eliminate some of these operations by breaking the loop over primes as soon as one divisor is found.</p>
<pre class="r"><code>source(&quot;generate-primes-2.R&quot;, keep.source=TRUE)
profvis(generate.primes.upto.2(10000))</code></pre>
<div id="htmlwidget-2" style="width:100%;height:600px;" class="profvis html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"message":{"prof":{"time":[1,1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,4,4,4,4,4,5,5,5,5,5,6,6,6,6,6,7,7,7,7,7,8,8,8,8,8,9,9,9,9,9,9,10,10,10,10,10,11,11,11,11,11,11,12,13,13,13,13,13,14,15,16,16],"depth":[5,4,3,2,1,6,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,6,5,4,3,2,1,5,4,3,2,1,6,5,4,3,2,1,1,5,4,3,2,1,1,1,2,1],"label":["if (i %% j == 0) {","eval","eval","eval.parent","local","<GC>","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","<GC>","if (i %% j == 0) {","eval","eval","eval.parent","local","if (i %% j == 0) {","eval","eval","eval.parent","local","<GC>","if (i %% j == 0) {","eval","eval","eval.parent","local","local","if (i %% j == 0) {","eval","eval","eval.parent","local","local","local","if (i %% j == 0) {","local"],"filenum":[1,null,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,null,1,null],"linenum":[6,null,null,null,null,null,6,null,null,null,null,6,null,null,null,null,6,null,null,null,null,6,null,null,null,null,6,null,null,null,null,6,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,null,6,null],"memalloc":[9.02603149414062,9.02603149414062,9.02603149414062,9.02603149414062,9.02603149414062,9.80774688720703,9.80774688720703,9.80774688720703,9.80774688720703,9.80774688720703,9.80774688720703,9.37226867675781,9.37226867675781,9.37226867675781,9.37226867675781,9.37226867675781,8.05019378662109,8.05019378662109,8.05019378662109,8.05019378662109,8.05019378662109,9.59082794189453,9.59082794189453,9.59082794189453,9.59082794189453,9.59082794189453,8.27586364746094,8.27586364746094,8.27586364746094,8.27586364746094,8.27586364746094,9.81896209716797,9.81896209716797,9.81896209716797,9.81896209716797,9.81896209716797,8.50611114501953,8.50611114501953,8.50611114501953,8.50611114501953,8.50611114501953,9.96807861328125,9.96807861328125,9.96807861328125,9.96807861328125,9.96807861328125,9.96807861328125,8.73072052001953,8.73072052001953,8.73072052001953,8.73072052001953,8.73072052001953,9.96746826171875,9.96746826171875,9.96746826171875,9.96746826171875,9.96746826171875,9.96746826171875,8.94470977783203,8.1734619140625,8.1734619140625,8.1734619140625,8.1734619140625,8.1734619140625,9.21236419677734,8.42755889892578,9.46411895751953,9.46411895751953],"meminc":[0,0,0,0,0,0.781715393066406,0,0,0,0,0,-0.435478210449219,0,0,0,0,-1.32207489013672,0,0,0,0,1.54063415527344,0,0,0,0,-1.31496429443359,0,0,0,0,1.54309844970703,0,0,0,0,-1.31285095214844,0,0,0,0,1.46196746826172,0,0,0,0,0,-1.23735809326172,0,0,0,0,1.23674774169922,0,0,0,0,0,-1.02275848388672,-0.771247863769531,0,0,0,0,1.03890228271484,-0.784805297851562,1.03656005859375,0],"filename":["generate-primes-2.R",null,null,null,null,null,"generate-primes-2.R",null,null,null,null,"generate-primes-2.R",null,null,null,null,"generate-primes-2.R",null,null,null,null,"generate-primes-2.R",null,null,null,null,"generate-primes-2.R",null,null,null,null,"generate-primes-2.R",null,null,null,null,"generate-primes-2.R",null,null,null,null,null,"generate-primes-2.R",null,null,null,null,"generate-primes-2.R",null,null,null,null,null,"generate-primes-2.R",null,null,null,null,null,"generate-primes-2.R",null,null,null,null,null,null,"generate-primes-2.R",null]},"interval":10,"files":[{"filename":"generate-primes-2.R","content":"generate.primes.upto.2 <- function(N) {\n  primes <- 2\n  for (i in 3:N) {\n    found.divisor <- FALSE\n    for (j in primes) {\n      if (i %% j == 0) {\n        found.divisor <- TRUE\n        break\n      }\n    }\n    if (!found.divisor) primes <- c(primes,i)\n  }\n  return(primes)\n}\n","normpath":"/home/travis/build/awllee/sc1/content/profile-debug/generate-primes-2.R"}],"prof_output":"/tmp/RtmpyITxnf/file44b07dcf17be.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>This has dramatically reduced the running time of the algorithm, by a factor of about 10. Although the function is fairly short, we may feel that the code is not easy to read. In particular, the overall idea of the algorithm can be lost in the implementation details. So we can consider the same algorithm, but where we call a helper function called <code>any.divisors</code> instead.</p>
<pre class="r"><code>source(&quot;generate-primes-3.R&quot;, keep.source=TRUE)
profvis(generate.primes.upto.3(10000))</code></pre>
<div id="htmlwidget-3" style="width:100%;height:600px;" class="profvis html-widget"></div>
<script type="application/json" data-for="htmlwidget-3">{"x":{"message":{"prof":{"time":[1,2,3,4,4,4,4,4,4,5,5,5,5,5,5,6,6,6,6,6,6,7,7,7,7,7,7,8,9,9,9,9,9,9,9,10,10,10,10,10,10,11,12,13,13,13,13,13,13,14,14,14,14,14,14,15,16,16,16,16,16,16,16],"depth":[1,1,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,1,7,6,5,4,3,2,1,6,5,4,3,2,1,1,1,6,5,4,3,2,1,6,5,4,3,2,1,1,7,6,5,4,3,2,1],"label":["local","local","local","if (i %% j == 0) {","generate.primes.upto.3","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.3","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.3","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.3","eval","eval","eval.parent","local","local","<GC>","if (i %% j == 0) {","generate.primes.upto.3","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.3","eval","eval","eval.parent","local","local","local","if (i %% j == 0) {","generate.primes.upto.3","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.3","eval","eval","eval.parent","local","local","<GC>","if (i %% j == 0) {","generate.primes.upto.3","eval","eval","eval.parent","local"],"filenum":[null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,null,null,1,null,null,null,null,null],"linenum":[null,null,null,3,null,null,null,null,null,3,null,null,null,null,null,3,null,null,null,null,null,3,null,null,null,null,null,null,null,3,null,null,null,null,null,3,null,null,null,null,null,null,null,3,null,null,null,null,null,3,null,null,null,null,null,null,null,3,null,null,null,null,null],"memalloc":[8.73066711425781,9.36628723144531,8.62102508544922,9.29849243164062,9.29849243164062,9.29849243164062,9.29849243164062,9.29849243164062,9.29849243164062,8.39157867431641,8.39157867431641,8.39157867431641,8.39157867431641,8.39157867431641,8.39157867431641,9.07674407958984,9.07674407958984,9.07674407958984,9.07674407958984,9.07674407958984,9.07674407958984,8.18334197998047,8.18334197998047,8.18334197998047,8.18334197998047,8.18334197998047,8.18334197998047,8.87286376953125,9.79656982421875,9.79656982421875,9.79656982421875,9.79656982421875,9.79656982421875,9.79656982421875,9.79656982421875,8.67103576660156,8.67103576660156,8.67103576660156,8.67103576660156,8.67103576660156,8.67103576660156,9.70447540283203,8.45761108398438,9.49266052246094,9.49266052246094,9.49266052246094,9.49266052246094,9.49266052246094,9.49266052246094,8.25070953369141,8.25070953369141,8.25070953369141,8.25070953369141,8.25070953369141,8.25070953369141,9.29096221923828,9.83214569091797,9.83214569091797,9.83214569091797,9.83214569091797,9.83214569091797,9.83214569091797,9.83214569091797],"meminc":[0,0.6356201171875,-0.745262145996094,0.677467346191406,0,0,0,0,0,-0.906913757324219,0,0,0,0,0,0.685165405273438,0,0,0,0,0,-0.893402099609375,0,0,0,0,0,0.689521789550781,0.9237060546875,0,0,0,0,0,0,-1.12553405761719,0,0,0,0,0,1.03343963623047,-1.24686431884766,1.03504943847656,0,0,0,0,0,-1.24195098876953,0,0,0,0,0,1.04025268554688,0.541183471679688,0,0,0,0,0,0],"filename":[null,null,null,"generate-primes-3.R",null,null,null,null,null,"generate-primes-3.R",null,null,null,null,null,"generate-primes-3.R",null,null,null,null,null,"generate-primes-3.R",null,null,null,null,null,null,null,"generate-primes-3.R",null,null,null,null,null,"generate-primes-3.R",null,null,null,null,null,null,null,"generate-primes-3.R",null,null,null,null,null,"generate-primes-3.R",null,null,null,null,null,null,null,"generate-primes-3.R",null,null,null,null,null]},"interval":10,"files":[{"filename":"generate-primes-3.R","content":"any.divisors <- function(i, ps) {\n  for (j in ps) {\n    if (i %% j == 0) {\n      return(TRUE)\n    }\n  }\n  return(FALSE)\n}\n\ngenerate.primes.upto.3 <- function(N) {\n  primes <- 2\n  for (i in 3:N) {\n    if (!any.divisors(i, primes)) {\n      primes <- c(primes,i)\n    }\n  }\n  return(primes)\n}\n","normpath":"/home/travis/build/awllee/sc1/content/profile-debug/generate-primes-3.R"}],"prof_output":"/tmp/RtmpyITxnf/file44b0525dde49.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>It seems reasonable to say that the third version of the algorithm is easier to understand. Moreover, there is little to no performance penalty.</p>
</div>
<div id="the-sieve-of-eratosthenes" class="section level2">
<h2>The Sieve of Eratosthenes</h2>
<p>A more computationally efficient approach is the <a href="https://en.wikipedia.org/wiki/Sieve_of_Eratosthenes">Sieve of Eratosthenes</a>. In this approach, one does not check whether each number is prime by checking divisors. Instead, one starts with a list of numbers from <span class="math inline">\(1\)</span> to <span class="math inline">\(N\)</span> and successively marks all multiples of each prime, in order, as composite. To identify the next prime after <span class="math inline">\(2\)</span> for marking multiples, one simply needs to find the next number not marked composite.</p>
<p>This approach is so much faster, that we consider finding all primes up to <span class="math inline">\(1000000\)</span> instead of up to <span class="math inline">\(10000\)</span>.</p>
<pre class="r"><code>source(&quot;sieve-1.R&quot;, keep.source=TRUE)
profvis(sieve.1(1000000))</code></pre>
<div id="htmlwidget-4" style="width:100%;height:600px;" class="profvis html-widget"></div>
<script type="application/json" data-for="htmlwidget-4">{"x":{"message":{"prof":{"time":[1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,4,4,4,4,4,5,5,5,5,5,6,6,6,6,6,7,7,7,7,7,8,8,8,8,8,9,9,9,9,9,10,10,10,10,10,11,11,11,11,11,12,12,12,12,12,13,13,13,13,13,14,14,14,14,14,15,15,15,15,15,16,16,16,16,16,17,17,17,17,17,18,18,18,18,18,19,19,19,19,19,20,20,20,20,20,21,21,21,21,21,22,22,22,22,22,23,23,23,23,23,24,24,24,24,24,25,25,25,25,25,26,26,26,26,26,27,27,27,27,27],"depth":[5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1],"label":["candidates[s] <- FALSE","eval","eval","eval.parent","local","while (s <= N) {","eval","eval","eval.parent","local","while (s <= N) {","eval","eval","eval.parent","local","while (s <= N) {","eval","eval","eval.parent","local","candidates[s] <- FALSE","eval","eval","eval.parent","local","while (s <= N) {","eval","eval","eval.parent","local","candidates[s] <- FALSE","eval","eval","eval.parent","local","s <- s + i","eval","eval","eval.parent","local","candidates[s] <- FALSE","eval","eval","eval.parent","local","while (s <= N) {","eval","eval","eval.parent","local","while (s <= N) {","eval","eval","eval.parent","local","while (s <= N) {","eval","eval","eval.parent","local","while (s <= N) {","eval","eval","eval.parent","local","while (s <= N) {","eval","eval","eval.parent","local","s <- s + i","eval","eval","eval.parent","local","candidates[s] <- FALSE","eval","eval","eval.parent","local","s <- s + i","eval","eval","eval.parent","local","candidates[s] <- FALSE","eval","eval","eval.parent","local","s <- s + i","eval","eval","eval.parent","local","while (s <= N) {","eval","eval","eval.parent","local","candidates[s] <- FALSE","eval","eval","eval.parent","local","while (s <= N) {","eval","eval","eval.parent","local","candidates[s] <- FALSE","eval","eval","eval.parent","local","while (s <= N) {","eval","eval","eval.parent","local","if (candidates[i]) {","eval","eval","eval.parent","local","s <- i*2","eval","eval","eval.parent","local","if (candidates[i]) {","eval","eval","eval.parent","local"],"filenum":[1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null],"linenum":[9,null,null,null,null,8,null,null,null,null,8,null,null,null,null,8,null,null,null,null,9,null,null,null,null,8,null,null,null,null,9,null,null,null,null,10,null,null,null,null,9,null,null,null,null,8,null,null,null,null,8,null,null,null,null,8,null,null,null,null,8,null,null,null,null,8,null,null,null,null,10,null,null,null,null,9,null,null,null,null,10,null,null,null,null,9,null,null,null,null,10,null,null,null,null,8,null,null,null,null,9,null,null,null,null,8,null,null,null,null,9,null,null,null,null,8,null,null,null,null,5,null,null,null,null,7,null,null,null,null,5,null,null,null,null],"memalloc":[12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305,12.0676193237305],"meminc":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"filename":["sieve-1.R",null,null,null,null,"sieve-1.R",null,null,null,null,"sieve-1.R",null,null,null,null,"sieve-1.R",null,null,null,null,"sieve-1.R",null,null,null,null,"sieve-1.R",null,null,null,null,"sieve-1.R",null,null,null,null,"sieve-1.R",null,null,null,null,"sieve-1.R",null,null,null,null,"sieve-1.R",null,null,null,null,"sieve-1.R",null,null,null,null,"sieve-1.R",null,null,null,null,"sieve-1.R",null,null,null,null,"sieve-1.R",null,null,null,null,"sieve-1.R",null,null,null,null,"sieve-1.R",null,null,null,null,"sieve-1.R",null,null,null,null,"sieve-1.R",null,null,null,null,"sieve-1.R",null,null,null,null,"sieve-1.R",null,null,null,null,"sieve-1.R",null,null,null,null,"sieve-1.R",null,null,null,null,"sieve-1.R",null,null,null,null,"sieve-1.R",null,null,null,null,"sieve-1.R",null,null,null,null,"sieve-1.R",null,null,null,null,"sieve-1.R",null,null,null,null]},"interval":10,"files":[{"filename":"sieve-1.R","content":"sieve.1 <- function(N) {\n  candidates <- rep(TRUE,N)\n  candidates[1] <- FALSE\n  for (i in 2:N) {\n    if (candidates[i]) {\n      # i is prime\n      s <- i*2\n      while (s <= N) {\n        candidates[s] <- FALSE\n        s <- s + i\n      }\n    }\n  }\n  return((1:N)[candidates])\n}\n","normpath":"/home/travis/build/awllee/sc1/content/profile-debug/sieve-1.R"}],"prof_output":"/tmp/RtmpyITxnf/file44b03af899fb.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>We see that most of the time is spent in lines 8–10, which correspond to marking <code>s</code> as composite and incrementing <code>s</code> by the current prime. We can remove some of these computations by noticing that if <span class="math inline">\(i\)</span> is prime then all multiples <span class="math inline">\(2i,3i,\ldots,(i-1)i\)</span> will already have been marked as composite. It follows that one can also stop “sieving” as soon as <span class="math inline">\(i &gt; \sqrt{N}\)</span>.</p>
<pre class="r"><code>source(&quot;sieve-2.R&quot;, keep.source=TRUE)
profvis(sieve.2(1000000))</code></pre>
<div id="htmlwidget-5" style="width:100%;height:600px;" class="profvis html-widget"></div>
<script type="application/json" data-for="htmlwidget-5">{"x":{"message":{"prof":{"time":[1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,4,4,4,4,4,5,5,5,5,5,6,6,6,6,6,7,7,7,7,7,8,8,8,8,8,9,9,9,9,9,10,10,10,10,10,11,11,11,11,11,12,12,12,12,12,13,13,13,13,13,14,14,14,14,14,15,15,15,15,15,16,16,16,16,16],"depth":[5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1],"label":["s <- s + i","eval","eval","eval.parent","local","candidates[s] <- FALSE","eval","eval","eval.parent","local","while (s <= N) {","eval","eval","eval.parent","local","while (s <= N) {","eval","eval","eval.parent","local","s <- s + i","eval","eval","eval.parent","local","candidates[s] <- FALSE","eval","eval","eval.parent","local","while (s <= N) {","eval","eval","eval.parent","local","while (s <= N) {","eval","eval","eval.parent","local","candidates[s] <- FALSE","eval","eval","eval.parent","local","candidates[s] <- FALSE","eval","eval","eval.parent","local","s <- s + i","eval","eval","eval.parent","local","candidates[s] <- FALSE","eval","eval","eval.parent","local","while (s <= N) {","eval","eval","eval.parent","local","s <- s + i","eval","eval","eval.parent","local","while (s <= N) {","eval","eval","eval.parent","local","while (s <= N) {","eval","eval","eval.parent","local"],"filenum":[1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null],"linenum":[11,null,null,null,null,10,null,null,null,null,9,null,null,null,null,9,null,null,null,null,11,null,null,null,null,10,null,null,null,null,9,null,null,null,null,9,null,null,null,null,10,null,null,null,null,10,null,null,null,null,11,null,null,null,null,10,null,null,null,null,9,null,null,null,null,11,null,null,null,null,9,null,null,null,null,9,null,null,null,null],"memalloc":[12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414,12.0812759399414],"meminc":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"filename":["sieve-2.R",null,null,null,null,"sieve-2.R",null,null,null,null,"sieve-2.R",null,null,null,null,"sieve-2.R",null,null,null,null,"sieve-2.R",null,null,null,null,"sieve-2.R",null,null,null,null,"sieve-2.R",null,null,null,null,"sieve-2.R",null,null,null,null,"sieve-2.R",null,null,null,null,"sieve-2.R",null,null,null,null,"sieve-2.R",null,null,null,null,"sieve-2.R",null,null,null,null,"sieve-2.R",null,null,null,null,"sieve-2.R",null,null,null,null,"sieve-2.R",null,null,null,null,"sieve-2.R",null,null,null,null]},"interval":10,"files":[{"filename":"sieve-2.R","content":"sieve.2 <- function(N) {\n  candidates <- rep(TRUE,N)\n  candidates[1] <- FALSE\n  sqrt.N <- sqrt(N)\n  for (i in 2:sqrt.N) {\n    if (candidates[i]) {\n      # i is prime\n      s <- i*i\n      while (s <= N) {\n        candidates[s] <- FALSE\n        s <- s + i\n      }\n    }\n  }\n  return((1:N)[candidates])\n}\n","normpath":"/home/travis/build/awllee/sc1/content/profile-debug/sieve-2.R"}],"prof_output":"/tmp/RtmpyITxnf/file44b018c63398.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>There appears to be a moderate improvement in performance for this size of problem. We notice that a substantial amount of time is spent in the <code>while</code> loop, which mainly involves incrementing <code>s</code> and flagging the corresponding number as composite. We can vectorize this computation and separate it cleanly from the rest of the algorithm, as follows.</p>
<pre class="r"><code>source(&quot;sieve-3.R&quot;, keep.source=TRUE)
profvis(sieve.3(1000000))</code></pre>
<div id="htmlwidget-6" style="width:100%;height:600px;" class="profvis html-widget"></div>
<script type="application/json" data-for="htmlwidget-6">{"x":{"message":{"prof":{"time":[1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,4,4,4,4,4,5,5,5,5,5,5,5,6,6,6,6,6],"depth":[7,6,5,4,3,2,1,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,5,4,3,2,1,5,4,3,2,1,7,6,5,4,3,2,1,5,4,3,2,1],"label":["seq.default","get.multiples","sieve.3","eval","eval","eval.parent","local","constantFold","cmp","h","tryInline","cmpCall","cmp","h","tryInline","cmpCall","cmp","genCode","cmpfun","compiler:::tryCmpfun","eval","eval","eval.parent","local","candidates[multiples] <- FALSE","eval","eval","eval.parent","local","candidates[multiples] <- FALSE","eval","eval","eval.parent","local","seq.default","get.multiples","sieve.3","eval","eval","eval.parent","local","candidates[multiples] <- FALSE","eval","eval","eval.parent","local"],"filenum":[null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,1,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null],"linenum":[null,14,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,14,null,null,null,null,15,null,null,null,null,15,null,null,null,null,null,14,null,null,null,null,null,15,null,null,null,null],"memalloc":[21.6551513671875,21.6551513671875,21.6551513671875,21.6551513671875,21.6551513671875,21.6551513671875,21.6551513671875,23.6602478027344,23.6602478027344,23.6602478027344,23.6602478027344,23.6602478027344,23.6602478027344,23.6602478027344,23.6602478027344,23.6602478027344,23.6602478027344,23.6602478027344,23.6602478027344,23.6602478027344,23.6602478027344,23.6602478027344,23.6602478027344,23.6602478027344,35.1559906005859,35.1559906005859,35.1559906005859,35.1559906005859,35.1559906005859,43.0304794311523,43.0304794311523,43.0304794311523,43.0304794311523,43.0304794311523,54.13671875,54.13671875,54.13671875,54.13671875,54.13671875,54.13671875,54.13671875,59.9920501708984,59.9920501708984,59.9920501708984,59.9920501708984,59.9920501708984],"meminc":[0,0,0,0,0,0,0,2.00509643554688,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,11.4957427978516,0,0,0,0,7.87448883056641,0,0,0,0,11.1062393188477,0,0,0,0,0,0,5.85533142089844,0,0,0,0],"filename":[null,"sieve-3.R",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"sieve-3.R",null,null,null,null,"sieve-3.R",null,null,null,null,"sieve-3.R",null,null,null,null,null,"sieve-3.R",null,null,null,null,null,"sieve-3.R",null,null,null,null]},"interval":10,"files":[{"filename":"sieve-3.R","content":"get.multiples <- function(i, N) {\n  n <- floor(N/i) - i\n  if (n <= 0) return(NULL)\n  multiples <- seq(i*i,(i+n)*i,i)\n  return(multiples)\n}\n\nsieve.3 <- function(N) {\n  candidates <- rep(TRUE,N)\n  candidates[1] <- FALSE\n  sqrt.N <- sqrt(N)\n  for (i in 2:sqrt.N) {\n    if (candidates[i]) {\n      multiples <- get.multiples(i, N)\n      candidates[multiples] <- FALSE\n    }\n  }\n  return((1:N)[candidates])\n}\n","normpath":"/home/travis/build/awllee/sc1/content/profile-debug/sieve-3.R"}],"prof_output":"/tmp/RtmpyITxnf/file44b01996eb47.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>This gives another improvement to performance. It is worth noting that creating an array of multiples is faster than iterating through multiples in R, because the cost of allocating memory is negligible in comparison to the benefit of eliminating the loop. In a programming language such as C, the reverse is often true, as allocating memory is typically expensive in comparison to iteration once compiled into machine code.</p>
</div>
<div id="comments" class="section level2">
<h2>Comments</h2>
<p>Profiling in this scenario is already quite useful, as one can see which parts of the code are critical for performance. In larger applications, profiling is even more useful as one can quickly determine which functions are the most important from a performance perspective: if 1% of computation time is spent in a particular function, very little improvement can be derived by improving it, whereas if 99% of computation time is spent in a function one can conceivably improve performance very substantially by accelerating the implementation or improving the corresponding algorithm itself.</p>
<p>Profiling is also helpful for maintaining code readability and modularity: in some cases performance can be improved by sacrificing readability, or modularity of the code. Doing so can make sense if the code is critical to performance, but it makes little sense when the code is unimportant from a performance perspective.</p>
<p>Finally, when profiling code and trying to improve its performance, good testing tools are very useful for ensuring that any improvement in performance has not come at the cost of breaking existing functionality, including in rare, corner cases.</p>
</div>


  <footer>
  

<script src="//yihui.name/js/math-code.js"></script>
<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<script async src="//yihui.name/js/center-img.js"></script>


<script type="text/javascript">
var sc_project=12110974;
var sc_invisible=1;
var sc_security="9b171880";
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="https://statcounter.com/" target="_blank"><img
class="statcounter"
src="https://c.statcounter.com/12110974/0/9b171880/1/"
alt="Web Analytics"></a></div></noscript>








  


<p align=right>

<a href='https://github.com/awllee/sc1/blob/master/content/profile-debug/profile.Rmd'>View source</a>

|

<a href='https://github.com/awllee/sc1/edit/master/content/profile-debug/profile.Rmd'>Edit source</a>

</p>





<script src="https://utteranc.es/client.js"
        repo="awllee/sc1"
        issue-term="pathname"
        label="utterance"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>



  



<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>



<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/tex.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



  
  <hr>
  <div class="copyright">© 2020 <a href="https://sites.google.com/view/anthonylee">Anthony Lee</a>, <a href="http://www.bristol.ac.uk/maths/people/feng-yu/index.html">Feng Yu</a>, <a href="https://people.maths.bris.ac.uk/~tk18582/">Tobias Kley</a>, <a href="https://mfasiolo.github.io/">Matteo Fasiolo</a></div>
  
  </footer>
  </article>
  
  </body>
</html>

