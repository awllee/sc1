<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Profiling - SC1</title>
    <meta property="og:title" content="Profiling - SC1">
    
    <meta name="twitter:card" content="summary">

    
      
    

    
      
      <meta property="description" content="Profiling in R is fairly straightforward using the profvis package, which builds upon base R’s Rprof functionality.
library(profvis) This is a statistical profiler: it operates by regularly (e.g. &amp;hellip;">
      <meta property="og:description" content="Profiling in R is fairly straightforward using the profvis package, which builds upon base R’s Rprof functionality.
library(profvis) This is a statistical profiler: it operates by regularly (e.g. &amp;hellip;">
      
    

    
    

    

    
    


<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.12.0/build/styles/github.min.css">



    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Arvo">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Marcellus">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro">

<link rel="stylesheet" href="/sc1/css/style.css" />
<link rel="stylesheet" href="/sc1/css/fonts.css" />
<link rel="stylesheet" href="/sc1/css/custom.css" />

<link rel="icon" href="/sc1/favicon.ico" type="image/x-icon" />























<nav class="breadcrumbs">
    
        <a href="https://awllee.github.io/sc1/">home / </a>
    
        <a href="https://awllee.github.io/sc1/profile-debug/">profile-debug / </a>
    
        <a href="https://awllee.github.io/sc1/profile-debug/profile/">profile / </a>
    
</nav>

  </head>

  
  <body class="sc1">
    <header class="masthead">
      <h1><a href="/">SC1</a></h1>

<p class="tagline">Statistical Computing 1</p>

      <nav class="menu">
  <input id="menu-check" type="checkbox" hidden/>
  <label id="menu-label" for="menu-check" class="unselectable" hidden>
    <span class="icon close-icon">✕</span>
    <span class="icon open-icon">☰</span>
    <span class="text">Menu</span>
  </label>
  <ul>
  
  
  <li><a href="/sc1/">Home</a></li>
  
  <li><a href="/sc1/intro-r/">Intro to R</a></li>
  
  <li><a href="/sc1/reproducibility/">Reproducibility</a></li>
  
  <li><a href="/sc1/packages/">Packages</a></li>
  
  <li><a href="/sc1/common-r/">Common R</a></li>
  
  <li><a href="/sc1/functional-oo/">Functional / OO</a></li>
  
  <li><a href="/sc1/tidyverse/">Tidyverse</a></li>
  
  <li><a href="/sc1/profile-debug/">Performance / Bugs</a></li>
  
  <li><a href="/sc1/integration/">Integration</a></li>
  
  <li><a href="/sc1/matrices/">Matrices</a></li>
  
  <li><a href="/sc1/optimization/">Optimization</a></li>
  
  
  </ul>
</nav>

    </header>

    <article class="main">
      <header class="title">
      
<h1>Profiling</h1>

<h3>
</h3>
<hr>


      </header>






<script src="/sc1/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/sc1/rmarkdown-libs/jquery/jquery.min.js"></script>
<script src="/sc1/rmarkdown-libs/d3/d3.min.js"></script>
<link href="/sc1/rmarkdown-libs/profvis/profvis.css" rel="stylesheet" />
<script src="/sc1/rmarkdown-libs/profvis/profvis.js"></script>
<script src="/sc1/rmarkdown-libs/profvis/scroll.js"></script>
<link href="/sc1/rmarkdown-libs/highlight/textmate.css" rel="stylesheet" />
<script src="/sc1/rmarkdown-libs/highlight/highlight.js"></script>
<script src="/sc1/rmarkdown-libs/profvis-binding/profvis.js"></script>

<div id="TOC">
<ul>
<li><a href="#updating-a-list-of-primes" id="toc-updating-a-list-of-primes">Updating a list of primes</a></li>
<li><a href="#the-sieve-of-eratosthenes" id="toc-the-sieve-of-eratosthenes">The Sieve of Eratosthenes</a></li>
<li><a href="#comments" id="toc-comments">Comments</a></li>
</ul>
</div>

<p><a href="https://en.wikipedia.org/wiki/Profiling_(computer_programming)">Profiling</a> in R is fairly straightforward using the <a href="https://rstudio.github.io/profvis/"><code>profvis</code></a> package, which builds upon base R’s <code>Rprof</code> functionality.</p>
<pre class="r"><code>library(profvis)</code></pre>
<p>This is a <em>statistical profiler</em>: it operates by regularly (e.g. every few milliseconds) using operating system interrupts to determine what code is being executed. This enables one to build a picture of where the computation is spending most of its time, and is essentially an application of the Monte Carlo method. Although the results are not deterministic, the profiling operation adds very little overhead to the computation.</p>
<p>Statistical profilers can be viewed in contrast to <em>instrumenting profilers</em> of various flavours, which often involve incrementing counters whenever certain events occur. This often involves instrumenting existing code by adding instructions to increment the counters either manually or automatically. For example, incrementing a counter whenever a function is called. Instrumenting profilers can provide very accurate results, but can add substantial overhead to the computation. These tools can be important not only for understanding performance, but also for checking the validity and robustness of code: for example, <a href="https://en.wikipedia.org/wiki/Valgrind">Valgrind</a> is often used in C code to detect memory leaks and memory reference errors.</p>
<p>We consider here profiling various R functions for generating an array of all primes less than or equal to some number.</p>
<div id="updating-a-list-of-primes" class="section level2">
<h2>Updating a list of primes</h2>
<p>A straightforward approach to generating all prime numbers less than some number <span class="math inline">\(N\)</span> is to iterate through the numbers <span class="math inline">\(3,\ldots,N\)</span> and add the current number to the list of primes if there is no divisor of that number in the current list of primes.</p>
<p>In the following, we profile 3 variants of this approach. The first variant is a very inefficient implementation.</p>
<pre class="r"><code>source(&quot;generate-primes-1.R&quot;, keep.source=TRUE)
profvis(generate.primes.upto.1(10000))</code></pre>
<div class="profvis html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-1" style="width:100%;height:600px;"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"message":{"prof":{"time":[1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,14,14,15,15,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,30,30,31,31,32,32,33,33,33,34,34,35,35,36,36,37,37,38,38,39,39,40,40,41,41,41,42,42,43,43,44,44,45,45,46,46,47,47,47,48,48,49,49,50,50,51,51,52,52,53,53,54,54,55,55,55,56,56,57,57,58,58,59,59,60,60,61,61,62,62,63,63,63,64,64,65,65,66,66,66,67,67,68,68,69,69,70,70,71,71,72,72,73,73,74,74,74,75,75,76,76,77,77,78,78,79,79,80,80,81,81,82,82,83,83,84,84,85,85,86,86,87,87,88,88,89,89,90,90,91,91,92,92,93,93,94,94,95,95,96,96,97,97,98,98,99,99,100,100,100,101,101,102,102,103,103,104,104,105,105,106,106,107,107,108,108,109,109,110,110,111,111,112,112,113,113,114,114,115,115,116,116,117,117,117,118,118,119,119,120,120,121,121,122,122,123,123,124,124,125,125,125,126,126,127,127],"depth":[2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,3,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,3,2,1,2,1,2,1,2,1,2,1,2,1,3,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,3,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,3,2,1,2,1,2,1,3,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,3,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,3,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,3,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,3,2,1,2,1,2,1],"label":["if (i %% j == 0) {","generate.primes.upto.1","%%","local","if (i %% j == 0) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","%%","local","if (i %% j == 0) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","%%","local","if (i %% j == 0) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","%%","local","%%","local","%%","local","for (j in primes) {","generate.primes.upto.1","%%","local","if (i %% j == 0) {","generate.primes.upto.1","%%","local","%%","local","%%","local","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","c","local","for (j in primes) {","generate.primes.upto.1","<GC>","if (i %% j == 0) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","for (j in primes) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","%%","local","if (i %% j == 0) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","%%","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","%%","local","if (i %% j == 0) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","%%","local","%%","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","%%","local","%%","local","for (j in primes) {","generate.primes.upto.1","%%","local","if (i %% j == 0) {","generate.primes.upto.1","%%","local","%%","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","%%","local","%%","local","%%","local","for (j in primes) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","<GC>","if (i %% j == 0) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","<GC>","if (i %% j == 0) {","generate.primes.upto.1","for (j in primes) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","for (j in primes) {","generate.primes.upto.1","<GC>","if (i %% j == 0) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","for (j in primes) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","%%","local","%%","local","%%","local","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","%%","local","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","%%","local","%%","local","for (j in primes) {","generate.primes.upto.1","if (i %% j == 0) {","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","%%","local","for (j in primes) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","%%","local","if (i %% j == 0) {","generate.primes.upto.1","%%","local","if (i %% j == 0) {","generate.primes.upto.1","<GC>","if (i %% j == 0) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","%%","local","if (i %% j == 0) {","generate.primes.upto.1","if (i %% j == 0) {","generate.primes.upto.1","for (j in primes) {","generate.primes.upto.1","%%","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","for (j in primes) {","generate.primes.upto.1","%%","local"],"filenum":[1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,null,1,null,1,null,1,null,1,null,1,null,1,null,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,null,1,null,1,null,1,null,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,null,1,null,1,null,1,null],"linenum":[6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,5,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,10,null,5,null,null,6,null,6,null,5,null,6,null,6,null,6,null,6,null,6,null,null,6,null,6,null,6,null,6,null,6,null,6,null,null,6,null,6,null,6,null,5,null,6,null,6,null,6,null,6,null,null,6,null,6,null,6,null,6,null,6,null,6,null,5,null,6,null,null,6,null,6,null,6,null,null,6,null,5,null,6,null,6,null,6,null,6,null,6,null,5,null,null,6,null,6,null,6,null,6,null,5,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,5,null,6,6,null,6,null,6,null,6,null,6,null,5,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,6,null,null,6,null,6,null,6,null,6,null,6,null,6,null,5,null,6,null,null,6,null,5,null,6,null],"memalloc":[9.932998657226562,9.932998657226562,10.49064636230469,10.49064636230469,11.19713592529297,11.19713592529297,9.205116271972656,9.205116271972656,10.31897735595703,10.31897735595703,11.03956604003906,11.03956604003906,9.611518859863281,9.611518859863281,10.35420989990234,10.35420989990234,8.990394592285156,8.990394592285156,9.736244201660156,9.736244201660156,10.83707427978516,10.83707427978516,9.107795715332031,9.107795715332031,10.23246765136719,10.23246765136719,10.96464538574219,10.96464538574219,9.589263916015625,9.589263916015625,10.31503295898438,10.31503295898438,8.973770141601562,8.973770141601562,9.715545654296875,9.715545654296875,10.81763458251953,10.81763458251953,9.079551696777344,9.079551696777344,10.19412994384766,10.19412994384766,10.919189453125,10.919189453125,9.562850952148438,9.562850952148438,10.28966522216797,10.28966522216797,8.930526733398438,8.930526733398438,9.653762817382812,9.653762817382812,10.75923156738281,10.75923156738281,9.037193298339844,9.037193298339844,10.12129974365234,10.12129974365234,10.85327911376953,10.85327911376953,9.489524841308594,9.489524841308594,10.22292327880859,10.22292327880859,11.17294311523438,11.17294311523438,11.17294311523438,9.568916320800781,9.568916320800781,10.67176055908203,10.67176055908203,8.954299926757812,8.954299926757812,10.05685424804688,10.05685424804688,10.76956176757812,10.76956176757812,9.407318115234375,9.407318115234375,10.13813781738281,10.13813781738281,11.17063140869141,11.17063140869141,11.17063140869141,9.197357177734375,9.197357177734375,10.23251342773438,10.23251342773438,10.88259124755859,10.88259124755859,9.484512329101562,9.484512329101562,10.21949768066406,10.21949768066406,11.13495635986328,11.13495635986328,11.13495635986328,9.604652404785156,9.604652404785156,10.70594787597656,10.70594787597656,8.984107971191406,8.984107971191406,10.07330322265625,10.07330322265625,10.79946136474609,10.79946136474609,9.43701171875,9.43701171875,10.15284729003906,10.15284729003906,11.15695190429688,11.15695190429688,11.15695190429688,9.545570373535156,9.545570373535156,10.62802886962891,10.62802886962891,8.903984069824219,8.903984069824219,10.00106048583984,10.00106048583984,10.71591186523438,10.71591186523438,9.379158020019531,9.379158020019531,10.10970306396484,10.10970306396484,11.16502380371094,11.16502380371094,11.16502380371094,9.490089416503906,9.490089416503906,10.57843780517578,10.57843780517578,11.18775177001953,11.18775177001953,11.18775177001953,9.968025207519531,9.968025207519531,10.67177581787109,10.67177581787109,9.319190979003906,9.319190979003906,10.0472412109375,10.0472412109375,11.13721466064453,11.13721466064453,9.421760559082031,9.421760559082031,10.50972747802734,10.50972747802734,11.16596221923828,11.16596221923828,11.16596221923828,9.904296875,9.904296875,10.64170837402344,10.64170837402344,9.269927978515625,9.269927978515625,9.998908996582031,9.998908996582031,11.09075927734375,11.09075927734375,9.354576110839844,9.354576110839844,10.44242858886719,10.44242858886719,11.16193389892578,11.16193389892578,9.839653015136719,9.839653015136719,10.57581329345703,10.57581329345703,9.211013793945312,9.211013793945312,9.937385559082031,9.937385559082031,11.03561401367188,11.03561401367188,9.314346313476562,9.314346313476562,10.41731262207031,10.41731262207031,11.14701080322266,11.14701080322266,9.808395385742188,9.808395385742188,10.52409362792969,10.52409362792969,9.189598083496094,9.189598083496094,9.886154174804688,9.886154174804688,10.95469665527344,10.95469665527344,9.241477966308594,9.241477966308594,10.34946441650391,10.34946441650391,11.07054138183594,11.07054138183594,9.588821411132812,9.588821411132812,10.32949829101562,10.32949829101562,10.32949829101562,8.951507568359375,8.951507568359375,9.690963745117188,9.690963745117188,10.76951599121094,10.76951599121094,9.065437316894531,9.065437316894531,10.16236114501953,10.16236114501953,10.89425659179688,10.89425659179688,9.528877258300781,9.528877258300781,10.26403045654297,10.26403045654297,8.939674377441406,8.939674377441406,9.671195983886719,9.671195983886719,10.76220703125,10.76220703125,9.050758361816406,9.050758361816406,10.14414215087891,10.14414215087891,10.87688446044922,10.87688446044922,9.535377502441406,9.535377502441406,10.28266143798828,10.28266143798828,11.205078125,11.205078125,11.205078125,9.608085632324219,9.608085632324219,10.71452331542969,10.71452331542969,9.017593383789062,9.017593383789062,10.10600280761719,10.10600280761719,10.83280944824219,10.83280944824219,9.505760192871094,9.505760192871094,10.23487854003906,10.23487854003906,11.21865081787109,11.21865081787109,11.21865081787109,9.619903564453125,9.619903564453125,10.69612884521484,10.69612884521484],"meminc":[0,0,0.557647705078125,0,0.7064895629882812,0,-1.992019653320312,0,1.113861083984375,0,0.7205886840820312,0,-1.428047180175781,0,0.7426910400390625,0,-1.363815307617188,0,0.745849609375,0,1.100830078125,0,-1.729278564453125,0,1.124671936035156,0,0.732177734375,0,-1.375381469726562,0,0.72576904296875,0,-1.341262817382812,0,0.7417755126953125,0,1.102088928222656,0,-1.738082885742188,0,1.114578247070312,0,0.7250595092773438,0,-1.356338500976562,0,0.7268142700195312,0,-1.359138488769531,0,0.723236083984375,0,1.10546875,0,-1.722038269042969,0,1.0841064453125,0,0.7319793701171875,0,-1.363754272460938,0,0.7333984375,0,0.9500198364257812,0,0,-1.604026794433594,0,1.10284423828125,0,-1.717460632324219,0,1.102554321289062,0,0.71270751953125,0,-1.36224365234375,0,0.7308197021484375,0,1.032493591308594,0,0,-1.973274230957031,0,1.03515625,0,0.6500778198242188,0,-1.398078918457031,0,0.7349853515625,0,0.9154586791992188,0,0,-1.530303955078125,0,1.101295471191406,0,-1.721839904785156,0,1.089195251464844,0,0.7261581420898438,0,-1.362449645996094,0,0.7158355712890625,0,1.004104614257812,0,0,-1.611381530761719,0,1.08245849609375,0,-1.724044799804688,0,1.097076416015625,0,0.7148513793945312,0,-1.336753845214844,0,0.7305450439453125,0,1.055320739746094,0,0,-1.674934387207031,0,1.088348388671875,0,0.60931396484375,0,0,-1.2197265625,0,0.7037506103515625,0,-1.352584838867188,0,0.7280502319335938,0,1.089973449707031,0,-1.7154541015625,0,1.087966918945312,0,0.6562347412109375,0,0,-1.261665344238281,0,0.7374114990234375,0,-1.371780395507812,0,0.7289810180664062,0,1.091850280761719,0,-1.736183166503906,0,1.087852478027344,0,0.7195053100585938,0,-1.322280883789062,0,0.7361602783203125,0,-1.364799499511719,0,0.7263717651367188,0,1.098228454589844,0,-1.721267700195312,0,1.10296630859375,0,0.7296981811523438,0,-1.338615417480469,0,0.7156982421875,0,-1.334495544433594,0,0.6965560913085938,0,1.06854248046875,0,-1.713218688964844,0,1.107986450195312,0,0.7210769653320312,0,-1.481719970703125,0,0.7406768798828125,0,0,-1.37799072265625,0,0.7394561767578125,0,1.07855224609375,0,-1.704078674316406,0,1.096923828125,0,0.7318954467773438,0,-1.365379333496094,0,0.7351531982421875,0,-1.324356079101562,0,0.7315216064453125,0,1.091011047363281,0,-1.711448669433594,0,1.0933837890625,0,0.7327423095703125,0,-1.341506958007812,0,0.747283935546875,0,0.9224166870117188,0,0,-1.596992492675781,0,1.106437683105469,0,-1.696929931640625,0,1.088409423828125,0,0.726806640625,0,-1.327049255371094,0,0.7291183471679688,0,0.9837722778320312,0,0,-1.598747253417969,0,1.076225280761719,0],"filename":["generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R","generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null]},"interval":10,"files":[{"filename":"generate-primes-1.R","content":"generate.primes.upto.1 <- function(N) {\n  primes <- 2\n  for (i in 3:N) {\n    found.divisor <- FALSE\n    for (j in primes) {\n      if (i %% j == 0) {\n        found.divisor <- TRUE\n      }\n    }\n    if (!found.divisor) primes <- c(primes,i)\n  }\n  return(primes)\n}\n","normpath":"/home/runner/work/sc1/sc1/content/profile-debug/generate-primes-1.R"}],"prof_output":"/tmp/RtmpNtLVnG/filecd3742cbcb00.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>We see from the <code>profvis</code> results that most of the time is spent in line 6 performing the integer modulus operation. If we look at the code more closely, we can see that it is possible to eliminate some of these operations by breaking the loop over primes as soon as one divisor is found.</p>
<pre class="r"><code>source(&quot;generate-primes-2.R&quot;, keep.source=TRUE)
profvis(generate.primes.upto.2(10000))</code></pre>
<div class="profvis html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-2" style="width:100%;height:600px;"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"message":{"prof":{"time":[1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,8,9,9,10,10,11,11,12,12,12,13,13,14,14,15,15,16,16],"depth":[2,1,2,1,2,1,2,1,2,1,2,1,2,1,3,2,1,2,1,2,1,2,1,3,2,1,2,1,2,1,2,1,2,1],"label":["%%","local","%%","local","c","local","if (i %% j == 0) {","generate.primes.upto.2","%%","local","if (i %% j == 0) {","generate.primes.upto.2","if (i %% j == 0) {","generate.primes.upto.2","<GC>","if (i %% j == 0) {","generate.primes.upto.2","%%","local","if (i %% j == 0) {","generate.primes.upto.2","%%","local","if (i %% j == 0) {","%%","local","%%","local","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.2"],"filenum":[1,null,1,null,1,null,1,null,1,null,1,null,1,null,null,1,null,1,null,1,null,1,null,1,1,null,1,null,1,null,1,null,1,null],"linenum":[6,null,6,null,11,null,6,null,6,null,6,null,6,null,null,6,null,6,null,6,null,6,null,6,6,null,6,null,6,null,6,null,6,null],"memalloc":[10.7752685546875,10.7752685546875,11.70558929443359,11.70558929443359,10.04492950439453,10.04492950439453,11.05738067626953,11.05738067626953,12.51938629150391,12.51938629150391,10.28907012939453,10.28907012939453,11.81970977783203,11.81970977783203,12.58828735351562,12.58828735351562,12.58828735351562,11.14286041259766,11.14286041259766,12.15773010253906,12.15773010253906,10.45205688476562,10.45205688476562,11.47905731201172,11.47905731201172,11.47905731201172,9.769012451171875,9.769012451171875,10.78322601318359,10.78322601318359,12.31792449951172,12.31792449951172,10.13143157958984,10.13143157958984],"meminc":[0,0,0.9303207397460938,0,-1.660659790039062,0,1.012451171875,0,1.462005615234375,0,-2.230316162109375,0,1.5306396484375,0,0.7685775756835938,0,0,-1.445426940917969,0,1.014869689941406,0,-1.705673217773438,0,1.027000427246094,0,0,-1.710044860839844,0,1.014213562011719,0,1.534698486328125,0,-2.186492919921875,0],"filename":["generate-primes-2.R",null,"generate-primes-2.R",null,"generate-primes-2.R",null,"generate-primes-2.R",null,"generate-primes-2.R",null,"generate-primes-2.R",null,"generate-primes-2.R",null,null,"generate-primes-2.R",null,"generate-primes-2.R",null,"generate-primes-2.R",null,"generate-primes-2.R",null,"generate-primes-2.R","generate-primes-2.R",null,"generate-primes-2.R",null,"generate-primes-2.R",null,"generate-primes-2.R",null,"generate-primes-2.R",null]},"interval":10,"files":[{"filename":"generate-primes-2.R","content":"generate.primes.upto.2 <- function(N) {\n  primes <- 2\n  for (i in 3:N) {\n    found.divisor <- FALSE\n    for (j in primes) {\n      if (i %% j == 0) {\n        found.divisor <- TRUE\n        break\n      }\n    }\n    if (!found.divisor) primes <- c(primes,i)\n  }\n  return(primes)\n}\n","normpath":"/home/runner/work/sc1/sc1/content/profile-debug/generate-primes-2.R"}],"prof_output":"/tmp/RtmpNtLVnG/filecd374902f32.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>This has dramatically reduced the running time of the algorithm, by a factor of about 10. Although the function is fairly short, we may feel that the code is not easy to read. In particular, the overall idea of the algorithm can be lost in the implementation details. So we can consider the same algorithm, but where we call a helper function called <code>any.divisors</code> instead.</p>
<pre class="r"><code>source(&quot;generate-primes-3.R&quot;, keep.source=TRUE)
profvis(generate.primes.upto.3(10000))</code></pre>
<div class="profvis html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-3" style="width:100%;height:600px;"></div>
<script type="application/json" data-for="htmlwidget-3">{"x":{"message":{"prof":{"time":[1,1,1,2,2,2,3,3,3,4,4,5,5,5,6,6,7,7,7,8,8,9,9,9,10,10,11,11,11,12,12,12,13,13,13,14,14,14,15,15],"depth":[3,2,1,3,2,1,3,2,1,2,1,3,2,1,2,1,3,2,1,2,1,3,2,1,2,1,3,2,1,3,2,1,3,2,1,3,2,1,2,1],"label":["if (i %% j == 0) {","any.divisors","generate.primes.upto.3","if (i %% j == 0) {","any.divisors","generate.primes.upto.3","if (i %% j == 0) {","any.divisors","generate.primes.upto.3","%%","local","if (i %% j == 0) {","any.divisors","generate.primes.upto.3","%%","local","for (j in ps) {","any.divisors","generate.primes.upto.3","%%","local","if (i %% j == 0) {","%%","local","if (!any.divisors(i, primes)) {","generate.primes.upto.3","if (i %% j == 0) {","any.divisors","generate.primes.upto.3","if (i %% j == 0) {","any.divisors","generate.primes.upto.3","if (i %% j == 0) {","any.divisors","generate.primes.upto.3","if (i %% j == 0) {","any.divisors","generate.primes.upto.3","%%","local"],"filenum":[1,1,null,1,1,null,1,1,null,1,null,1,1,null,1,null,1,1,null,1,null,1,1,null,1,null,1,1,null,1,1,null,1,1,null,1,1,null,1,null],"linenum":[3,13,null,3,13,null,3,13,null,3,null,3,13,null,3,null,2,13,null,3,null,3,3,null,13,null,3,13,null,3,13,null,3,13,null,3,13,null,3,null],"memalloc":[10.49224853515625,10.49224853515625,10.49224853515625,11.11602783203125,11.11602783203125,11.11602783203125,12.07462310791016,12.07462310791016,12.07462310791016,10.22775268554688,10.22775268554688,11.25164031982422,11.25164031982422,11.25164031982422,11.94099426269531,11.94099426269531,10.23186492919922,10.23186492919922,10.23186492919922,10.92254638671875,10.92254638671875,11.95042419433594,11.95042419433594,11.95042419433594,9.917564392089844,9.917564392089844,10.95115661621094,10.95115661621094,10.95115661621094,11.64261627197266,11.64261627197266,11.64261627197266,9.948822021484375,9.948822021484375,9.948822021484375,10.63303375244141,10.63303375244141,10.63303375244141,11.68434906005859,11.68434906005859],"meminc":[0,0,0,0.623779296875,0,0,0.9585952758789062,0,0,-1.846870422363281,0,1.023887634277344,0,0,0.6893539428710938,0,-1.709129333496094,0,0,0.6906814575195312,0,1.027877807617188,0,0,-2.032859802246094,0,1.033592224121094,0,0,0.6914596557617188,0,0,-1.693794250488281,0,0,0.6842117309570312,0,0,1.051315307617188,0],"filename":["generate-primes-3.R","generate-primes-3.R",null,"generate-primes-3.R","generate-primes-3.R",null,"generate-primes-3.R","generate-primes-3.R",null,"generate-primes-3.R",null,"generate-primes-3.R","generate-primes-3.R",null,"generate-primes-3.R",null,"generate-primes-3.R","generate-primes-3.R",null,"generate-primes-3.R",null,"generate-primes-3.R","generate-primes-3.R",null,"generate-primes-3.R",null,"generate-primes-3.R","generate-primes-3.R",null,"generate-primes-3.R","generate-primes-3.R",null,"generate-primes-3.R","generate-primes-3.R",null,"generate-primes-3.R","generate-primes-3.R",null,"generate-primes-3.R",null]},"interval":10,"files":[{"filename":"generate-primes-3.R","content":"any.divisors <- function(i, ps) {\n  for (j in ps) {\n    if (i %% j == 0) {\n      return(TRUE)\n    }\n  }\n  return(FALSE)\n}\n\ngenerate.primes.upto.3 <- function(N) {\n  primes <- 2\n  for (i in 3:N) {\n    if (!any.divisors(i, primes)) {\n      primes <- c(primes,i)\n    }\n  }\n  return(primes)\n}\n","normpath":"/home/runner/work/sc1/sc1/content/profile-debug/generate-primes-3.R"}],"prof_output":"/tmp/RtmpNtLVnG/filecd374860f797.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>It seems reasonable to say that the third version of the algorithm is easier to understand. Moreover, there is little to no performance penalty.</p>
</div>
<div id="the-sieve-of-eratosthenes" class="section level2">
<h2>The Sieve of Eratosthenes</h2>
<p>A more computationally efficient approach is the <a href="https://en.wikipedia.org/wiki/Sieve_of_Eratosthenes">Sieve of Eratosthenes</a>. In this approach, one does not check whether each number is prime by checking divisors. Instead, one starts with a list of numbers from <span class="math inline">\(1\)</span> to <span class="math inline">\(N\)</span> and successively marks all multiples of each prime, in order, as composite. To identify the next prime after <span class="math inline">\(2\)</span> for marking multiples, one simply needs to find the next number not marked composite.</p>
<p>This approach is so much faster, that we consider finding all primes up to <span class="math inline">\(1000000\)</span> instead of up to <span class="math inline">\(10000\)</span>.</p>
<pre class="r"><code>source(&quot;sieve-1.R&quot;, keep.source=TRUE)
profvis(sieve.1(1000000))</code></pre>
<div class="profvis html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-4" style="width:100%;height:600px;"></div>
<script type="application/json" data-for="htmlwidget-4">{"x":{"message":{"prof":{"time":[1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,14,14,15,15,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29],"depth":[2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1],"label":["s <- s + i","sieve.1","while (s <= N) {","sieve.1","candidates[s] <- FALSE","sieve.1","candidates[s] <- FALSE","sieve.1","candidates[s] <- FALSE","sieve.1","while (s <= N) {","sieve.1","s <- s + i","sieve.1","candidates[s] <- FALSE","sieve.1","s <- s + i","sieve.1","while (s <= N) {","sieve.1","while (s <= N) {","sieve.1","s <- s + i","sieve.1","candidates[s] <- FALSE","sieve.1","s <- s + i","sieve.1","candidates[s] <- FALSE","sieve.1","while (s <= N) {","sieve.1","candidates[s] <- FALSE","sieve.1","s <- s + i","sieve.1","candidates[s] <- FALSE","sieve.1","while (s <= N) {","sieve.1","candidates[s] <- FALSE","sieve.1","candidates[s] <- FALSE","sieve.1","candidates[s] <- FALSE","sieve.1","while (s <= N) {","sieve.1","while (s <= N) {","sieve.1","if (candidates[i]) {","sieve.1","if (candidates[i]) {","sieve.1","if (candidates[i]) {","sieve.1","for (i in 2:N) {","sieve.1"],"filenum":[1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null],"linenum":[10,null,8,null,9,null,9,null,9,null,8,null,10,null,9,null,10,null,8,null,8,null,10,null,9,null,10,null,9,null,8,null,9,null,10,null,9,null,8,null,9,null,9,null,9,null,8,null,8,null,5,null,5,null,5,null,4,null],"memalloc":[13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438,13.76132202148438],"meminc":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"filename":["sieve-1.R",null,"sieve-1.R",null,"sieve-1.R",null,"sieve-1.R",null,"sieve-1.R",null,"sieve-1.R",null,"sieve-1.R",null,"sieve-1.R",null,"sieve-1.R",null,"sieve-1.R",null,"sieve-1.R",null,"sieve-1.R",null,"sieve-1.R",null,"sieve-1.R",null,"sieve-1.R",null,"sieve-1.R",null,"sieve-1.R",null,"sieve-1.R",null,"sieve-1.R",null,"sieve-1.R",null,"sieve-1.R",null,"sieve-1.R",null,"sieve-1.R",null,"sieve-1.R",null,"sieve-1.R",null,"sieve-1.R",null,"sieve-1.R",null,"sieve-1.R",null,"sieve-1.R",null]},"interval":10,"files":[{"filename":"sieve-1.R","content":"sieve.1 <- function(N) {\n  candidates <- rep(TRUE,N)\n  candidates[1] <- FALSE\n  for (i in 2:N) {\n    if (candidates[i]) {\n      # i is prime\n      s <- i*2\n      while (s <= N) {\n        candidates[s] <- FALSE\n        s <- s + i\n      }\n    }\n  }\n  return((1:N)[candidates])\n}\n","normpath":"/home/runner/work/sc1/sc1/content/profile-debug/sieve-1.R"}],"prof_output":"/tmp/RtmpNtLVnG/filecd3763647193.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>We see that most of the time is spent in lines 8–10, which correspond to marking <code>s</code> as composite and incrementing <code>s</code> by the current prime. We can remove some of these computations by noticing that if <span class="math inline">\(i\)</span> is prime then all multiples <span class="math inline">\(2i,3i,\ldots,(i-1)i\)</span> will already have been marked as composite. It follows that one can also stop “sieving” as soon as <span class="math inline">\(i &gt; \sqrt{N}\)</span>.</p>
<pre class="r"><code>source(&quot;sieve-2.R&quot;, keep.source=TRUE)
profvis(sieve.2(1000000))</code></pre>
<div class="profvis html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-5" style="width:100%;height:600px;"></div>
<script type="application/json" data-for="htmlwidget-5">{"x":{"message":{"prof":{"time":[1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,14,14,15,15,16,16,17,17,18,18],"depth":[2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1],"label":["while (s <= N) {","sieve.2","s <- s + i","sieve.2","candidates[s] <- FALSE","sieve.2","s <- s + i","sieve.2","while (s <= N) {","sieve.2","candidates[s] <- FALSE","sieve.2","candidates[s] <- FALSE","sieve.2","candidates[s] <- FALSE","sieve.2","s <- s + i","sieve.2","candidates[s] <- FALSE","sieve.2","candidates[s] <- FALSE","sieve.2","candidates[s] <- FALSE","sieve.2","while (s <= N) {","sieve.2","while (s <= N) {","sieve.2","while (s <= N) {","sieve.2","candidates[s] <- FALSE","sieve.2","candidates[s] <- FALSE","sieve.2","while (s <= N) {","sieve.2"],"filenum":[1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null,1,null],"linenum":[9,null,11,null,10,null,11,null,9,null,10,null,10,null,10,null,11,null,10,null,10,null,10,null,9,null,9,null,9,null,10,null,10,null,9,null],"memalloc":[13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406,13.77174377441406],"meminc":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"filename":["sieve-2.R",null,"sieve-2.R",null,"sieve-2.R",null,"sieve-2.R",null,"sieve-2.R",null,"sieve-2.R",null,"sieve-2.R",null,"sieve-2.R",null,"sieve-2.R",null,"sieve-2.R",null,"sieve-2.R",null,"sieve-2.R",null,"sieve-2.R",null,"sieve-2.R",null,"sieve-2.R",null,"sieve-2.R",null,"sieve-2.R",null,"sieve-2.R",null]},"interval":10,"files":[{"filename":"sieve-2.R","content":"sieve.2 <- function(N) {\n  candidates <- rep(TRUE,N)\n  candidates[1] <- FALSE\n  sqrt.N <- sqrt(N)\n  for (i in 2:sqrt.N) {\n    if (candidates[i]) {\n      # i is prime\n      s <- i*i\n      while (s <= N) {\n        candidates[s] <- FALSE\n        s <- s + i\n      }\n    }\n  }\n  return((1:N)[candidates])\n}\n","normpath":"/home/runner/work/sc1/sc1/content/profile-debug/sieve-2.R"}],"prof_output":"/tmp/RtmpNtLVnG/filecd374d936af7.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>There appears to be a moderate improvement in performance for this size of problem. We notice that a substantial amount of time is spent in the <code>while</code> loop, which mainly involves incrementing <code>s</code> and flagging the corresponding number as composite. We can vectorize this computation and separate it cleanly from the rest of the algorithm, as follows.</p>
<pre class="r"><code>source(&quot;sieve-3.R&quot;, keep.source=TRUE)
profvis(sieve.3(1000000))</code></pre>
<div class="profvis html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-6" style="width:100%;height:600px;"></div>
<script type="application/json" data-for="htmlwidget-6">{"x":{"message":{"prof":{"time":[1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,4,4,5,5,6,6,6,6,6],"depth":[4,3,2,1,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,2,1,2,1,2,1,5,4,3,2,1],"label":["pmin","seq.default","get.multiples","sieve.3","getInlineInfo","isBaseVar","getFoldFun","constantFoldCall","constantFold","constantFoldCall","constantFold","constantFoldCall","constantFold","cmp","genCode","cmpCallArgs","cmpCallSymFun","cmpCall","cmp","cmpSymbolAssign","h","tryInline","cmpCall","cmp","h","tryInline","cmpCall","cmp","genCode","cmpfun","compiler:::tryCmpfun","candidates[multiples] <- FALSE","sieve.3","candidates[multiples] <- FALSE","sieve.3","candidates[multiples] <- FALSE","sieve.3","vapply","pmin","seq.default","get.multiples","sieve.3"],"filenum":[null,null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,1,null,1,null,1,null,null,null,null,1,null],"linenum":[null,null,14,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,14,15,null,15,null,15,null,null,null,null,14,null],"memalloc":[23.34369659423828,23.34369659423828,23.34369659423828,23.34369659423828,25.34162139892578,25.34162139892578,25.34162139892578,25.34162139892578,25.34162139892578,25.34162139892578,25.34162139892578,25.34162139892578,25.34162139892578,25.34162139892578,25.34162139892578,25.34162139892578,25.34162139892578,25.34162139892578,25.34162139892578,25.34162139892578,25.34162139892578,25.34162139892578,25.34162139892578,25.34162139892578,25.34162139892578,25.34162139892578,25.34162139892578,25.34162139892578,25.34162139892578,25.34162139892578,25.34162139892578,36.81169128417969,36.81169128417969,44.39278411865234,44.39278411865234,56.38401794433594,56.38401794433594,61.92352294921875,61.92352294921875,61.92352294921875,61.92352294921875,61.92352294921875],"meminc":[0,0,0,0,1.9979248046875,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,11.47006988525391,0,7.581092834472656,0,11.99123382568359,0,5.539505004882812,0,0,0,0],"filename":[null,null,"sieve-3.R",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"sieve-3.R","sieve-3.R",null,"sieve-3.R",null,"sieve-3.R",null,null,null,null,"sieve-3.R",null]},"interval":10,"files":[{"filename":"sieve-3.R","content":"get.multiples <- function(i, N) {\n  n <- floor(N/i) - i\n  if (n <= 0) return(NULL)\n  multiples <- seq(i*i,(i+n)*i,i)\n  return(multiples)\n}\n\nsieve.3 <- function(N) {\n  candidates <- rep(TRUE,N)\n  candidates[1] <- FALSE\n  sqrt.N <- sqrt(N)\n  for (i in 2:sqrt.N) {\n    if (candidates[i]) {\n      multiples <- get.multiples(i, N)\n      candidates[multiples] <- FALSE\n    }\n  }\n  return((1:N)[candidates])\n}\n","normpath":"/home/runner/work/sc1/sc1/content/profile-debug/sieve-3.R"}],"prof_output":"/tmp/RtmpNtLVnG/filecd374be03fcb.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>This gives another improvement to performance. It is worth noting that creating an array of multiples is faster than iterating through multiples in R, because the cost of allocating memory is negligible in comparison to the benefit of eliminating the loop. In a programming language such as C, the reverse is often true, as allocating memory is typically expensive in comparison to iteration once compiled into machine code.</p>
</div>
<div id="comments" class="section level2">
<h2>Comments</h2>
<p>Profiling in this scenario is already quite useful, as one can see which parts of the code are critical for performance. In larger applications, profiling is even more useful as one can quickly determine which functions are the most important from a performance perspective: if 1% of computation time is spent in a particular function, very little improvement can be derived by improving it, whereas if 99% of computation time is spent in a function one can conceivably improve performance very substantially by accelerating the implementation or improving the corresponding algorithm itself.</p>
<p>Profiling is also helpful for maintaining code readability and modularity: in some cases performance can be improved by sacrificing readability, or modularity of the code. Doing so can make sense if the code is critical to performance, but it makes little sense when the code is unimportant from a performance perspective.</p>
<p>Finally, when profiling code and trying to improve its performance, good testing tools are very useful for ensuring that any improvement in performance has not come at the cost of breaking existing functionality, including in rare, corner cases.</p>
</div>



  <footer>
  

<script src="//yihui.name/js/math-code.js"></script>
<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<script async src="//yihui.name/js/center-img.js"></script>


<script type="text/javascript">
var sc_project=12110974;
var sc_invisible=1;
var sc_security="9b171880";
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="https://statcounter.com/" target="_blank"><img
class="statcounter"
src="https://c.statcounter.com/12110974/0/9b171880/1/"
alt="Web Analytics"></a></div></noscript>








  


<p align=right>

<a href='https://github.com/awllee/sc1/blob/master/content/profile-debug/profile.Rmd'>View source</a>

|

<a href='https://github.com/awllee/sc1/edit/master/content/profile-debug/profile.Rmd'>Edit source</a>

</p>





<script src="https://utteranc.es/client.js"
        repo="awllee/sc1"
        issue-term="pathname"
        label="utterance"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>



  











<script src="//cdn.jsdelivr.net/combine/gh/highlightjs/cdn-release@9.12.0/build/highlight.min.js,gh/highlightjs/cdn-release@9.12.0/build/languages/r.min.js,gh/highlightjs/cdn-release@9.12.0/build/languages/yaml.min.js,gh/highlightjs/cdn-release@9.12.0/build/languages/tex.min.js,npm/@xiee/utils/js/load-highlight.js" defer></script>



  
  <hr>
  <div class="copyright">© 2020 <a href="https://sites.google.com/view/anthonylee">Anthony Lee</a>, <a href="http://www.bristol.ac.uk/maths/people/feng-yu/index.html">Feng Yu</a>, <a href="https://people.maths.bris.ac.uk/~tk18582/">Tobias Kley</a>, <a href="https://mfasiolo.github.io/">Matteo Fasiolo</a></div>
  
  </footer>
  </article>
  
  </body>
</html>

