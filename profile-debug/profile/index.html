<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Profiling - SC1</title>
    <meta property="og:title" content="Profiling - SC1">
    
    <meta name="twitter:card" content="summary">

    
      
    

    
      
      <meta property="description" content="Profiling in R is fairly straightforward using the profvis package, which builds upon base R’s Rprof functionality.
library(profvis) This is a statistical profiler: it operates by regularly (e.g. &amp;hellip;">
      <meta property="og:description" content="Profiling in R is fairly straightforward using the profvis package, which builds upon base R’s Rprof functionality.
library(profvis) This is a statistical profiler: it operates by regularly (e.g. &amp;hellip;">
      
    

    
    

    

    
    


<link href='//cdn.bootcss.com/highlight.js/9.12.0/styles/github.min.css' rel='stylesheet' type='text/css' />



    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Arvo">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Marcellus">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro">

<link rel="stylesheet" href="/css/custom.css" />

<link rel="icon" href="/sc1/favicon.ico" type="image/x-icon" />























<nav class="breadcrumbs">
    
        <a href="https://awllee.github.io/sc1/">home / </a>
    
        <a href="https://awllee.github.io/sc1/profile-debug/">profile-debug / </a>
    
        <a href="https://awllee.github.io/sc1/profile-debug/profile/">profile / </a>
    
</nav>

  </head>

  
  <body class="sc1">
    <header class="masthead">
      <h1><a href="/">SC1</a></h1>

<p class="tagline">Statistical Computing 1</p>

      <nav class="menu">
  <input id="menu-check" type="checkbox" hidden/>
  <label id="menu-label" for="menu-check" class="unselectable" hidden>
    <span class="icon close-icon">✕</span>
    <span class="icon open-icon">☰</span>
    <span class="text">Menu</span>
  </label>
  <ul>
  
  
  <li><a href="/sc1/">Home</a></li>
  
  <li><a href="/sc1/intro-r/">Intro to R</a></li>
  
  <li><a href="/sc1/reproducibility/">Reproducibility</a></li>
  
  <li><a href="/sc1/packages/">Packages</a></li>
  
  <li><a href="/sc1/common-r/">Common R</a></li>
  
  <li><a href="/sc1/functional-oo/">Functional / OO</a></li>
  
  <li><a href="/sc1/tidyverse/">Tidyverse</a></li>
  
  <li><a href="/sc1/profile-debug/">Performance / Bugs</a></li>
  
  <li><a href="/sc1/matrices/">Matrices</a></li>
  
  <li><a href="/sc1/optimization/">Optimization</a></li>
  
  <li><a href="/sc1/integration/">Integration</a></li>
  
  
  </ul>
</nav>

    </header>

    <article class="main">
      <header class="title">
      
<h1>Profiling</h1>

<h3>
</h3>
<hr>


      </header>






<script src="/sc1/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/sc1/rmarkdown-libs/jquery/jquery.min.js"></script>
<script src="/sc1/rmarkdown-libs/d3/d3.min.js"></script>
<link href="/sc1/rmarkdown-libs/profvis/profvis.css" rel="stylesheet" />
<script src="/sc1/rmarkdown-libs/profvis/profvis.js"></script>
<script src="/sc1/rmarkdown-libs/profvis/scroll.js"></script>
<link href="/sc1/rmarkdown-libs/highlight/textmate.css" rel="stylesheet" />
<script src="/sc1/rmarkdown-libs/highlight/highlight.js"></script>
<script src="/sc1/rmarkdown-libs/profvis-binding/profvis.js"></script>

<div id="TOC">
<ul>
<li><a href="#updating-a-list-of-primes">Updating a list of primes</a></li>
<li><a href="#the-sieve-of-eratosthenes">The Sieve of Eratosthenes</a></li>
<li><a href="#comments">Comments</a></li>
</ul>
</div>

<p><a href="https://en.wikipedia.org/wiki/Profiling_(computer_programming)">Profiling</a> in R is fairly straightforward using the <a href="https://rstudio.github.io/profvis/"><code>profvis</code></a> package, which builds upon base R’s <code>Rprof</code> functionality.</p>
<pre class="r"><code>library(profvis)</code></pre>
<p>This is a <em>statistical profiler</em>: it operates by regularly (e.g. every few milliseconds) using operating system interrupts to determine what code is being executed. This enables one to build a picture of where the computation is spending most of its time, and is essentially an application of the Monte Carlo method. Although the results are not deterministic, the profiling operation adds very little overhead to the computation.</p>
<p>Statistical profilers can be viewed in contrast to <em>instrumenting profilers</em> of various flavours, which often involve incrementing counters whenever certain events occur. This often involves instrumenting existing code by adding instructions to increment the counters either manually or automatically. For example, incrementing a counter whenever a function is called. Instrumenting profilers can provide very accurate results, but can add substantial overhead to the computation. These tools can be important not only for understanding performance, but also for checking the validity and robustness of code: for example, <a href="https://en.wikipedia.org/wiki/Valgrind">Valgrind</a> is often used in C code to detect memory leaks and memory reference errors.</p>
<p>We consider here profiling various R functions for generating an array of all primes less than or equal to some number.</p>
<div id="updating-a-list-of-primes" class="section level2">
<h2>Updating a list of primes</h2>
<p>A straightforward approach to generating all prime numbers less than some number <span class="math inline">\(N\)</span> is to iterate through the numbers <span class="math inline">\(3,\ldots,N\)</span> and add the current number to the list of primes if there is no divisor of that number in the current list of primes.</p>
<p>In the following, we profile 3 variants of this approach. The first variant is a very inefficient implementation.</p>
<pre class="r"><code>source(&quot;generate-primes-1.R&quot;, keep.source=TRUE)
profvis(generate.primes.upto.1(10000))</code></pre>
<div class="profvis html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-1" style="width:100%;height:600px;"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"message":{"prof":{"time":[1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,6,6,6,6,6,6,7,7,7,7,7,7,7,8,8,8,8,8,8,9,9,9,10,10,10,10,10,10,11,11,12,12,13,13,13,13,13,13,14,14,14,14,14,14,15,15,15,15,15,15,16,16,16,16,16,16,17,17,18,18,18,18,18,18,19,19,20,20,20,20,20,20,21,21,21,21,21,21,22,22,23,23,23,23,23,23,24,24,24,24,24,24,25,25,25,26,26,27,27,27,27,27,27,28,28,28,28,28,28,29,29,30,30,31,31,31,31,31,31,32,32,32,32,32,32,33,33,33,33,33,33,34,34,35,35,35,35,35,35,36,36,36,36,36,36,36,37,37,37,37,37,37,38,38,39,39,40,40,40,40,40,40,40,41,41,41,41,41,41,42,42,43,43,43,43,43,43,44,44,44,45,45,45,45,45,45,46,46,47,47,47,47,47,47,47,48,48,48,48,48,48,49,49,50,50,50,50,50,50,51,51,51,51,51,51,52,52,52,52,52,52,52,53,53,54,54,54,54,54,54,55,55,55,55,55,55,55,56,56,56,56,56,56,57,57,58,58,59,59,59,59,59,59,60,60,61,61,62,62,62,62,62,62,63,63,64,64,65,65,66,66,67,67,67,67,67,67,68,68,69,69,69,69,69,69,69,70,70,71,71,72,72,72,72,72,72,73,73,73,73,73,73,74,74,75,75,76,76,77,77,78,78,78,78,78,78,78,79,79,80,80,80,80,80,80,81,81,81,81,81,81,81,82,82,83,83,84,84,84,84,84,84,85,85,85,85,85,85,86,86,86,86,86,86,87,87,88,88,89,89,90,90,91,91,91,91,91,91,92,92,93,93,93,93,93,93,93,94,94,95,95,96,96,97,97,97,97,97,97,98,98,99,99,100,100,100,100,100,100,101,101,101,101,101,101,102,102,102,102,102,102,103,103,104,104,104,104,104,104,105,105,106,106,107,107,108,108,108,108,108,108,109,109,109,109,109,109,110,110,110,110,110,110,111,111,112,112,112,112,112,112,113,113,113,113,113,113,114,114,114,114,114,114,115,115,116,116,117,117,117,117,117,117,117,118,118,118,118,118,118,119,119,119,119,119,119,120,120,121,121,121,121,121,121],"depth":[2,1,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,7,6,5,4,3,2,1,6,5,4,3,2,1,3,2,1,6,5,4,3,2,1,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,3,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,7,6,5,4,3,2,1,6,5,4,3,2,1,2,1,2,1,7,6,5,4,3,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,3,2,1,6,5,4,3,2,1,2,1,7,6,5,4,3,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,7,6,5,4,3,2,1,2,1,6,5,4,3,2,1,7,6,5,4,3,2,1,6,5,4,3,2,1,2,1,2,1,6,5,4,3,2,1,2,1,2,1,6,5,4,3,2,1,2,1,2,1,2,1,2,1,6,5,4,3,2,1,2,1,7,6,5,4,3,2,1,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,2,1,2,1,2,1,7,6,5,4,3,2,1,2,1,6,5,4,3,2,1,7,6,5,4,3,2,1,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,2,1,2,1,2,1,6,5,4,3,2,1,2,1,7,6,5,4,3,2,1,2,1,2,1,2,1,6,5,4,3,2,1,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,2,1,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,2,1,7,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1],"label":["lazyLoadDBfetch","local","%in%","checkSkipLoopCntxt","checkSkipLoopCntxtList","checkSkipLoopCntxt","checkSkipLoopCntxtList","checkSkipLoopCntxt","h","tryInline","cmpCall","cmp","h","tryInline","cmpCall","cmp","genCode","cmpfun","compiler:::tryCmpfun","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","for (j in primes) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","for (j in primes) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","%%","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","%%","local","for (j in primes) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","%%","local","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","c","local","%%","local","%%","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","%%","local","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","%%","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local"],"filenum":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,1,null,1,null,null,null,null,null,1,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,1,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,1,null,1,null,null,null,null,null,1,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,1,null,null,null,null,null,1,null,1,null,1,null,null,null,null,null,1,null,1,null,1,null,1,null,1,null,null,null,null,null,1,null,null,1,null,null,null,null,null,1,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,1,null,1,null,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,1,null,1,null,1,null,null,null,null,null,1,null,null,1,null,null,null,null,null,1,null,1,null,1,null,1,null,null,null,null,null,1,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,1,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null],"linenum":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,6,null,6,null,null,null,null,null,6,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,5,null,null,null,null,null,6,null,null,null,null,null,6,6,null,6,null,6,null,null,null,null,null,5,null,null,null,null,null,6,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,6,6,null,6,null,null,null,null,null,6,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,6,null,null,null,null,null,6,null,6,null,5,null,null,null,null,null,6,null,6,null,6,null,6,null,6,null,null,null,null,null,6,null,null,6,null,null,null,null,null,6,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,10,null,6,null,6,null,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,6,null,6,null,6,null,null,null,null,null,6,null,null,6,null,null,null,null,null,6,null,6,null,6,null,6,null,null,null,null,null,6,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,6,null,6,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null],"memalloc":[11.0936737060547,11.0936737060547,11.9515533447266,11.9515533447266,11.9515533447266,11.9515533447266,11.9515533447266,11.9515533447266,11.9515533447266,11.9515533447266,11.9515533447266,11.9515533447266,11.9515533447266,11.9515533447266,11.9515533447266,11.9515533447266,11.9515533447266,11.9515533447266,11.9515533447266,11.9515533447266,11.9515533447266,11.9515533447266,11.9515533447266,12.4243545532227,12.4243545532227,12.4243545532227,12.4243545532227,12.4243545532227,12.4243545532227,12.9628677368164,12.9628677368164,12.9628677368164,12.9628677368164,12.9628677368164,12.9628677368164,13.5455780029297,13.5455780029297,13.5455780029297,13.5455780029297,13.5455780029297,13.5455780029297,14.1369781494141,14.1369781494141,14.1369781494141,14.1369781494141,14.1369781494141,14.1369781494141,14.3746032714844,14.3746032714844,14.3746032714844,14.3746032714844,14.3746032714844,14.3746032714844,14.3746032714844,9.72921752929688,9.72921752929688,9.72921752929688,9.72921752929688,9.72921752929688,9.72921752929688,10.6223678588867,10.6223678588867,10.6223678588867,9.25811004638672,9.25811004638672,9.25811004638672,9.25811004638672,9.25811004638672,9.25811004638672,10.0919647216797,10.0919647216797,11.0516967773438,11.0516967773438,8.8529052734375,8.8529052734375,8.8529052734375,8.8529052734375,8.8529052734375,8.8529052734375,9.77059173583984,9.77059173583984,9.77059173583984,9.77059173583984,9.77059173583984,9.77059173583984,10.7355041503906,10.7355041503906,10.7355041503906,10.7355041503906,10.7355041503906,10.7355041503906,8.66127777099609,8.66127777099609,8.66127777099609,8.66127777099609,8.66127777099609,8.66127777099609,9.53485870361328,9.53485870361328,10.7334060668945,10.7334060668945,10.7334060668945,10.7334060668945,10.7334060668945,10.7334060668945,8.68070220947266,8.68070220947266,9.89971923828125,9.89971923828125,9.89971923828125,9.89971923828125,9.89971923828125,9.89971923828125,11.01611328125,11.01611328125,11.01611328125,11.01611328125,11.01611328125,11.01611328125,8.94315338134766,8.94315338134766,10.1318664550781,10.1318664550781,10.1318664550781,10.1318664550781,10.1318664550781,10.1318664550781,11.0269470214844,11.0269470214844,11.0269470214844,11.0269470214844,11.0269470214844,11.0269470214844,8.97407531738281,8.97407531738281,8.97407531738281,9.86101531982422,9.86101531982422,11.0678329467773,11.0678329467773,11.0678329467773,11.0678329467773,11.0678329467773,11.0678329467773,9.03739166259766,9.03739166259766,9.03739166259766,9.03739166259766,9.03739166259766,9.03739166259766,10.05615234375,10.05615234375,10.953254699707,10.953254699707,8.91853332519531,8.91853332519531,8.91853332519531,8.91853332519531,8.91853332519531,8.91853332519531,9.80792236328125,9.80792236328125,9.80792236328125,9.80792236328125,9.80792236328125,9.80792236328125,10.7189025878906,10.7189025878906,10.7189025878906,10.7189025878906,10.7189025878906,10.7189025878906,8.82655334472656,8.82655334472656,9.71646881103516,9.71646881103516,9.71646881103516,9.71646881103516,9.71646881103516,9.71646881103516,11.3638381958008,11.3638381958008,11.3638381958008,11.3638381958008,11.3638381958008,11.3638381958008,11.3638381958008,9.29613494873047,9.29613494873047,9.29613494873047,9.29613494873047,9.29613494873047,9.29613494873047,10.3521423339844,10.3521423339844,11.2601928710938,11.2601928710938,8.61813354492188,8.61813354492188,8.61813354492188,8.61813354492188,8.61813354492188,8.61813354492188,8.61813354492188,9.43064117431641,9.43064117431641,9.43064117431641,9.43064117431641,9.43064117431641,9.43064117431641,10.1457366943359,10.1457366943359,10.9509353637695,10.9509353637695,10.9509353637695,10.9509353637695,10.9509353637695,10.9509353637695,8.86470031738281,8.86470031738281,8.86470031738281,9.75926971435547,9.75926971435547,9.75926971435547,9.75926971435547,9.75926971435547,9.75926971435547,10.6663131713867,10.6663131713867,8.62950897216797,8.62950897216797,8.62950897216797,8.62950897216797,8.62950897216797,8.62950897216797,8.62950897216797,10.0614166259766,10.0614166259766,10.0614166259766,10.0614166259766,10.0614166259766,10.0614166259766,11.2131881713867,11.2131881713867,9.67507171630859,9.67507171630859,9.67507171630859,9.67507171630859,9.67507171630859,9.67507171630859,10.5862731933594,10.5862731933594,10.5862731933594,10.5862731933594,10.5862731933594,10.5862731933594,11.3167495727539,11.3167495727539,11.3167495727539,11.3167495727539,11.3167495727539,11.3167495727539,11.3167495727539,9.45581817626953,9.45581817626953,10.3716812133789,10.3716812133789,10.3716812133789,10.3716812133789,10.3716812133789,10.3716812133789,11.35791015625,11.35791015625,11.35791015625,11.35791015625,11.35791015625,11.35791015625,11.35791015625,9.29320526123047,9.29320526123047,9.29320526123047,9.29320526123047,9.29320526123047,9.29320526123047,10.4241561889648,10.4241561889648,8.71219635009766,8.71219635009766,9.60524749755859,9.60524749755859,9.60524749755859,9.60524749755859,9.60524749755859,9.60524749755859,10.519172668457,10.519172668457,9.19408416748047,9.19408416748047,11.0155487060547,11.0155487060547,11.0155487060547,11.0155487060547,11.0155487060547,11.0155487060547,8.99545288085938,8.99545288085938,9.90754699707031,9.90754699707031,10.8122482299805,10.8122482299805,8.78250122070312,8.78250122070312,9.6673583984375,9.6673583984375,9.6673583984375,9.6673583984375,9.6673583984375,9.6673583984375,10.5894470214844,10.5894470214844,11.3491287231445,11.3491287231445,11.3491287231445,11.3491287231445,11.3491287231445,11.3491287231445,11.3491287231445,9.46498870849609,9.46498870849609,10.3555068969727,10.3555068969727,11.2525024414062,11.2525024414062,11.2525024414062,11.2525024414062,11.2525024414062,11.2525024414062,9.26914978027344,9.26914978027344,9.26914978027344,9.26914978027344,9.26914978027344,9.26914978027344,10.1249694824219,10.1249694824219,8.85431671142578,8.85431671142578,9.76579284667969,9.76579284667969,10.6633224487305,10.6633224487305,11.3786010742188,11.3786010742188,11.3786010742188,11.3786010742188,11.3786010742188,11.3786010742188,11.3786010742188,9.75261688232422,9.75261688232422,10.6038055419922,10.6038055419922,10.6038055419922,10.6038055419922,10.6038055419922,10.6038055419922,11.3885269165039,11.3885269165039,11.3885269165039,11.3885269165039,11.3885269165039,11.3885269165039,11.3885269165039,9.67951202392578,9.67951202392578,10.6024780273438,10.6024780273438,9.29388427734375,9.29388427734375,9.29388427734375,9.29388427734375,9.29388427734375,9.29388427734375,10.2002182006836,10.2002182006836,10.2002182006836,10.2002182006836,10.2002182006836,10.2002182006836,11.096549987793,11.096549987793,11.096549987793,11.096549987793,11.096549987793,11.096549987793,9.04148101806641,9.04148101806641,9.93817901611328,9.93817901611328,10.8411331176758,10.8411331176758,8.80023956298828,8.80023956298828,9.68167877197266,9.68167877197266,9.68167877197266,9.68167877197266,9.68167877197266,9.68167877197266,10.589729309082,10.589729309082,11.4130630493164,11.4130630493164,11.4130630493164,11.4130630493164,11.4130630493164,11.4130630493164,11.4130630493164,9.56848907470703,9.56848907470703,10.486442565918,10.486442565918,11.4077453613281,11.4077453613281,9.97113800048828,9.97113800048828,9.97113800048828,9.97113800048828,9.97113800048828,9.97113800048828,11.0222473144531,11.0222473144531,9.10627746582031,9.10627746582031,10.4230346679688,10.4230346679688,10.4230346679688,10.4230346679688,10.4230346679688,10.4230346679688,11.3640365600586,11.3640365600586,11.3640365600586,11.3640365600586,11.3640365600586,11.3640365600586,9.18698120117188,9.18698120117188,9.18698120117188,9.18698120117188,9.18698120117188,9.18698120117188,10.09130859375,10.09130859375,11.0037384033203,11.0037384033203,11.0037384033203,11.0037384033203,11.0037384033203,11.0037384033203,8.97156524658203,8.97156524658203,10.1391830444336,10.1391830444336,11.0481033325195,11.0481033325195,9.03034973144531,9.03034973144531,9.03034973144531,9.03034973144531,9.03034973144531,9.03034973144531,10.1285018920898,10.1285018920898,10.1285018920898,10.1285018920898,10.1285018920898,10.1285018920898,11.0032806396484,11.0032806396484,11.0032806396484,11.0032806396484,11.0032806396484,11.0032806396484,8.94200134277344,8.94200134277344,9.81539916992188,9.81539916992188,9.81539916992188,9.81539916992188,9.81539916992188,9.81539916992188,10.7207183837891,10.7207183837891,10.7207183837891,10.7207183837891,10.7207183837891,10.7207183837891,8.71992492675781,8.71992492675781,8.71992492675781,8.71992492675781,8.71992492675781,8.71992492675781,9.60911560058594,9.60911560058594,10.5312805175781,10.5312805175781,11.3462524414062,11.3462524414062,11.3462524414062,11.3462524414062,11.3462524414062,11.3462524414062,11.3462524414062,9.44175720214844,9.44175720214844,9.44175720214844,9.44175720214844,9.44175720214844,9.44175720214844,10.3499374389648,10.3499374389648,10.3499374389648,10.3499374389648,10.3499374389648,10.3499374389648,11.26171875,11.26171875,9.21999359130859,9.21999359130859,9.21999359130859,9.21999359130859,9.21999359130859,9.21999359130859],"meminc":[0,0,0.857879638671875,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.472801208496094,0,0,0,0,0,0.53851318359375,0,0,0,0,0,0.582710266113281,0,0,0,0,0,0.591400146484375,0,0,0,0,0,0.237625122070312,0,0,0,0,0,0,-4.6453857421875,0,0,0,0,0,0.893150329589844,0,0,-1.3642578125,0,0,0,0,0,0.833854675292969,0,0.959732055664062,0,-2.19879150390625,0,0,0,0,0,0.917686462402344,0,0,0,0,0,0.964912414550781,0,0,0,0,0,-2.07422637939453,0,0,0,0,0,0.873580932617188,0,1.19854736328125,0,0,0,0,0,-2.05270385742188,0,1.21901702880859,0,0,0,0,0,1.11639404296875,0,0,0,0,0,-2.07295989990234,0,1.18871307373047,0,0,0,0,0,0.89508056640625,0,0,0,0,0,-2.05287170410156,0,0,0.886940002441406,0,1.20681762695312,0,0,0,0,0,-2.03044128417969,0,0,0,0,0,1.01876068115234,0,0.897102355957031,0,-2.03472137451172,0,0,0,0,0,0.889389038085938,0,0,0,0,0,0.910980224609375,0,0,0,0,0,-1.89234924316406,0,0.889915466308594,0,0,0,0,0,1.64736938476562,0,0,0,0,0,0,-2.06770324707031,0,0,0,0,0,1.05600738525391,0,0.908050537109375,0,-2.64205932617188,0,0,0,0,0,0,0.812507629394531,0,0,0,0,0,0.715095520019531,0,0.805198669433594,0,0,0,0,0,-2.08623504638672,0,0,0.894569396972656,0,0,0,0,0,0.90704345703125,0,-2.03680419921875,0,0,0,0,0,0,1.43190765380859,0,0,0,0,0,1.15177154541016,0,-1.53811645507812,0,0,0,0,0,0.911201477050781,0,0,0,0,0,0.730476379394531,0,0,0,0,0,0,-1.86093139648438,0,0.915863037109375,0,0,0,0,0,0.986228942871094,0,0,0,0,0,0,-2.06470489501953,0,0,0,0,0,1.13095092773438,0,-1.71195983886719,0,0.893051147460938,0,0,0,0,0,0.913925170898438,0,-1.32508850097656,0,1.82146453857422,0,0,0,0,0,-2.02009582519531,0,0.912094116210938,0,0.904701232910156,0,-2.02974700927734,0,0.884857177734375,0,0,0,0,0,0.922088623046875,0,0.759681701660156,0,0,0,0,0,0,-1.88414001464844,0,0.890518188476562,0,0.896995544433594,0,0,0,0,0,-1.98335266113281,0,0,0,0,0,0.855819702148438,0,-1.27065277099609,0,0.911476135253906,0,0.897529602050781,0,0.715278625488281,0,0,0,0,0,0,-1.62598419189453,0,0.851188659667969,0,0,0,0,0,0.784721374511719,0,0,0,0,0,0,-1.70901489257812,0,0.922966003417969,0,-1.30859375,0,0,0,0,0,0.906333923339844,0,0,0,0,0,0.896331787109375,0,0,0,0,0,-2.05506896972656,0,0.896697998046875,0,0.9029541015625,0,-2.0408935546875,0,0.881439208984375,0,0,0,0,0,0.908050537109375,0,0.823333740234375,0,0,0,0,0,0,-1.84457397460938,0,0.917953491210938,0,0.921302795410156,0,-1.43660736083984,0,0,0,0,0,1.05110931396484,0,-1.91596984863281,0,1.31675720214844,0,0,0,0,0,0.941001892089844,0,0,0,0,0,-2.17705535888672,0,0,0,0,0,0.904327392578125,0,0.912429809570312,0,0,0,0,0,-2.03217315673828,0,1.16761779785156,0,0.908920288085938,0,-2.01775360107422,0,0,0,0,0,1.09815216064453,0,0,0,0,0,0.874778747558594,0,0,0,0,0,-2.061279296875,0,0.873397827148438,0,0,0,0,0,0.905319213867188,0,0,0,0,0,-2.00079345703125,0,0,0,0,0,0.889190673828125,0,0.922164916992188,0,0.814971923828125,0,0,0,0,0,0,-1.90449523925781,0,0,0,0,0,0.908180236816406,0,0,0,0,0,0.911781311035156,0,-2.04172515869141,0,0,0,0,0],"filename":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R","generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R","generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R","generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null]},"interval":10,"files":[{"filename":"generate-primes-1.R","content":"generate.primes.upto.1 <- function(N) {\n  primes <- 2\n  for (i in 3:N) {\n    found.divisor <- FALSE\n    for (j in primes) {\n      if (i %% j == 0) {\n        found.divisor <- TRUE\n      }\n    }\n    if (!found.divisor) primes <- c(primes,i)\n  }\n  return(primes)\n}\n","normpath":"/Users/runner/work/sc1/sc1/content/profile-debug/generate-primes-1.R"}],"prof_output":"/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T//Rtmp1UAYHA/file22481aad724d.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>We see from the <code>profvis</code> results that most of the time is spent in line 6 performing the integer modulus operation. If we look at the code more closely, we can see that it is possible to eliminate some of these operations by breaking the loop over primes as soon as one divisor is found.</p>
<pre class="r"><code>source(&quot;generate-primes-2.R&quot;, keep.source=TRUE)
profvis(generate.primes.upto.2(10000))</code></pre>
<div class="profvis html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-2" style="width:100%;height:600px;"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"message":{"prof":{"time":[1,1,2,2,2,2,2,2,3,3,3,3,3,3,4,4,5,5,5,5,5,5,6,6,6,6,6,6,7,7,8,8,9,9,9,9,9,9,10,10,11,11,12,12,12,12,12,12,13,13],"depth":[2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,2,1,6,5,4,3,2,1,2,1,2,1,6,5,4,3,2,1,2,1],"label":["%%","local","if (i %% j == 0) {","generate.primes.upto.2","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.2","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.2","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.2","eval","eval","eval.parent","local","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.2","eval","eval","eval.parent","local","%%","local","c","local","if (i %% j == 0) {","generate.primes.upto.2","eval","eval","eval.parent","local","c","local"],"filenum":[1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,1,null,null,null,null,null,1,null,1,null,1,null,null,null,null,null,1,null],"linenum":[6,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,6,null,null,null,null,null,6,null,11,null,6,null,null,null,null,null,11,null],"memalloc":[9.97191619873047,9.97191619873047,11.1668167114258,11.1668167114258,11.1668167114258,11.1668167114258,11.1668167114258,11.1668167114258,12.2593383789062,12.2593383789062,12.2593383789062,12.2593383789062,12.2593383789062,12.2593383789062,9.65666961669922,9.65666961669922,10.9199676513672,10.9199676513672,10.9199676513672,10.9199676513672,10.9199676513672,10.9199676513672,12.176887512207,12.176887512207,12.176887512207,12.176887512207,12.176887512207,12.176887512207,10.7975997924805,10.7975997924805,12.047607421875,12.047607421875,9.62059020996094,9.62059020996094,9.62059020996094,9.62059020996094,9.62059020996094,9.62059020996094,10.941032409668,10.941032409668,12.1725234985352,12.1725234985352,10.6639404296875,10.6639404296875,10.6639404296875,10.6639404296875,10.6639404296875,10.6639404296875,11.9045181274414,11.9045181274414],"meminc":[0,0,1.19490051269531,0,0,0,0,0,1.09252166748047,0,0,0,0,0,-2.60266876220703,0,1.26329803466797,0,0,0,0,0,1.25691986083984,0,0,0,0,0,-1.37928771972656,0,1.25000762939453,0,-2.42701721191406,0,0,0,0,0,1.32044219970703,0,1.23149108886719,0,-1.50858306884766,0,0,0,0,0,1.24057769775391,0],"filename":["generate-primes-2.R",null,"generate-primes-2.R",null,null,null,null,null,"generate-primes-2.R",null,null,null,null,null,"generate-primes-2.R",null,"generate-primes-2.R",null,null,null,null,null,"generate-primes-2.R",null,null,null,null,null,"generate-primes-2.R",null,"generate-primes-2.R",null,"generate-primes-2.R",null,null,null,null,null,"generate-primes-2.R",null,"generate-primes-2.R",null,"generate-primes-2.R",null,null,null,null,null,"generate-primes-2.R",null]},"interval":10,"files":[{"filename":"generate-primes-2.R","content":"generate.primes.upto.2 <- function(N) {\n  primes <- 2\n  for (i in 3:N) {\n    found.divisor <- FALSE\n    for (j in primes) {\n      if (i %% j == 0) {\n        found.divisor <- TRUE\n        break\n      }\n    }\n    if (!found.divisor) primes <- c(primes,i)\n  }\n  return(primes)\n}\n","normpath":"/Users/runner/work/sc1/sc1/content/profile-debug/generate-primes-2.R"}],"prof_output":"/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T//Rtmp1UAYHA/file2248490e610a.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>This has dramatically reduced the running time of the algorithm, by a factor of about 10. Although the function is fairly short, we may feel that the code is not easy to read. In particular, the overall idea of the algorithm can be lost in the implementation details. So we can consider the same algorithm, but where we call a helper function called <code>any.divisors</code> instead.</p>
<pre class="r"><code>source(&quot;generate-primes-3.R&quot;, keep.source=TRUE)
profvis(generate.primes.upto.3(10000))</code></pre>
<div class="profvis html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-3" style="width:100%;height:600px;"></div>
<script type="application/json" data-for="htmlwidget-3">{"x":{"message":{"prof":{"time":[1,1,2,2,2,2,2,2,2,3,3,4,4,5,5,6,6,7,7,7,7,7,7,8,8,8,8,8,8,8,9,9,10,10,11,11,12,12,13,13,13,13,13,13,13,14,14,14,14,14,14,14,15,15,16,16,16,16,16,16,16],"depth":[2,1,7,6,5,4,3,2,1,2,1,2,1,2,1,2,1,6,5,4,3,2,1,7,6,5,4,3,2,1,2,1,2,1,2,1,2,1,7,6,5,4,3,2,1,7,6,5,4,3,2,1,2,1,7,6,5,4,3,2,1],"label":["%%","local","if (i %% j == 0) {","any.divisors","generate.primes.upto.3","eval","eval","eval.parent","local","%%","local","c","local","%%","local","%%","local","if (!any.divisors(i, primes)) {","generate.primes.upto.3","eval","eval","eval.parent","local","for (j in ps) {","any.divisors","generate.primes.upto.3","eval","eval","eval.parent","local","%%","local","c","local","c","local","c","local","if (i %% j == 0) {","any.divisors","generate.primes.upto.3","eval","eval","eval.parent","local","if (i %% j == 0) {","any.divisors","generate.primes.upto.3","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","any.divisors","generate.primes.upto.3","eval","eval","eval.parent","local"],"filenum":[1,null,1,1,null,null,null,null,null,1,null,1,null,1,null,1,null,1,null,null,null,null,null,1,1,null,null,null,null,null,1,null,1,null,1,null,1,null,1,1,null,null,null,null,null,1,1,null,null,null,null,null,1,null,1,1,null,null,null,null,null],"linenum":[3,null,3,13,null,null,null,null,null,3,null,14,null,3,null,3,null,13,null,null,null,null,null,2,13,null,null,null,null,null,3,null,14,null,14,null,14,null,3,13,null,null,null,null,null,3,13,null,null,null,null,null,3,null,3,13,null,null,null,null,null],"memalloc":[9.75002288818359,9.75002288818359,10.4935684204102,10.4935684204102,10.4935684204102,10.4935684204102,10.4935684204102,10.4935684204102,10.4935684204102,11.2702484130859,11.2702484130859,12.0541229248047,12.0541229248047,9.73651885986328,9.73651885986328,10.5438461303711,10.5438461303711,11.3714370727539,11.3714370727539,11.3714370727539,11.3714370727539,11.3714370727539,11.3714370727539,12.1956558227539,12.1956558227539,12.1956558227539,12.1956558227539,12.1956558227539,12.1956558227539,12.1956558227539,10.016731262207,10.016731262207,10.8477249145508,10.8477249145508,11.6251831054688,11.6251831054688,12.446907043457,12.446907043457,10.1929626464844,10.1929626464844,10.1929626464844,10.1929626464844,10.1929626464844,10.1929626464844,10.1929626464844,11.2626876831055,11.2626876831055,11.2626876831055,11.2626876831055,11.2626876831055,11.2626876831055,11.2626876831055,12.2455596923828,12.2455596923828,9.73670959472656,9.73670959472656,9.73670959472656,9.73670959472656,9.73670959472656,9.73670959472656,9.73670959472656],"meminc":[0,0,0.743545532226562,0,0,0,0,0,0,0.776679992675781,0,0.78387451171875,0,-2.31760406494141,0,0.807327270507812,0,0.827590942382812,0,0,0,0,0,0.82421875,0,0,0,0,0,0,-2.17892456054688,0,0.83099365234375,0,0.777458190917969,0,0.821723937988281,0,-2.25394439697266,0,0,0,0,0,0,1.06972503662109,0,0,0,0,0,0,0.982872009277344,0,-2.50885009765625,0,0,0,0,0,0],"filename":["generate-primes-3.R",null,"generate-primes-3.R","generate-primes-3.R",null,null,null,null,null,"generate-primes-3.R",null,"generate-primes-3.R",null,"generate-primes-3.R",null,"generate-primes-3.R",null,"generate-primes-3.R",null,null,null,null,null,"generate-primes-3.R","generate-primes-3.R",null,null,null,null,null,"generate-primes-3.R",null,"generate-primes-3.R",null,"generate-primes-3.R",null,"generate-primes-3.R",null,"generate-primes-3.R","generate-primes-3.R",null,null,null,null,null,"generate-primes-3.R","generate-primes-3.R",null,null,null,null,null,"generate-primes-3.R",null,"generate-primes-3.R","generate-primes-3.R",null,null,null,null,null]},"interval":10,"files":[{"filename":"generate-primes-3.R","content":"any.divisors <- function(i, ps) {\n  for (j in ps) {\n    if (i %% j == 0) {\n      return(TRUE)\n    }\n  }\n  return(FALSE)\n}\n\ngenerate.primes.upto.3 <- function(N) {\n  primes <- 2\n  for (i in 3:N) {\n    if (!any.divisors(i, primes)) {\n      primes <- c(primes,i)\n    }\n  }\n  return(primes)\n}\n","normpath":"/Users/runner/work/sc1/sc1/content/profile-debug/generate-primes-3.R"}],"prof_output":"/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T//Rtmp1UAYHA/file2248507db039.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>It seems reasonable to say that the third version of the algorithm is easier to understand. Moreover, there is little to no performance penalty.</p>
</div>
<div id="the-sieve-of-eratosthenes" class="section level2">
<h2>The Sieve of Eratosthenes</h2>
<p>A more computationally efficient approach is the <a href="https://en.wikipedia.org/wiki/Sieve_of_Eratosthenes">Sieve of Eratosthenes</a>. In this approach, one does not check whether each number is prime by checking divisors. Instead, one starts with a list of numbers from <span class="math inline">\(1\)</span> to <span class="math inline">\(N\)</span> and successively marks all multiples of each prime, in order, as composite. To identify the next prime after <span class="math inline">\(2\)</span> for marking multiples, one simply needs to find the next number not marked composite.</p>
<p>This approach is so much faster, that we consider finding all primes up to <span class="math inline">\(1000000\)</span> instead of up to <span class="math inline">\(10000\)</span>.</p>
<pre class="r"><code>source(&quot;sieve-1.R&quot;, keep.source=TRUE)
profvis(sieve.1(1000000))</code></pre>
<div class="profvis html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-4" style="width:100%;height:600px;"></div>
<script type="application/json" data-for="htmlwidget-4">{"x":{"message":{"prof":{"time":[1,1,1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,6,6,6,6,6,6,7,7,7,7,7,7,8,8,8,8,8,8,9,9,9,9,9,9,10,10,10,10,10,10,11,11,11,11,11,11,12,12,12,12,12,12,13,13,13,13,13,13,14,14,14,14,14,14,15,15,15,15,15,15,16,16,16,16,16,16,17,17,17,17,17,17,18,18,18,18,18,18,19,19,19,19,19,19,20,20,20,20,20,20,21,21,21,21,21,21,22,22,22,22,22,22,23,23,23,23,23,23,24,24,24,24,24,24],"depth":[6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1],"label":["candidates <- rep(TRUE,N)","sieve.1","eval","eval","eval.parent","local","while (s <= N) {","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","s <- s + i","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","s <- s + i","sieve.1","eval","eval","eval.parent","local","while (s <= N) {","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","while (s <= N) {","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","s <- s + i","sieve.1","eval","eval","eval.parent","local","if (candidates[i]) {","sieve.1","eval","eval","eval.parent","local","if (candidates[i]) {","sieve.1","eval","eval","eval.parent","local","if (candidates[i]) {","sieve.1","eval","eval","eval.parent","local"],"filenum":[1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null],"linenum":[2,null,null,null,null,null,8,null,null,null,null,null,9,null,null,null,null,null,9,null,null,null,null,null,9,null,null,null,null,null,9,null,null,null,null,null,10,null,null,null,null,null,9,null,null,null,null,null,10,null,null,null,null,null,8,null,null,null,null,null,9,null,null,null,null,null,9,null,null,null,null,null,9,null,null,null,null,null,9,null,null,null,null,null,8,null,null,null,null,null,9,null,null,null,null,null,9,null,null,null,null,null,9,null,null,null,null,null,9,null,null,null,null,null,9,null,null,null,null,null,10,null,null,null,null,null,5,null,null,null,null,null,5,null,null,null,null,null,5,null,null,null,null,null],"memalloc":[13.5082321166992,13.5082321166992,13.5082321166992,13.5082321166992,13.5082321166992,13.5082321166992,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555,13.5082931518555],"meminc":[0,0,0,0,0,0,6.103515625e-05,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"filename":["sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null]},"interval":10,"files":[{"filename":"sieve-1.R","content":"sieve.1 <- function(N) {\n  candidates <- rep(TRUE,N)\n  candidates[1] <- FALSE\n  for (i in 2:N) {\n    if (candidates[i]) {\n      # i is prime\n      s <- i*2\n      while (s <= N) {\n        candidates[s] <- FALSE\n        s <- s + i\n      }\n    }\n  }\n  return((1:N)[candidates])\n}\n","normpath":"/Users/runner/work/sc1/sc1/content/profile-debug/sieve-1.R"}],"prof_output":"/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T//Rtmp1UAYHA/file22482a7c3ce3.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>We see that most of the time is spent in lines 8–10, which correspond to marking <code>s</code> as composite and incrementing <code>s</code> by the current prime. We can remove some of these computations by noticing that if <span class="math inline">\(i\)</span> is prime then all multiples <span class="math inline">\(2i,3i,\ldots,(i-1)i\)</span> will already have been marked as composite. It follows that one can also stop “sieving” as soon as <span class="math inline">\(i &gt; \sqrt{N}\)</span>.</p>
<pre class="r"><code>source(&quot;sieve-2.R&quot;, keep.source=TRUE)
profvis(sieve.2(1000000))</code></pre>
<div class="profvis html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-5" style="width:100%;height:600px;"></div>
<script type="application/json" data-for="htmlwidget-5">{"x":{"message":{"prof":{"time":[1,1,1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,6,6,6,6,6,6,7,7,7,7,7,7,8,8,8,8,8,8,9,9,9,9,9,9,10,10,10,10,10,10,11,11,11,11,11,11,12,12,12,12,12,12,13,13,13,13,13,13,14,14,14,14,14,14,15,15,15,15,15,15],"depth":[6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1],"label":["candidates <- rep(TRUE,N)","sieve.2","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.2","eval","eval","eval.parent","local","s <- s + i","sieve.2","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.2","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.2","eval","eval","eval.parent","local","s <- s + i","sieve.2","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.2","eval","eval","eval.parent","local","s <- s + i","sieve.2","eval","eval","eval.parent","local","while (s <= N) {","sieve.2","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.2","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.2","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.2","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.2","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.2","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.2","eval","eval","eval.parent","local"],"filenum":[1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null],"linenum":[2,null,null,null,null,null,10,null,null,null,null,null,11,null,null,null,null,null,10,null,null,null,null,null,10,null,null,null,null,null,11,null,null,null,null,null,10,null,null,null,null,null,11,null,null,null,null,null,9,null,null,null,null,null,10,null,null,null,null,null,10,null,null,null,null,null,10,null,null,null,null,null,10,null,null,null,null,null,10,null,null,null,null,null,10,null,null,null,null,null],"memalloc":[13.522346496582,13.522346496582,13.522346496582,13.522346496582,13.522346496582,13.522346496582,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328,13.5224151611328],"meminc":[0,0,0,0,0,0,6.866455078125e-05,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"filename":["sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null]},"interval":10,"files":[{"filename":"sieve-2.R","content":"sieve.2 <- function(N) {\n  candidates <- rep(TRUE,N)\n  candidates[1] <- FALSE\n  sqrt.N <- sqrt(N)\n  for (i in 2:sqrt.N) {\n    if (candidates[i]) {\n      # i is prime\n      s <- i*i\n      while (s <= N) {\n        candidates[s] <- FALSE\n        s <- s + i\n      }\n    }\n  }\n  return((1:N)[candidates])\n}\n","normpath":"/Users/runner/work/sc1/sc1/content/profile-debug/sieve-2.R"}],"prof_output":"/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T//Rtmp1UAYHA/file224840196295.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>There appears to be a moderate improvement in performance for this size of problem. We notice that a substantial amount of time is spent in the <code>while</code> loop, which mainly involves incrementing <code>s</code> and flagging the corresponding number as composite. We can vectorize this computation and separate it cleanly from the rest of the algorithm, as follows.</p>
<pre class="r"><code>source(&quot;sieve-3.R&quot;, keep.source=TRUE)
profvis(sieve.3(1000000))</code></pre>
<div class="profvis html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-6" style="width:100%;height:600px;"></div>
<script type="application/json" data-for="htmlwidget-6">{"x":{"message":{"prof":{"time":[1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,6,6,7,7,7,7,7,7,7],"depth":[7,6,5,4,3,2,1,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,7,6,5,4,3,2,1],"label":["seq.default","get.multiples","sieve.3","eval","eval","eval.parent","local","constantFoldCall","constantFold","cmp","h","tryInline","cmpCall","cmp","h","tryInline","cmpCall","cmp","genCode","cmpfun","compiler:::tryCmpfun","eval","eval","eval.parent","local","candidates[multiples] <- FALSE","sieve.3","eval","eval","eval.parent","local","candidates[multiples] <- FALSE","sieve.3","eval","eval","eval.parent","local","candidates[multiples] <- FALSE","sieve.3","eval","eval","eval.parent","local","length","local","<GC>","return((1:N)[candidates])","sieve.3","eval","eval","eval.parent","local"],"filenum":[null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,null,null,null,1,null,null,null,null,null],"linenum":[null,14,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,14,null,null,null,null,15,null,null,null,null,null,15,null,null,null,null,null,15,null,null,null,null,null,null,null,null,18,null,null,null,null,null],"memalloc":[19.2344970703125,19.2344970703125,19.2344970703125,19.2344970703125,19.2344970703125,19.2344970703125,19.2344970703125,25.0634002685547,25.0634002685547,25.0634002685547,25.0634002685547,25.0634002685547,25.0634002685547,25.0634002685547,25.0634002685547,25.0634002685547,25.0634002685547,25.0634002685547,25.0634002685547,25.0634002685547,25.0634002685547,25.0634002685547,25.0634002685547,25.0634002685547,25.0634002685547,32.7500686645508,32.7500686645508,32.7500686645508,32.7500686645508,32.7500686645508,32.7500686645508,42.6788177490234,42.6788177490234,42.6788177490234,42.6788177490234,42.6788177490234,42.6788177490234,51.6251907348633,51.6251907348633,51.6251907348633,51.6251907348633,51.6251907348633,51.6251907348633,60.7744827270508,60.7744827270508,21.6254959106445,21.6254959106445,21.6254959106445,21.6254959106445,21.6254959106445,21.6254959106445,21.6254959106445],"meminc":[0,0,0,0,0,0,0,5.82890319824219,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7.68666839599609,0,0,0,0,0,9.92874908447266,0,0,0,0,0,8.94637298583984,0,0,0,0,0,9.1492919921875,0,-39.1489868164062,0,0,0,0,0,0],"filename":[null,"sieve-3.R",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"sieve-3.R",null,null,null,null,"sieve-3.R",null,null,null,null,null,"sieve-3.R",null,null,null,null,null,"sieve-3.R",null,null,null,null,null,null,null,null,"sieve-3.R",null,null,null,null,null]},"interval":10,"files":[{"filename":"sieve-3.R","content":"get.multiples <- function(i, N) {\n  n <- floor(N/i) - i\n  if (n <= 0) return(NULL)\n  multiples <- seq(i*i,(i+n)*i,i)\n  return(multiples)\n}\n\nsieve.3 <- function(N) {\n  candidates <- rep(TRUE,N)\n  candidates[1] <- FALSE\n  sqrt.N <- sqrt(N)\n  for (i in 2:sqrt.N) {\n    if (candidates[i]) {\n      multiples <- get.multiples(i, N)\n      candidates[multiples] <- FALSE\n    }\n  }\n  return((1:N)[candidates])\n}\n","normpath":"/Users/runner/work/sc1/sc1/content/profile-debug/sieve-3.R"}],"prof_output":"/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T//Rtmp1UAYHA/file22485938048c.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>This gives another improvement to performance. It is worth noting that creating an array of multiples is faster than iterating through multiples in R, because the cost of allocating memory is negligible in comparison to the benefit of eliminating the loop. In a programming language such as C, the reverse is often true, as allocating memory is typically expensive in comparison to iteration once compiled into machine code.</p>
</div>
<div id="comments" class="section level2">
<h2>Comments</h2>
<p>Profiling in this scenario is already quite useful, as one can see which parts of the code are critical for performance. In larger applications, profiling is even more useful as one can quickly determine which functions are the most important from a performance perspective: if 1% of computation time is spent in a particular function, very little improvement can be derived by improving it, whereas if 99% of computation time is spent in a function one can conceivably improve performance very substantially by accelerating the implementation or improving the corresponding algorithm itself.</p>
<p>Profiling is also helpful for maintaining code readability and modularity: in some cases performance can be improved by sacrificing readability, or modularity of the code. Doing so can make sense if the code is critical to performance, but it makes little sense when the code is unimportant from a performance perspective.</p>
<p>Finally, when profiling code and trying to improve its performance, good testing tools are very useful for ensuring that any improvement in performance has not come at the cost of breaking existing functionality, including in rare, corner cases.</p>
</div>



  <footer>
  

<script src="//yihui.name/js/math-code.js"></script>
<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<script async src="//yihui.name/js/center-img.js"></script>


<script type="text/javascript">
var sc_project=12110974;
var sc_invisible=1;
var sc_security="9b171880";
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="https://statcounter.com/" target="_blank"><img
class="statcounter"
src="https://c.statcounter.com/12110974/0/9b171880/1/"
alt="Web Analytics"></a></div></noscript>








  


<p align=right>

<a href='https://github.com/awllee/sc1/blob/master/content/profile-debug/profile.Rmd'>View source</a>

|

<a href='https://github.com/awllee/sc1/edit/master/content/profile-debug/profile.Rmd'>Edit source</a>

</p>





<script src="https://utteranc.es/client.js"
        repo="awllee/sc1"
        issue-term="pathname"
        label="utterance"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>



  



<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>



<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/tex.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



  
  <hr>
  <div class="copyright">© 2020 <a href="https://sites.google.com/view/anthonylee">Anthony Lee</a>, <a href="http://www.bristol.ac.uk/maths/people/feng-yu/index.html">Feng Yu</a>, <a href="https://people.maths.bris.ac.uk/~tk18582/">Tobias Kley</a>, <a href="https://mfasiolo.github.io/">Matteo Fasiolo</a></div>
  
  </footer>
  </article>
  
  </body>
</html>

