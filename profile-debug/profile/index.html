<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Profiling - SC1</title>
    <meta property="og:title" content="Profiling - SC1">
    
    <meta name="twitter:card" content="summary">

    
      
    

    
      
      <meta property="description" content="Profiling in R is fairly straightforward using the profvis package, which builds upon base R’s Rprof functionality.
library(profvis) This is a statistical profiler: it operates by regularly (e.g. &amp;hellip;">
      <meta property="og:description" content="Profiling in R is fairly straightforward using the profvis package, which builds upon base R’s Rprof functionality.
library(profvis) This is a statistical profiler: it operates by regularly (e.g. &amp;hellip;">
      
    

    
    

    

    
    


<link href='//cdn.bootcss.com/highlight.js/9.12.0/styles/github.min.css' rel='stylesheet' type='text/css' />



    <link rel="stylesheet" href="/sc1/css/style.css" />
    <link rel="stylesheet" href="/sc1/css/fonts.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Arvo">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Marcellus">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro">

<link rel="stylesheet" href="/sc1/css/custom.css" />

<link rel="icon" href="/sc1/favicon.ico" type="image/x-icon" />























<nav class="breadcrumbs">
    
        <a href="https://awllee.github.io/sc1/">home / </a>
    
        <a href="https://awllee.github.io/sc1/profile-debug/">profile-debug / </a>
    
        <a href="https://awllee.github.io/sc1/profile-debug/profile/">profile / </a>
    
</nav>

  </head>

  
  <body class="sc1">
    <header class="masthead">
      <h1><a href="/sc1/">SC1</a></h1>

<p class="tagline">Statistical Computing 1</p>

      <nav class="menu">
  <input id="menu-check" type="checkbox" />
  <label id="menu-label" for="menu-check" class="unselectable">
    <span class="icon close-icon">✕</span>
    <span class="icon open-icon">☰</span>
    <span class="text">Menu</span>
  </label>
  <ul>
  
  
  <li><a href="/sc1/">Home</a></li>
  
  <li><a href="/sc1/intro-r/">Intro to R</a></li>
  
  <li><a href="/sc1/reproducibility/">Reproducibility</a></li>
  
  <li><a href="/sc1/common-r/">Common R</a></li>
  
  <li><a href="/sc1/tidyverse/">Tidyverse</a></li>
  
  <li><a href="/sc1/packages/">Packages</a></li>
  
  <li><a href="/sc1/functional-oo/">Functional / OO</a></li>
  
  <li><a href="/sc1/profile-debug/">Performance / Bugs</a></li>
  
  <li><a href="/sc1/matrices/">Matrices</a></li>
  
  <li><a href="/sc1/optimization/">Optimization</a></li>
  
  <li><a href="/sc1/integration/">Integration</a></li>
  
  
  </ul>
</nav>

    </header>

    <article class="main">
      <header class="title">
      
<h1>Profiling</h1>

<h3>
</h3>
<hr>


      </header>




<script src="/sc1/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/sc1/rmarkdown-libs/jquery/jquery.min.js"></script>
<script src="/sc1/rmarkdown-libs/d3/d3.min.js"></script>
<link href="/sc1/rmarkdown-libs/profvis/profvis.css" rel="stylesheet" />
<script src="/sc1/rmarkdown-libs/profvis/profvis.js"></script>
<script src="/sc1/rmarkdown-libs/profvis/scroll.js"></script>
<link href="/sc1/rmarkdown-libs/highlight/textmate.css" rel="stylesheet" />
<script src="/sc1/rmarkdown-libs/highlight/highlight.js"></script>
<script src="/sc1/rmarkdown-libs/profvis-binding/profvis.js"></script>

<div id="TOC">
<ul>
<li><a href="#updating-a-list-of-primes">Updating a list of primes</a></li>
<li><a href="#the-sieve-of-eratosthenes">The Sieve of Eratosthenes</a></li>
<li><a href="#comments">Comments</a></li>
</ul>
</div>

<p><a href="https://en.wikipedia.org/wiki/Profiling_(computer_programming)">Profiling</a> in R is fairly straightforward using the <a href="https://rstudio.github.io/profvis/"><code>profvis</code></a> package, which builds upon base R’s <code>Rprof</code> functionality.</p>
<pre class="r"><code>library(profvis)</code></pre>
<p>This is a <em>statistical profiler</em>: it operates by regularly (e.g. every few milliseconds) using operating system interrupts to determine what code is being executed. This enables one to build a picture of where the computation is spending most of its time, and is essentially an application of the Monte Carlo method. Although the results are not deterministic, the profiling operation adds very little overhead to the computation.</p>
<p>Statistical profilers can be viewed in contrast to <em>instrumenting profilers</em> of various flavours, which often involve incrementing counters whenever certain events occur. This often involves instrumenting existing code by adding instructions to increment the counters either manually or automatically. For example, incrementing a counter whenever a function is called. Instrumenting profilers can provide very accurate results, but can add substantial overhead to the computation. These tools can be important not only for understanding performance, but also for checking the validity and robustness of code: for example, <a href="https://en.wikipedia.org/wiki/Valgrind">Valgrind</a> is often used in C code to detect memory leaks and memory reference errors.</p>
<p>We consider here profiling various R functions for generating an array of all primes less than or equal to some number.</p>
<div id="updating-a-list-of-primes" class="section level2">
<h2>Updating a list of primes</h2>
<p>A straightforward approach to generating all prime numbers less than some number <span class="math inline">\(N\)</span> is to iterate through the numbers <span class="math inline">\(3,\ldots,N\)</span> and add the current number to the list of primes if there is no divisor of that number in the current list of primes.</p>
<p>In the following, we profile 3 variants of this approach. The first variant is a very inefficient implementation.</p>
<pre class="r"><code>source(&quot;generate-primes-1.R&quot;, keep.source=TRUE)
profvis(generate.primes.upto.1(10000))</code></pre>
<div id="htmlwidget-1" style="width:100%;height:600px;" class="profvis html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"message":{"prof":{"time":[1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,6,6,7,7,7,7,7,7,8,8,8,8,8,8,8,9,9,10,10,11,11,11,11,11,11,12,12,12,12,12,12,13,13,13,13,13,13,14,14,14,14,14,14,15,15,15,15,15,15,16,16,16,17,17,18,18,18,18,18,18,19,19,20,20,20,20,20,20,21,21,21,21,21,21,22,22,22,22,22,22,23,23,24,24,25,25,25,25,25,25,26,26,26,26,26,26,27,27,27,27,27,27,28,28,28,28,28,28,28,29,29,30,30,31,31,32,32,32,32,32,32,33,33,34,34,35,35,35,35,35,35,36,36,37,37,37,37,37,37,38,38,38,38,38,38,39,39,39,39,39,39,39,40,40,41,41,41,41,41,41,42,42,42,43,43,44,44,45,45,46,46,46,46,46,46,46,47,47,48,48,48,48,48,48,48,49,49,49,49,49,49,50,50,50,50,50,50,51,51,52,52,53,53,54,54,54,54,54,54,55,55,55,55,55,55,56,56,56,56,56,56,57,57,57,57,57,57,57,58,58,58,58,58,58,59,59,59,59,59,59,60,60,61,61,61,61,61,61,62,62,62,62,62,62,63,63,64,64,65,65,65,65,65,65,66,66,66,66,66,66,67,67,68,68,68,68,68,68,68,69,69,69,69,69,69,70,70,70,71,71,71,71,71,71,72,72,73,73,73,73,73,73,74,74,75,75,76,76,77,77,77,77,77,77,78,78,78,78,78,78,79,79,80,80,81,81,81,81,81,81,82,82,82,82,82,82,82,83,83,83,83,83,83,84,84,84,84,84,84,85,85,86,86,87,87,88,88,88,88,88,88,88,89,89,89,89,89,89,90,90,90,90,90,90,90,91,91,91,91,91,91,92,92,92,92,92,92,93,93,94,94,95,95,95,95,95,95,96,96,96,96,96,96,97,97,98,98,98,98,98,98,99,99,100,100,100,100,100,100,101,101,101,101,101,101,102,102,102,103,103,103,103,103,103,104,104,105,105,105,105,105,105,106,106,107,107,108,108,108,109,109,109,110,110,110,110,110,110,111,111,112,112,112,112,112,112,113,113,114,114,114,114,114,114,115,115,115,115,115,115,116,116,116,116,116,116,116,117,117,117,117,117,117,118,118,118,118,118,118,119,119,119,119,119,119,120,120,121,121,121,121,121,121,122,122,122,122,122,122,123,123,124,124,124,124,124,124,125,125],"depth":[2,1,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,7,6,5,4,3,2,1,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,3,2,1,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,7,6,5,4,3,2,1,2,1,2,1,2,1,6,5,4,3,2,1,2,1,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,7,6,5,4,3,2,1,2,1,6,5,4,3,2,1,3,2,1,2,1,2,1,2,1,7,6,5,4,3,2,1,2,1,7,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,7,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,7,6,5,4,3,2,1,6,5,4,3,2,1,3,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,2,1,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,2,1,6,5,4,3,2,1,7,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,2,1,2,1,7,6,5,4,3,2,1,6,5,4,3,2,1,7,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,3,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,2,1,2,1,3,2,1,3,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,7,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,2,1],"label":["lazyLoadDBfetch","local","tryInline","cmpCall","cmp","h","tryInline","cmpCall","cmp","cmpForBody","h","tryInline","cmpCall","cmp","h","tryInline","cmpCall","cmp","cmpForBody","h","tryInline","cmpCall","cmp","h","tryInline","cmpCall","cmp","genCode","cmpfun","compiler:::tryCmpfun","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","c","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","c","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","%%","local","%%","local","%%","local","%%","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","c","local","c","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","%%","local","%%","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","for (j in primes) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","%%","local","if (i %% j == 0) {","%%","local","if (i %% j == 0) {","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local"],"filenum":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,1,null,1,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,1,null,1,null,null,null,null,null,1,null,1,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,1,null,1,null,1,null,1,null,null,1,null,null,null,null,null,1,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,1,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,1,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,1,null,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,1,null,null,1,null,null,null,null,null,1,null,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,1,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,1,null,1,1,null,1,1,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null],"linenum":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,6,null,6,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,null,6,null,null,null,null,null,6,null,10,null,6,null,6,null,null,null,null,null,6,null,6,null,6,null,null,null,null,null,10,null,6,null,null,null,null,null,6,null,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,6,6,null,6,null,6,null,6,null,null,6,null,null,null,null,null,6,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,10,null,10,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,6,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,6,null,6,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,6,null,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,6,null,null,6,null,null,null,null,null,6,null,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,6,6,null,6,null,null,null,null,null,6,null,5,null,null,null,null,null,6,null,6,null,6,6,null,6,6,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,6,null],"memalloc":[9.96026611328125,9.96026611328125,10.8335800170898,10.8335800170898,10.8335800170898,10.8335800170898,10.8335800170898,10.8335800170898,10.8335800170898,10.8335800170898,10.8335800170898,10.8335800170898,10.8335800170898,10.8335800170898,10.8335800170898,10.8335800170898,10.8335800170898,10.8335800170898,10.8335800170898,10.8335800170898,10.8335800170898,10.8335800170898,10.8335800170898,10.8335800170898,10.8335800170898,10.8335800170898,10.8335800170898,10.8335800170898,10.8335800170898,10.8335800170898,10.8335800170898,10.8335800170898,10.8335800170898,10.8335800170898,11.4425964355469,11.4425964355469,11.4425964355469,11.4425964355469,11.4425964355469,11.4425964355469,12.0597991943359,12.0597991943359,12.0597991943359,12.0597991943359,12.0597991943359,12.0597991943359,12.6777877807617,12.6777877807617,12.6777877807617,12.6777877807617,12.6777877807617,12.6777877807617,7.87127685546875,7.87127685546875,8.84886169433594,8.84886169433594,8.84886169433594,8.84886169433594,8.84886169433594,8.84886169433594,9.43289947509766,9.43289947509766,9.43289947509766,9.43289947509766,9.43289947509766,9.43289947509766,9.43289947509766,8.20112609863281,8.20112609863281,9.07158660888672,9.07158660888672,7.74890899658203,7.74890899658203,7.74890899658203,7.74890899658203,7.74890899658203,7.74890899658203,8.56182098388672,8.56182098388672,8.56182098388672,8.56182098388672,8.56182098388672,8.56182098388672,9.35012054443359,9.35012054443359,9.35012054443359,9.35012054443359,9.35012054443359,9.35012054443359,7.99965667724609,7.99965667724609,7.99965667724609,7.99965667724609,7.99965667724609,7.99965667724609,8.84667205810547,8.84667205810547,8.84667205810547,8.84667205810547,8.84667205810547,8.84667205810547,7.58834075927734,7.58834075927734,7.58834075927734,8.46453094482422,8.46453094482422,9.26880645751953,9.26880645751953,9.26880645751953,9.26880645751953,9.26880645751953,9.26880645751953,7.97810363769531,7.97810363769531,8.84180450439453,8.84180450439453,8.84180450439453,8.84180450439453,8.84180450439453,8.84180450439453,7.59074401855469,7.59074401855469,7.59074401855469,7.59074401855469,7.59074401855469,7.59074401855469,8.47238159179688,8.47238159179688,8.47238159179688,8.47238159179688,8.47238159179688,8.47238159179688,9.36359405517578,9.36359405517578,8.12857818603516,8.12857818603516,8.99965667724609,8.99965667724609,8.99965667724609,8.99965667724609,8.99965667724609,8.99965667724609,7.72991943359375,7.72991943359375,7.72991943359375,7.72991943359375,7.72991943359375,7.72991943359375,8.58834075927734,8.58834075927734,8.58834075927734,8.58834075927734,8.58834075927734,8.58834075927734,9.42021179199219,9.42021179199219,9.42021179199219,9.42021179199219,9.42021179199219,9.42021179199219,9.42021179199219,8.31560516357422,8.31560516357422,9.3475341796875,9.3475341796875,8.19725799560547,8.19725799560547,9.06685638427734,9.06685638427734,9.06685638427734,9.06685638427734,9.06685638427734,9.06685638427734,7.83112335205078,7.83112335205078,9.07271575927734,9.07271575927734,7.85911560058594,7.85911560058594,7.85911560058594,7.85911560058594,7.85911560058594,7.85911560058594,8.93982696533203,8.93982696533203,7.77976989746094,7.77976989746094,7.77976989746094,7.77976989746094,7.77976989746094,7.77976989746094,8.66538238525391,8.66538238525391,8.66538238525391,8.66538238525391,8.66538238525391,8.66538238525391,9.43956756591797,9.43956756591797,9.43956756591797,9.43956756591797,9.43956756591797,9.43956756591797,9.43956756591797,8.44143676757812,8.44143676757812,9.32341766357422,9.32341766357422,9.32341766357422,9.32341766357422,9.32341766357422,9.32341766357422,8.11361694335938,8.11361694335938,8.11361694335938,9.03492736816406,9.03492736816406,7.82136535644531,7.82136535644531,8.71738433837891,8.71738433837891,9.46389770507812,9.46389770507812,9.46389770507812,9.46389770507812,9.46389770507812,9.46389770507812,9.46389770507812,9.24619293212891,9.24619293212891,7.45489501953125,7.45489501953125,7.45489501953125,7.45489501953125,7.45489501953125,7.45489501953125,7.45489501953125,8.24412536621094,8.24412536621094,8.24412536621094,8.24412536621094,8.24412536621094,8.24412536621094,9.35100555419922,9.35100555419922,9.35100555419922,9.35100555419922,9.35100555419922,9.35100555419922,8.18087768554688,8.18087768554688,9.10305023193359,9.10305023193359,8.05470275878906,8.05470275878906,8.96318817138672,8.96318817138672,8.96318817138672,8.96318817138672,8.96318817138672,8.96318817138672,7.75629425048828,7.75629425048828,7.75629425048828,7.75629425048828,7.75629425048828,7.75629425048828,8.65280914306641,8.65280914306641,8.65280914306641,8.65280914306641,8.65280914306641,8.65280914306641,9.42879486083984,9.42879486083984,9.42879486083984,9.42879486083984,9.42879486083984,9.42879486083984,9.42879486083984,8.30703735351562,8.30703735351562,8.30703735351562,8.30703735351562,8.30703735351562,8.30703735351562,9.21379852294922,9.21379852294922,9.21379852294922,9.21379852294922,9.21379852294922,9.21379852294922,7.97824096679688,7.97824096679688,8.72600555419922,8.72600555419922,8.72600555419922,8.72600555419922,8.72600555419922,8.72600555419922,7.50884246826172,7.50884246826172,7.50884246826172,7.50884246826172,7.50884246826172,7.50884246826172,8.40129852294922,8.40129852294922,9.29877471923828,9.29877471923828,8.97492218017578,8.97492218017578,8.97492218017578,8.97492218017578,8.97492218017578,8.97492218017578,7.76132965087891,7.76132965087891,7.76132965087891,7.76132965087891,7.76132965087891,7.76132965087891,8.6990966796875,8.6990966796875,9.45240783691406,9.45240783691406,9.45240783691406,9.45240783691406,9.45240783691406,9.45240783691406,9.45240783691406,8.39990997314453,8.39990997314453,8.39990997314453,8.39990997314453,8.39990997314453,8.39990997314453,7.52268981933594,7.52268981933594,7.52268981933594,8.37543487548828,8.37543487548828,8.37543487548828,8.37543487548828,8.37543487548828,8.37543487548828,9.2515869140625,9.2515869140625,7.98410797119141,7.98410797119141,7.98410797119141,7.98410797119141,7.98410797119141,7.98410797119141,8.86649322509766,8.86649322509766,7.639404296875,7.639404296875,8.46231842041016,8.46231842041016,9.32334899902344,9.32334899902344,9.32334899902344,9.32334899902344,9.32334899902344,9.32334899902344,8.12427520751953,8.12427520751953,8.12427520751953,8.12427520751953,8.12427520751953,8.12427520751953,9.05402374267578,9.05402374267578,7.822509765625,7.822509765625,8.73237609863281,8.73237609863281,8.73237609863281,8.73237609863281,8.73237609863281,8.73237609863281,9.49048614501953,9.49048614501953,9.49048614501953,9.49048614501953,9.49048614501953,9.49048614501953,9.49048614501953,8.42116546630859,8.42116546630859,8.42116546630859,8.42116546630859,8.42116546630859,8.42116546630859,9.31974029541016,9.31974029541016,9.31974029541016,9.31974029541016,9.31974029541016,9.31974029541016,8.14118957519531,8.14118957519531,9.04824066162109,9.04824066162109,8.38904571533203,8.38904571533203,9.50946807861328,9.50946807861328,9.50946807861328,9.50946807861328,9.50946807861328,9.50946807861328,9.50946807861328,8.45128631591797,8.45128631591797,8.45128631591797,8.45128631591797,8.45128631591797,8.45128631591797,9.51063537597656,9.51063537597656,9.51063537597656,9.51063537597656,9.51063537597656,9.51063537597656,9.51063537597656,8.43135833740234,8.43135833740234,8.43135833740234,8.43135833740234,8.43135833740234,8.43135833740234,9.34613037109375,9.34613037109375,9.34613037109375,9.34613037109375,9.34613037109375,9.34613037109375,8.11866760253906,8.11866760253906,9.00853729248047,9.00853729248047,7.66130828857422,7.66130828857422,7.66130828857422,7.66130828857422,7.66130828857422,7.66130828857422,8.42976379394531,8.42976379394531,8.42976379394531,8.42976379394531,8.42976379394531,8.42976379394531,9.33769226074219,9.33769226074219,8.21311187744141,8.21311187744141,8.21311187744141,8.21311187744141,8.21311187744141,8.21311187744141,7.51052093505859,7.51052093505859,8.42488098144531,8.42488098144531,8.42488098144531,8.42488098144531,8.42488098144531,8.42488098144531,9.33951568603516,9.33951568603516,9.33951568603516,9.33951568603516,9.33951568603516,9.33951568603516,8.116943359375,8.116943359375,8.116943359375,9.03377532958984,9.03377532958984,9.03377532958984,9.03377532958984,9.03377532958984,9.03377532958984,7.79734039306641,7.79734039306641,8.57601928710938,8.57601928710938,8.57601928710938,8.57601928710938,8.57601928710938,8.57601928710938,7.97808074951172,7.97808074951172,8.83544158935547,8.83544158935547,7.61422729492188,7.61422729492188,7.61422729492188,8.52793121337891,8.52793121337891,8.52793121337891,9.44107818603516,9.44107818603516,9.44107818603516,9.44107818603516,9.44107818603516,9.44107818603516,8.22836303710938,8.22836303710938,9.12441253662109,9.12441253662109,9.12441253662109,9.12441253662109,9.12441253662109,9.12441253662109,7.94174194335938,7.94174194335938,8.83303070068359,8.83303070068359,8.83303070068359,8.83303070068359,8.83303070068359,8.83303070068359,8.57746124267578,8.57746124267578,8.57746124267578,8.57746124267578,8.57746124267578,8.57746124267578,9.49378204345703,9.49378204345703,9.49378204345703,9.49378204345703,9.49378204345703,9.49378204345703,9.49378204345703,8.35400390625,8.35400390625,8.35400390625,8.35400390625,8.35400390625,8.35400390625,9.2462158203125,9.2462158203125,9.2462158203125,9.2462158203125,9.2462158203125,9.2462158203125,8.34145355224609,8.34145355224609,8.34145355224609,8.34145355224609,8.34145355224609,8.34145355224609,9.24168395996094,9.24168395996094,8.03020477294922,8.03020477294922,8.03020477294922,8.03020477294922,8.03020477294922,8.03020477294922,8.93987274169922,8.93987274169922,8.93987274169922,8.93987274169922,8.93987274169922,8.93987274169922,8.63639068603516,8.63639068603516,7.79916381835938,7.79916381835938,7.79916381835938,7.79916381835938,7.79916381835938,7.79916381835938,8.68834686279297,8.68834686279297],"meminc":[0,0,0.873313903808594,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.609016418457031,0,0,0,0,0,0.617202758789062,0,0,0,0,0,0.617988586425781,0,0,0,0,0,-4.80651092529297,0,0.977584838867188,0,0,0,0,0,0.584037780761719,0,0,0,0,0,0,-1.23177337646484,0,0.870460510253906,0,-1.32267761230469,0,0,0,0,0,0.812911987304688,0,0,0,0,0,0.788299560546875,0,0,0,0,0,-1.3504638671875,0,0,0,0,0,0.847015380859375,0,0,0,0,0,-1.25833129882812,0,0,0.876190185546875,0,0.804275512695312,0,0,0,0,0,-1.29070281982422,0,0.863700866699219,0,0,0,0,0,-1.25106048583984,0,0,0,0,0,0.881637573242188,0,0,0,0,0,0.891212463378906,0,-1.23501586914062,0,0.871078491210938,0,0,0,0,0,-1.26973724365234,0,0,0,0,0,0.858421325683594,0,0,0,0,0,0.831871032714844,0,0,0,0,0,0,-1.10460662841797,0,1.03192901611328,0,-1.15027618408203,0,0.869598388671875,0,0,0,0,0,-1.23573303222656,0,1.24159240722656,0,-1.21360015869141,0,0,0,0,0,1.08071136474609,0,-1.16005706787109,0,0,0,0,0,0.885612487792969,0,0,0,0,0,0.774185180664062,0,0,0,0,0,0,-0.998130798339844,0,0.881980895996094,0,0,0,0,0,-1.20980072021484,0,0,0.921310424804688,0,-1.21356201171875,0,0.896018981933594,0,0.746513366699219,0,0,0,0,0,0,-0.217704772949219,0,-1.79129791259766,0,0,0,0,0,0,0.789230346679688,0,0,0,0,0,1.10688018798828,0,0,0,0,0,-1.17012786865234,0,0.922172546386719,0,-1.04834747314453,0,0.908485412597656,0,0,0,0,0,-1.20689392089844,0,0,0,0,0,0.896514892578125,0,0,0,0,0,0.775985717773438,0,0,0,0,0,0,-1.12175750732422,0,0,0,0,0,0.906761169433594,0,0,0,0,0,-1.23555755615234,0,0.747764587402344,0,0,0,0,0,-1.2171630859375,0,0,0,0,0,0.8924560546875,0,0.897476196289062,0,-0.3238525390625,0,0,0,0,0,-1.21359252929688,0,0,0,0,0,0.937767028808594,0,0.753311157226562,0,0,0,0,0,0,-1.05249786376953,0,0,0,0,0,-0.877220153808594,0,0,0.852745056152344,0,0,0,0,0,0.876152038574219,0,-1.26747894287109,0,0,0,0,0,0.88238525390625,0,-1.22708892822266,0,0.822914123535156,0,0.861030578613281,0,0,0,0,0,-1.19907379150391,0,0,0,0,0,0.92974853515625,0,-1.23151397705078,0,0.909866333007812,0,0,0,0,0,0.758110046386719,0,0,0,0,0,0,-1.06932067871094,0,0,0,0,0,0.898574829101562,0,0,0,0,0,-1.17855072021484,0,0.907051086425781,0,-0.659194946289062,0,1.12042236328125,0,0,0,0,0,0,-1.05818176269531,0,0,0,0,0,1.05934906005859,0,0,0,0,0,0,-1.07927703857422,0,0,0,0,0,0.914772033691406,0,0,0,0,0,-1.22746276855469,0,0.889869689941406,0,-1.34722900390625,0,0,0,0,0,0.768455505371094,0,0,0,0,0,0.907928466796875,0,-1.12458038330078,0,0,0,0,0,-0.702590942382812,0,0.914360046386719,0,0,0,0,0,0.914634704589844,0,0,0,0,0,-1.22257232666016,0,0,0.916831970214844,0,0,0,0,0,-1.23643493652344,0,0.778678894042969,0,0,0,0,0,-0.597938537597656,0,0.85736083984375,0,-1.22121429443359,0,0,0.913703918457031,0,0,0.91314697265625,0,0,0,0,0,-1.21271514892578,0,0.896049499511719,0,0,0,0,0,-1.18267059326172,0,0.891288757324219,0,0,0,0,0,-0.255569458007812,0,0,0,0,0,0.91632080078125,0,0,0,0,0,0,-1.13977813720703,0,0,0,0,0,0.8922119140625,0,0,0,0,0,-0.904762268066406,0,0,0,0,0,0.900230407714844,0,-1.21147918701172,0,0,0,0,0,0.90966796875,0,0,0,0,0,-0.303482055664062,0,-0.837226867675781,0,0,0,0,0,0.889183044433594,0],"filename":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R","generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R","generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R","generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R","generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R","generate-primes-1.R",null,"generate-primes-1.R","generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null]},"interval":10,"files":[{"filename":"generate-primes-1.R","content":"generate.primes.upto.1 <- function(N) {\n  primes <- 2\n  for (i in 3:N) {\n    found.divisor <- FALSE\n    for (j in primes) {\n      if (i %% j == 0) {\n        found.divisor <- TRUE\n      }\n    }\n    if (!found.divisor) primes <- c(primes,i)\n  }\n  return(primes)\n}\n","normpath":"/Users/runner/work/sc1/sc1/content/profile-debug/generate-primes-1.R"}],"prof_output":"/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T//RtmpNet2kv/file6abb18983e7d.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>We see from the <code>profvis</code> results that most of the time is spent in line 6 performing the integer modulus operation. If we look at the code more closely, we can see that it is possible to eliminate some of these operations by breaking the loop over primes as soon as one divisor is found.</p>
<pre class="r"><code>source(&quot;generate-primes-2.R&quot;, keep.source=TRUE)
profvis(generate.primes.upto.2(10000))</code></pre>
<div id="htmlwidget-2" style="width:100%;height:600px;" class="profvis html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"message":{"prof":{"time":[1,1,2,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,5,6,6,7,7,7,7,7,7,8,8,8,8,8,8,9,9,9,9,9,9,10,10,11,11,12,12,12,12,12,12,13,13,13,13,13,13,13,14,14,15,15],"depth":[2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,7,6,5,4,3,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,2,1,6,5,4,3,2,1,7,6,5,4,3,2,1,2,1,2,1],"label":["%%","local","if (i %% j == 0) {","generate.primes.upto.2","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.2","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.2","eval","eval","eval.parent","local","<GC>","if (i %% j == 0) {","generate.primes.upto.2","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.2","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.2","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.2","eval","eval","eval.parent","local","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.2","eval","eval","eval.parent","local","<GC>","if (i %% j == 0) {","generate.primes.upto.2","eval","eval","eval.parent","local","%%","local","%%","local"],"filenum":[1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,1,null,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null],"linenum":[6,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,6,null,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null],"memalloc":[8.89083862304688,8.89083862304688,9.94622039794922,9.94622039794922,9.94622039794922,9.94622039794922,9.94622039794922,9.94622039794922,8.33234405517578,8.33234405517578,8.33234405517578,8.33234405517578,8.33234405517578,8.33234405517578,9.5870361328125,9.5870361328125,9.5870361328125,9.5870361328125,9.5870361328125,9.5870361328125,10.6790313720703,10.6790313720703,10.6790313720703,10.6790313720703,10.6790313720703,10.6790313720703,10.6790313720703,10.0202407836914,10.0202407836914,8.49771118164062,8.49771118164062,8.49771118164062,8.49771118164062,8.49771118164062,8.49771118164062,9.74166107177734,9.74166107177734,9.74166107177734,9.74166107177734,9.74166107177734,9.74166107177734,8.22492980957031,8.22492980957031,8.22492980957031,8.22492980957031,8.22492980957031,8.22492980957031,9.88045501708984,9.88045501708984,8.38265228271484,8.38265228271484,9.63739776611328,9.63739776611328,9.63739776611328,9.63739776611328,9.63739776611328,9.63739776611328,10.6936645507812,10.6936645507812,10.6936645507812,10.6936645507812,10.6936645507812,10.6936645507812,10.6936645507812,9.33872222900391,9.33872222900391,10.5857696533203,10.5857696533203],"meminc":[0,0,1.05538177490234,0,0,0,0,0,-1.61387634277344,0,0,0,0,0,1.25469207763672,0,0,0,0,0,1.09199523925781,0,0,0,0,0,0,-0.658790588378906,0,-1.52252960205078,0,0,0,0,0,1.24394989013672,0,0,0,0,0,-1.51673126220703,0,0,0,0,0,1.65552520751953,0,-1.497802734375,0,1.25474548339844,0,0,0,0,0,1.05626678466797,0,0,0,0,0,0,-1.35494232177734,0,1.24704742431641,0],"filename":["generate-primes-2.R",null,"generate-primes-2.R",null,null,null,null,null,"generate-primes-2.R",null,null,null,null,null,"generate-primes-2.R",null,null,null,null,null,null,"generate-primes-2.R",null,null,null,null,null,"generate-primes-2.R",null,"generate-primes-2.R",null,null,null,null,null,"generate-primes-2.R",null,null,null,null,null,"generate-primes-2.R",null,null,null,null,null,"generate-primes-2.R",null,"generate-primes-2.R",null,"generate-primes-2.R",null,null,null,null,null,null,"generate-primes-2.R",null,null,null,null,null,"generate-primes-2.R",null,"generate-primes-2.R",null]},"interval":10,"files":[{"filename":"generate-primes-2.R","content":"generate.primes.upto.2 <- function(N) {\n  primes <- 2\n  for (i in 3:N) {\n    found.divisor <- FALSE\n    for (j in primes) {\n      if (i %% j == 0) {\n        found.divisor <- TRUE\n        break\n      }\n    }\n    if (!found.divisor) primes <- c(primes,i)\n  }\n  return(primes)\n}\n","normpath":"/Users/runner/work/sc1/sc1/content/profile-debug/generate-primes-2.R"}],"prof_output":"/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T//RtmpNet2kv/file6abb35355758.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>This has dramatically reduced the running time of the algorithm, by a factor of about 10. Although the function is fairly short, we may feel that the code is not easy to read. In particular, the overall idea of the algorithm can be lost in the implementation details. So we can consider the same algorithm, but where we call a helper function called <code>any.divisors</code> instead.</p>
<pre class="r"><code>source(&quot;generate-primes-3.R&quot;, keep.source=TRUE)
profvis(generate.primes.upto.3(10000))</code></pre>
<div id="htmlwidget-3" style="width:100%;height:600px;" class="profvis html-widget"></div>
<script type="application/json" data-for="htmlwidget-3">{"x":{"message":{"prof":{"time":[1,1,1,1,1,1,1,2,2,2,2,2,2,2,3,3,4,4,4,4,4,4,4,5,5,5,5,5,5,6,6,7,7,7,7,7,7,7,8,8,9,9,10,10,10,10,10,10,10,11,11,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,14,14,15,15,15,15,15,15,15],"depth":[7,6,5,4,3,2,1,7,6,5,4,3,2,1,2,1,7,6,5,4,3,2,1,6,5,4,3,2,1,2,1,7,6,5,4,3,2,1,2,1,2,1,7,6,5,4,3,2,1,2,1,7,6,5,4,3,2,1,8,7,6,5,4,3,2,1,2,1,7,6,5,4,3,2,1],"label":["for (j in ps) {","any.divisors","generate.primes.upto.3","eval","eval","eval.parent","local","if (i %% j == 0) {","any.divisors","generate.primes.upto.3","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","any.divisors","generate.primes.upto.3","eval","eval","eval.parent","local","any.divisors","generate.primes.upto.3","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","any.divisors","generate.primes.upto.3","eval","eval","eval.parent","local","c","local","%%","local","if (i %% j == 0) {","any.divisors","generate.primes.upto.3","eval","eval","eval.parent","local","c","local","if (i %% j == 0) {","any.divisors","generate.primes.upto.3","eval","eval","eval.parent","local","<GC>","if (i %% j == 0) {","any.divisors","generate.primes.upto.3","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","any.divisors","generate.primes.upto.3","eval","eval","eval.parent","local"],"filenum":[1,1,null,null,null,null,null,1,1,null,null,null,null,null,1,null,1,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,1,null,null,null,null,null,1,null,1,null,1,1,null,null,null,null,null,1,null,1,1,null,null,null,null,null,null,1,1,null,null,null,null,null,1,null,1,1,null,null,null,null,null],"linenum":[2,13,null,null,null,null,null,3,13,null,null,null,null,null,3,null,3,13,null,null,null,null,null,13,null,null,null,null,null,3,null,3,13,null,null,null,null,null,14,null,3,null,3,13,null,null,null,null,null,14,null,3,13,null,null,null,null,null,null,3,13,null,null,null,null,null,3,null,3,13,null,null,null,null,null],"memalloc":[8.6220703125,8.6220703125,8.6220703125,8.6220703125,8.6220703125,8.6220703125,8.6220703125,9.38247680664062,9.38247680664062,9.38247680664062,9.38247680664062,9.38247680664062,9.38247680664062,9.38247680664062,10.1366500854492,10.1366500854492,8.82061004638672,8.82061004638672,8.82061004638672,8.82061004638672,8.82061004638672,8.82061004638672,8.82061004638672,9.62920379638672,9.62920379638672,9.62920379638672,9.62920379638672,9.62920379638672,9.62920379638672,10.4271850585938,10.4271850585938,9.40553283691406,9.40553283691406,9.40553283691406,9.40553283691406,9.40553283691406,9.40553283691406,9.40553283691406,10.2393646240234,10.2393646240234,8.75595092773438,8.75595092773438,9.58524322509766,9.58524322509766,9.58524322509766,9.58524322509766,9.58524322509766,9.58524322509766,9.58524322509766,10.426399230957,10.426399230957,9.75447845458984,9.75447845458984,9.75447845458984,9.75447845458984,9.75447845458984,9.75447845458984,9.75447845458984,10.4706649780273,10.4706649780273,10.4706649780273,10.4706649780273,10.4706649780273,10.4706649780273,10.4706649780273,10.4706649780273,9.12797546386719,9.12797546386719,9.97809600830078,9.97809600830078,9.97809600830078,9.97809600830078,9.97809600830078,9.97809600830078,9.97809600830078],"meminc":[0,0,0,0,0,0,0,0.760406494140625,0,0,0,0,0,0,0.754173278808594,0,-1.3160400390625,0,0,0,0,0,0,0.80859375,0,0,0,0,0,0.797981262207031,0,-1.02165222167969,0,0,0,0,0,0,0.833831787109375,0,-1.48341369628906,0,0.829292297363281,0,0,0,0,0,0,0.841156005859375,0,-0.671920776367188,0,0,0,0,0,0,0.7161865234375,0,0,0,0,0,0,0,-1.34268951416016,0,0.850120544433594,0,0,0,0,0,0],"filename":["generate-primes-3.R","generate-primes-3.R",null,null,null,null,null,"generate-primes-3.R","generate-primes-3.R",null,null,null,null,null,"generate-primes-3.R",null,"generate-primes-3.R","generate-primes-3.R",null,null,null,null,null,"generate-primes-3.R",null,null,null,null,null,"generate-primes-3.R",null,"generate-primes-3.R","generate-primes-3.R",null,null,null,null,null,"generate-primes-3.R",null,"generate-primes-3.R",null,"generate-primes-3.R","generate-primes-3.R",null,null,null,null,null,"generate-primes-3.R",null,"generate-primes-3.R","generate-primes-3.R",null,null,null,null,null,null,"generate-primes-3.R","generate-primes-3.R",null,null,null,null,null,"generate-primes-3.R",null,"generate-primes-3.R","generate-primes-3.R",null,null,null,null,null]},"interval":10,"files":[{"filename":"generate-primes-3.R","content":"any.divisors <- function(i, ps) {\n  for (j in ps) {\n    if (i %% j == 0) {\n      return(TRUE)\n    }\n  }\n  return(FALSE)\n}\n\ngenerate.primes.upto.3 <- function(N) {\n  primes <- 2\n  for (i in 3:N) {\n    if (!any.divisors(i, primes)) {\n      primes <- c(primes,i)\n    }\n  }\n  return(primes)\n}\n","normpath":"/Users/runner/work/sc1/sc1/content/profile-debug/generate-primes-3.R"}],"prof_output":"/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T//RtmpNet2kv/file6abb3790e271.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>It seems reasonable to say that the third version of the algorithm is easier to understand. Moreover, there is little to no performance penalty.</p>
</div>
<div id="the-sieve-of-eratosthenes" class="section level2">
<h2>The Sieve of Eratosthenes</h2>
<p>A more computationally efficient approach is the <a href="https://en.wikipedia.org/wiki/Sieve_of_Eratosthenes">Sieve of Eratosthenes</a>. In this approach, one does not check whether each number is prime by checking divisors. Instead, one starts with a list of numbers from <span class="math inline">\(1\)</span> to <span class="math inline">\(N\)</span> and successively marks all multiples of each prime, in order, as composite. To identify the next prime after <span class="math inline">\(2\)</span> for marking multiples, one simply needs to find the next number not marked composite.</p>
<p>This approach is so much faster, that we consider finding all primes up to <span class="math inline">\(1000000\)</span> instead of up to <span class="math inline">\(10000\)</span>.</p>
<pre class="r"><code>source(&quot;sieve-1.R&quot;, keep.source=TRUE)
profvis(sieve.1(1000000))</code></pre>
<div id="htmlwidget-4" style="width:100%;height:600px;" class="profvis html-widget"></div>
<script type="application/json" data-for="htmlwidget-4">{"x":{"message":{"prof":{"time":[1,1,1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,6,6,6,6,6,6,7,7,7,7,7,7,8,8,8,8,8,8,9,9,9,9,9,9,10,10,10,10,10,10,11,11,11,11,11,11,12,12,12,12,12,12,13,13,13,13,13,13,14,14,14,14,14,14,15,15,15,15,15,15,16,16,16,16,16,16,17,17,17,17,17,17,18,18,18,18,18,18,19,19,19,19,19,19,20,20,20,20,20,20,21,21,21,21,21,21,22,22,22,22,22,22,23,23,23,23,23,23,24,24,24,24,24,24],"depth":[6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1],"label":["candidates <- rep(TRUE,N)","sieve.1","eval","eval","eval.parent","local","s <- s + i","sieve.1","eval","eval","eval.parent","local","while (s <= N) {","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","s <- s + i","sieve.1","eval","eval","eval.parent","local","s <- s + i","sieve.1","eval","eval","eval.parent","local","while (s <= N) {","sieve.1","eval","eval","eval.parent","local","while (s <= N) {","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","while (s <= N) {","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","s <- s + i","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","while (s <= N) {","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","while (s <= N) {","sieve.1","eval","eval","eval.parent","local","if (candidates[i]) {","sieve.1","eval","eval","eval.parent","local","for (i in 2:N) {","sieve.1","eval","eval","eval.parent","local","if (candidates[i]) {","sieve.1","eval","eval","eval.parent","local"],"filenum":[1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null],"linenum":[2,null,null,null,null,null,10,null,null,null,null,null,8,null,null,null,null,null,9,null,null,null,null,null,10,null,null,null,null,null,10,null,null,null,null,null,8,null,null,null,null,null,8,null,null,null,null,null,9,null,null,null,null,null,8,null,null,null,null,null,9,null,null,null,null,null,9,null,null,null,null,null,9,null,null,null,null,null,10,null,null,null,null,null,9,null,null,null,null,null,9,null,null,null,null,null,8,null,null,null,null,null,9,null,null,null,null,null,9,null,null,null,null,null,9,null,null,null,null,null,8,null,null,null,null,null,5,null,null,null,null,null,4,null,null,null,null,null,5,null,null,null,null,null],"memalloc":[12.3076934814453,12.3076934814453,12.3076934814453,12.3076934814453,12.3076934814453,12.3076934814453,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016,12.3077545166016],"meminc":[0,0,0,0,0,0,6.103515625e-05,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"filename":["sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null]},"interval":10,"files":[{"filename":"sieve-1.R","content":"sieve.1 <- function(N) {\n  candidates <- rep(TRUE,N)\n  candidates[1] <- FALSE\n  for (i in 2:N) {\n    if (candidates[i]) {\n      # i is prime\n      s <- i*2\n      while (s <= N) {\n        candidates[s] <- FALSE\n        s <- s + i\n      }\n    }\n  }\n  return((1:N)[candidates])\n}\n","normpath":"/Users/runner/work/sc1/sc1/content/profile-debug/sieve-1.R"}],"prof_output":"/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T//RtmpNet2kv/file6abb477e280.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>We see that most of the time is spent in lines 8–10, which correspond to marking <code>s</code> as composite and incrementing <code>s</code> by the current prime. We can remove some of these computations by noticing that if <span class="math inline">\(i\)</span> is prime then all multiples <span class="math inline">\(2i,3i,\ldots,(i-1)i\)</span> will already have been marked as composite. It follows that one can also stop “sieving” as soon as <span class="math inline">\(i &gt; \sqrt{N}\)</span>.</p>
<pre class="r"><code>source(&quot;sieve-2.R&quot;, keep.source=TRUE)
profvis(sieve.2(1000000))</code></pre>
<div id="htmlwidget-5" style="width:100%;height:600px;" class="profvis html-widget"></div>
<script type="application/json" data-for="htmlwidget-5">{"x":{"message":{"prof":{"time":[1,1,1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,6,6,6,6,6,6,7,7,7,7,7,7,8,8,8,8,8,8,9,9,9,9,9,9,10,10,10,10,10,10,11,11,11,11,11,11,12,12,12,12,12,12,13,13,13,13,13,13,14,14,14,14,14,14],"depth":[6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1],"label":["candidates <- rep(TRUE,N)","sieve.2","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.2","eval","eval","eval.parent","local","while (s <= N) {","sieve.2","eval","eval","eval.parent","local","while (s <= N) {","sieve.2","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.2","eval","eval","eval.parent","local","while (s <= N) {","sieve.2","eval","eval","eval.parent","local","s <- s + i","sieve.2","eval","eval","eval.parent","local","while (s <= N) {","sieve.2","eval","eval","eval.parent","local","s <- s + i","sieve.2","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.2","eval","eval","eval.parent","local","s <- s + i","sieve.2","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.2","eval","eval","eval.parent","local","while (s <= N) {","sieve.2","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.2","eval","eval","eval.parent","local"],"filenum":[1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null],"linenum":[2,null,null,null,null,null,10,null,null,null,null,null,9,null,null,null,null,null,9,null,null,null,null,null,10,null,null,null,null,null,9,null,null,null,null,null,11,null,null,null,null,null,9,null,null,null,null,null,11,null,null,null,null,null,10,null,null,null,null,null,11,null,null,null,null,null,10,null,null,null,null,null,9,null,null,null,null,null,10,null,null,null,null,null],"memalloc":[12.3224563598633,12.3224563598633,12.3224563598633,12.3224563598633,12.3224563598633,12.3224563598633,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141,12.3225250244141],"meminc":[0,0,0,0,0,0,6.866455078125e-05,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"filename":["sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null]},"interval":10,"files":[{"filename":"sieve-2.R","content":"sieve.2 <- function(N) {\n  candidates <- rep(TRUE,N)\n  candidates[1] <- FALSE\n  sqrt.N <- sqrt(N)\n  for (i in 2:sqrt.N) {\n    if (candidates[i]) {\n      # i is prime\n      s <- i*i\n      while (s <= N) {\n        candidates[s] <- FALSE\n        s <- s + i\n      }\n    }\n  }\n  return((1:N)[candidates])\n}\n","normpath":"/Users/runner/work/sc1/sc1/content/profile-debug/sieve-2.R"}],"prof_output":"/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T//RtmpNet2kv/file6abb35c3b14d.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>There appears to be a moderate improvement in performance for this size of problem. We notice that a substantial amount of time is spent in the <code>while</code> loop, which mainly involves incrementing <code>s</code> and flagging the corresponding number as composite. We can vectorize this computation and separate it cleanly from the rest of the algorithm, as follows.</p>
<pre class="r"><code>source(&quot;sieve-3.R&quot;, keep.source=TRUE)
profvis(sieve.3(1000000))</code></pre>
<div id="htmlwidget-6" style="width:100%;height:600px;" class="profvis html-widget"></div>
<script type="application/json" data-for="htmlwidget-6">{"x":{"message":{"prof":{"time":[1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,6,6,6,6,6,6,6],"depth":[8,7,6,5,4,3,2,1,7,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,7,6,5,4,3,2,1],"label":["pmin","seq.default","get.multiples","sieve.3","eval","eval","eval.parent","local","n <- floor(N/i) - i","get.multiples","sieve.3","eval","eval","eval.parent","local","candidates[multiples] <- FALSE","sieve.3","eval","eval","eval.parent","local","candidates[multiples] <- FALSE","sieve.3","eval","eval","eval.parent","local","candidates[multiples] <- FALSE","sieve.3","eval","eval","eval.parent","local","seq.default","get.multiples","sieve.3","eval","eval","eval.parent","local"],"filenum":[null,null,1,null,null,null,null,null,1,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,null,1,null,null,null,null,null],"linenum":[null,null,14,null,null,null,null,null,2,14,null,null,null,null,null,15,null,null,null,null,null,15,null,null,null,null,null,15,null,null,null,null,null,null,14,null,null,null,null,null],"memalloc":[18.0818405151367,18.0818405151367,18.0818405151367,18.0818405151367,18.0818405151367,18.0818405151367,18.0818405151367,18.0818405151367,23.9200668334961,23.9200668334961,23.9200668334961,23.9200668334961,23.9200668334961,23.9200668334961,23.9200668334961,35.36474609375,35.36474609375,35.36474609375,35.36474609375,35.36474609375,35.36474609375,45.5894622802734,45.5894622802734,45.5894622802734,45.5894622802734,45.5894622802734,45.5894622802734,54.3454818725586,54.3454818725586,54.3454818725586,54.3454818725586,54.3454818725586,54.3454818725586,60.4765472412109,60.4765472412109,60.4765472412109,60.4765472412109,60.4765472412109,60.4765472412109,60.4765472412109],"meminc":[0,0,0,0,0,0,0,0,5.83822631835938,0,0,0,0,0,0,11.4446792602539,0,0,0,0,0,10.2247161865234,0,0,0,0,0,8.75601959228516,0,0,0,0,0,6.13106536865234,0,0,0,0,0,0],"filename":[null,null,"sieve-3.R",null,null,null,null,null,"sieve-3.R","sieve-3.R",null,null,null,null,null,"sieve-3.R",null,null,null,null,null,"sieve-3.R",null,null,null,null,null,"sieve-3.R",null,null,null,null,null,null,"sieve-3.R",null,null,null,null,null]},"interval":10,"files":[{"filename":"sieve-3.R","content":"get.multiples <- function(i, N) {\n  n <- floor(N/i) - i\n  if (n <= 0) return(NULL)\n  multiples <- seq(i*i,(i+n)*i,i)\n  return(multiples)\n}\n\nsieve.3 <- function(N) {\n  candidates <- rep(TRUE,N)\n  candidates[1] <- FALSE\n  sqrt.N <- sqrt(N)\n  for (i in 2:sqrt.N) {\n    if (candidates[i]) {\n      multiples <- get.multiples(i, N)\n      candidates[multiples] <- FALSE\n    }\n  }\n  return((1:N)[candidates])\n}\n","normpath":"/Users/runner/work/sc1/sc1/content/profile-debug/sieve-3.R"}],"prof_output":"/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T//RtmpNet2kv/file6abbd5cd95.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>This gives another improvement to performance. It is worth noting that creating an array of multiples is faster than iterating through multiples in R, because the cost of allocating memory is negligible in comparison to the benefit of eliminating the loop. In a programming language such as C, the reverse is often true, as allocating memory is typically expensive in comparison to iteration once compiled into machine code.</p>
</div>
<div id="comments" class="section level2">
<h2>Comments</h2>
<p>Profiling in this scenario is already quite useful, as one can see which parts of the code are critical for performance. In larger applications, profiling is even more useful as one can quickly determine which functions are the most important from a performance perspective: if 1% of computation time is spent in a particular function, very little improvement can be derived by improving it, whereas if 99% of computation time is spent in a function one can conceivably improve performance very substantially by accelerating the implementation or improving the corresponding algorithm itself.</p>
<p>Profiling is also helpful for maintaining code readability and modularity: in some cases performance can be improved by sacrificing readability, or modularity of the code. Doing so can make sense if the code is critical to performance, but it makes little sense when the code is unimportant from a performance perspective.</p>
<p>Finally, when profiling code and trying to improve its performance, good testing tools are very useful for ensuring that any improvement in performance has not come at the cost of breaking existing functionality, including in rare, corner cases.</p>
</div>


  <footer>
  

<script src="//yihui.name/js/math-code.js"></script>
<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<script async src="//yihui.name/js/center-img.js"></script>


<script type="text/javascript">
var sc_project=12110974;
var sc_invisible=1;
var sc_security="9b171880";
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="https://statcounter.com/" target="_blank"><img
class="statcounter"
src="https://c.statcounter.com/12110974/0/9b171880/1/"
alt="Web Analytics"></a></div></noscript>








  


<p align=right>

<a href='https://github.com/awllee/sc1/blob/master/content/profile-debug/profile.Rmd'>View source</a>

|

<a href='https://github.com/awllee/sc1/edit/master/content/profile-debug/profile.Rmd'>Edit source</a>

</p>





<script src="https://utteranc.es/client.js"
        repo="awllee/sc1"
        issue-term="pathname"
        label="utterance"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>



  



<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>



<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/tex.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



  
  <hr>
  <div class="copyright">© 2020 <a href="https://sites.google.com/view/anthonylee">Anthony Lee</a>, <a href="http://www.bristol.ac.uk/maths/people/feng-yu/index.html">Feng Yu</a>, <a href="https://people.maths.bris.ac.uk/~tk18582/">Tobias Kley</a>, <a href="https://mfasiolo.github.io/">Matteo Fasiolo</a></div>
  
  </footer>
  </article>
  
  </body>
</html>

