<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Profiling - SC1</title>
    <meta property="og:title" content="Profiling - SC1">
    
    <meta name="twitter:card" content="summary">

    
      
    

    
      
      <meta property="description" content="Profiling in R is fairly straightforward using the profvis package, which builds upon base R’s Rprof functionality.
library(profvis) This is a statistical profiler: it operates by regularly (e.g. &amp;hellip;">
      <meta property="og:description" content="Profiling in R is fairly straightforward using the profvis package, which builds upon base R’s Rprof functionality.
library(profvis) This is a statistical profiler: it operates by regularly (e.g. &amp;hellip;">
      
    

    
    

    

    
    


<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.12.0/build/styles/github.min.css">



    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Arvo">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Marcellus">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro">

<link rel="stylesheet" href="/sc1/css/style.css" />
<link rel="stylesheet" href="/sc1/css/fonts.css" />
<link rel="stylesheet" href="/sc1/css/custom.css" />

<link rel="icon" href="/sc1/favicon.ico" type="image/x-icon" />



























<nav class="breadcrumbs">
    
        <a href="https://awllee.github.io/sc1">home / </a>
    
        <a href="https://awllee.github.io/sc1/profile-debug/">profile-debug / </a>
    
        <a href="https://awllee.github.io/sc1/profile-debug/profile/">profile / </a>
    
</nav>

  </head>

  
  <body class="sc1">
    <header class="masthead">
      <h1><a href="/">SC1</a></h1>

<p class="tagline">Statistical Computing 1</p>

      <nav class="menu">
  <input id="menu-check" type="checkbox" hidden/>
  <label id="menu-label" for="menu-check" class="unselectable" hidden>
    <span class="icon close-icon">✕</span>
    <span class="icon open-icon">☰</span>
    <span class="text">Menu</span>
  </label>
  <ul>
  
  
  <li><a href="/sc1/">Home</a></li>
  
  <li><a href="/sc1/intro-r/">Intro to R</a></li>
  
  <li><a href="/sc1/reproducibility/">Reproducibility</a></li>
  
  <li><a href="/sc1/packages/">Packages</a></li>
  
  <li><a href="/sc1/common-r/">Common R</a></li>
  
  <li><a href="/sc1/functional-oo/">Functional / OO</a></li>
  
  <li><a href="/sc1/tidyverse/">Tidyverse</a></li>
  
  <li><a href="/sc1/profile-debug/">Performance / Bugs</a></li>
  
  <li><a href="/sc1/matrices/">Matrices</a></li>
  
  <li><a href="/sc1/optimization/">Optimization</a></li>
  
  <li><a href="/sc1/integration/">Integration</a></li>
  
  
  </ul>
</nav>

    </header>

    <article class="main">
      <header class="title">
      
<h1>Profiling</h1>

<h3>
</h3>
<hr>


      </header>






<script src="/sc1rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/sc1rmarkdown-libs/jquery/jquery.min.js"></script>
<script src="/sc1rmarkdown-libs/d3/d3.min.js"></script>
<link href="/sc1rmarkdown-libs/profvis/profvis.css" rel="stylesheet" />
<script src="/sc1rmarkdown-libs/profvis/profvis.js"></script>
<script src="/sc1rmarkdown-libs/profvis/scroll.js"></script>
<link href="/sc1rmarkdown-libs/highlight/textmate.css" rel="stylesheet" />
<script src="/sc1rmarkdown-libs/highlight/highlight.js"></script>
<script src="/sc1rmarkdown-libs/profvis-binding/profvis.js"></script>

<div id="TOC">
<ul>
<li><a href="#updating-a-list-of-primes" id="toc-updating-a-list-of-primes">Updating a list of primes</a></li>
<li><a href="#the-sieve-of-eratosthenes" id="toc-the-sieve-of-eratosthenes">The Sieve of Eratosthenes</a></li>
<li><a href="#comments" id="toc-comments">Comments</a></li>
</ul>
</div>

<p><a href="https://en.wikipedia.org/wiki/Profiling_(computer_programming)">Profiling</a> in R is fairly straightforward using the <a href="https://rstudio.github.io/profvis/"><code>profvis</code></a> package, which builds upon base R’s <code>Rprof</code> functionality.</p>
<pre class="r"><code>library(profvis)</code></pre>
<p>This is a <em>statistical profiler</em>: it operates by regularly (e.g. every few milliseconds) using operating system interrupts to determine what code is being executed. This enables one to build a picture of where the computation is spending most of its time, and is essentially an application of the Monte Carlo method. Although the results are not deterministic, the profiling operation adds very little overhead to the computation.</p>
<p>Statistical profilers can be viewed in contrast to <em>instrumenting profilers</em> of various flavours, which often involve incrementing counters whenever certain events occur. This often involves instrumenting existing code by adding instructions to increment the counters either manually or automatically. For example, incrementing a counter whenever a function is called. Instrumenting profilers can provide very accurate results, but can add substantial overhead to the computation. These tools can be important not only for understanding performance, but also for checking the validity and robustness of code: for example, <a href="https://en.wikipedia.org/wiki/Valgrind">Valgrind</a> is often used in C code to detect memory leaks and memory reference errors.</p>
<p>We consider here profiling various R functions for generating an array of all primes less than or equal to some number.</p>
<div id="updating-a-list-of-primes" class="section level2">
<h2>Updating a list of primes</h2>
<p>A straightforward approach to generating all prime numbers less than some number <span class="math inline">\(N\)</span> is to iterate through the numbers <span class="math inline">\(3,\ldots,N\)</span> and add the current number to the list of primes if there is no divisor of that number in the current list of primes.</p>
<p>In the following, we profile 3 variants of this approach. The first variant is a very inefficient implementation.</p>
<pre class="r"><code>source(&quot;generate-primes-1.R&quot;, keep.source=TRUE)
profvis(generate.primes.upto.1(10000))</code></pre>
<div class="profvis html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-1" style="width:100%;height:600px;"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"message":{"prof":{"time":[1,1,2,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,6,6,7,7,7,7,7,7,8,8,9,9,9,9,9,9,10,10,10,10,10,10,11,11,11,11,11,11,12,12,12,12,12,12,13,13,14,14,14,14,14,14,15,15,15,15,15,15,16,16,16,16,16,16,17,17,17,17,17,17,18,18,18,18,18,18,19,19,19,20,20,20,20,20,20,21,21,21,21,21,21,22,22,23,23,23,23,23,23,24,24,24,24,24,24,25,25,25,25,25,25,26,26,27,27,28,28,28,28,28,28,29,29,29,29,29,29,30,30,31,31,31,31,31,31,32,32,32,32,32,32,33,33,33,33,33,33,34,34,34,34,34,34,35,35,36,36,37,37,37,37,37,37,38,38,38,38,38,38,39,39,40,40,40,40,40,40,40,41,41,41,41,41,41,42,42,42,42,42,42,43,43,44,44,44,44,44,44,44,45,45,45,45,45,45,46,46,46,46,46,46,47,47,48,48,48,48,48,48,49,49,50,50,50,50,50,50,51,51,51,52,52,53,53,53,53,53,53,53,54,54,54,54,54,54,55,55,55,55,55,55,56,56,57,57,57,57,57,57,58,58,58,58,58,58,59,59,59,59,59,59,60,60,60,60,60,60,61,61,62,62,63,63,64,64,65,65,65,65,65,65,66,66,66,66,66,66,67,67,68,68,68,68,68,68,69,69,70,70,71,71,71,71,71,71,72,72,73,73,73,73,73,73,74,74,75,75,75,76,76,77,77,78,78,79,79,79,79,79,79,80,80,81,81,81,81,81,81,82,82,83,83,83,83,83,83,84,84,84,84,84,84,84,85,85,86,86,86,86,86,86,87,87,87,87,87,87,88,88,89,89,89,89,89,89,90,90,90,90,90,90,90,91,91,91,91,91,91,92,92,92,92,92,92,93,93,93,93,93,93,93,94,94,95,95,95,96,96,97,97,97,97,97,97,98,98,99,99,99,99,99,99,99,100,100,100,100,100,100,101,101,102,102,102,102,102,102,103,103,104,104,105,105,105,105,105,105,106,106,107,107,107,107,107,107,108,108,108,108,108,108,109,109,110,110,111,111,111,111,111,111,112,112,112,112,112,112,113,113,113,113,113,113,114,114,114,114,114,114,115,115,115,115,115,115,116,116,117,117,118,118,118,118,118,118,119,119,119,119,119,119,120,120,120,120,120,120,121,121,122,122,122,122,122,122,123,123,123,123,123,123,124,124,124,124,124,124],"depth":[2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,7,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,7,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,3,2,1,2,1,7,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,2,1,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,2,1,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,2,1,3,2,1,2,1,2,1,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,7,6,5,4,3,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,7,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,7,6,5,4,3,2,1,2,1,3,2,1,2,1,6,5,4,3,2,1,2,1,7,6,5,4,3,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,2,1,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1],"label":["lazyLoadDBfetch","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","for (j in primes) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","for (j in primes) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","for (j in primes) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","%%","local","for (j in primes) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","%%","local","for (j in primes) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","c","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","for (j in primes) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","%%","local","%%","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","%%","local","%%","local","%%","local","for (j in primes) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","for (j in primes) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","%%","local","%%","local","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","for (j in primes) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","for (j in primes) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","<GC>","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","for (j in primes) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.1","eval","eval","eval.parent","local"],"filenum":[null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,1,null,1,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,1,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,1,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,1,1,null,1,null,1,null,1,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,null,1,null,null,null,null,null,1,null,1,1,null,1,null,1,null,null,null,null,null,1,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,1,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null],"linenum":[null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,5,null,null,null,null,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,5,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,5,null,null,null,null,null,6,6,null,5,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,5,null,null,null,null,null,6,null,null,null,null,null,10,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,6,null,null,null,null,null,6,null,null,null,null,null,5,null,null,null,null,null,6,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,6,6,null,6,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,6,null,6,null,5,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,6,null,6,null,6,null,null,null,null,null,6,null,5,null,null,null,null,null,6,null,6,6,null,6,null,6,null,6,null,6,null,null,null,null,null,6,null,5,null,null,null,null,null,6,null,6,null,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,null,6,null,null,null,null,null,5,null,null,null,null,null,6,null,null,null,null,null,null,6,null,null,null,null,null,6,null,6,6,null,6,null,6,null,null,null,null,null,6,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,6,null,6,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,5,null,null,null,null,null,6,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null],"memalloc":[11.743522644043,11.743522644043,12.2969055175781,12.2969055175781,12.2969055175781,12.2969055175781,12.2969055175781,12.2969055175781,13.0096435546875,13.0096435546875,13.0096435546875,13.0096435546875,13.0096435546875,13.0096435546875,13.4701385498047,13.4701385498047,13.4701385498047,13.4701385498047,13.4701385498047,13.4701385498047,14.1609191894531,14.1609191894531,14.1609191894531,14.1609191894531,14.1609191894531,14.1609191894531,14.6225051879883,14.6225051879883,9.33531951904297,9.33531951904297,9.33531951904297,9.33531951904297,9.33531951904297,9.33531951904297,10.1045074462891,10.1045074462891,11.2373733520508,11.2373733520508,11.2373733520508,11.2373733520508,11.2373733520508,11.2373733520508,9.06287384033203,9.06287384033203,9.06287384033203,9.06287384033203,9.06287384033203,9.06287384033203,10.2018890380859,10.2018890380859,10.2018890380859,10.2018890380859,10.2018890380859,10.2018890380859,10.9709396362305,10.9709396362305,10.9709396362305,10.9709396362305,10.9709396362305,10.9709396362305,9.17766571044922,9.17766571044922,9.93876647949219,9.93876647949219,9.93876647949219,9.93876647949219,9.93876647949219,9.93876647949219,11.0996475219727,11.0996475219727,11.0996475219727,11.0996475219727,11.0996475219727,11.0996475219727,8.94242858886719,8.94242858886719,8.94242858886719,8.94242858886719,8.94242858886719,8.94242858886719,10.0737380981445,10.0737380981445,10.0737380981445,10.0737380981445,10.0737380981445,10.0737380981445,10.8354721069336,10.8354721069336,10.8354721069336,10.8354721069336,10.8354721069336,10.8354721069336,9.08003997802734,9.08003997802734,9.08003997802734,9.83104705810547,9.83104705810547,9.83104705810547,9.83104705810547,9.83104705810547,9.83104705810547,10.9835739135742,10.9835739135742,10.9835739135742,10.9835739135742,10.9835739135742,10.9835739135742,8.83546447753906,8.83546447753906,9.967041015625,9.967041015625,9.967041015625,9.967041015625,9.967041015625,9.967041015625,10.7237777709961,10.7237777709961,10.7237777709961,10.7237777709961,10.7237777709961,10.7237777709961,8.95227813720703,8.95227813720703,8.95227813720703,8.95227813720703,8.95227813720703,8.95227813720703,9.70779418945312,9.70779418945312,10.8490447998047,10.8490447998047,8.72024536132812,8.72024536132812,8.72024536132812,8.72024536132812,8.72024536132812,8.72024536132812,9.84584045410156,9.84584045410156,9.84584045410156,9.84584045410156,9.84584045410156,9.84584045410156,10.6024322509766,10.6024322509766,8.86102294921875,8.86102294921875,8.86102294921875,8.86102294921875,8.86102294921875,8.86102294921875,9.60791015625,9.60791015625,9.60791015625,9.60791015625,9.60791015625,9.60791015625,10.7564086914062,10.7564086914062,10.7564086914062,10.7564086914062,10.7564086914062,10.7564086914062,8.62031555175781,8.62031555175781,8.62031555175781,8.62031555175781,8.62031555175781,8.62031555175781,9.74584197998047,9.74584197998047,10.5164337158203,10.5164337158203,8.75653076171875,8.75653076171875,8.75653076171875,8.75653076171875,8.75653076171875,8.75653076171875,9.50624847412109,9.50624847412109,9.50624847412109,9.50624847412109,9.50624847412109,9.50624847412109,10.6384658813477,10.6384658813477,11.3081741333008,11.3081741333008,11.3081741333008,11.3081741333008,11.3081741333008,11.3081741333008,11.3081741333008,9.03208923339844,9.03208923339844,9.03208923339844,9.03208923339844,9.03208923339844,9.03208923339844,9.69586181640625,9.69586181640625,9.69586181640625,9.69586181640625,9.69586181640625,9.69586181640625,10.7172775268555,10.7172775268555,11.2989120483398,11.2989120483398,11.2989120483398,11.2989120483398,11.2989120483398,11.2989120483398,11.2989120483398,9.59352111816406,9.59352111816406,9.59352111816406,9.59352111816406,9.59352111816406,9.59352111816406,10.3460083007812,10.3460083007812,10.3460083007812,10.3460083007812,10.3460083007812,10.3460083007812,8.59966278076172,8.59966278076172,9.34324645996094,9.34324645996094,9.34324645996094,9.34324645996094,9.34324645996094,9.34324645996094,10.5091247558594,10.5091247558594,11.2522964477539,11.2522964477539,11.2522964477539,11.2522964477539,11.2522964477539,11.2522964477539,9.45417022705078,9.45417022705078,9.45417022705078,10.2212982177734,10.2212982177734,11.2904434204102,11.2904434204102,11.2904434204102,11.2904434204102,11.2904434204102,11.2904434204102,11.2904434204102,9.21755981445312,9.21755981445312,9.21755981445312,9.21755981445312,9.21755981445312,9.21755981445312,10.3649826049805,10.3649826049805,10.3649826049805,10.3649826049805,10.3649826049805,10.3649826049805,11.1267471313477,11.1267471313477,9.34116363525391,9.34116363525391,9.34116363525391,9.34116363525391,9.34116363525391,9.34116363525391,10.0923461914062,10.0923461914062,10.0923461914062,10.0923461914062,10.0923461914062,10.0923461914062,11.2139663696289,11.2139663696289,11.2139663696289,11.2139663696289,11.2139663696289,11.2139663696289,9.11426544189453,9.11426544189453,9.11426544189453,9.11426544189453,9.11426544189453,9.11426544189453,10.2419815063477,10.2419815063477,11.0101699829102,11.0101699829102,9.25542449951172,9.25542449951172,10.013916015625,10.013916015625,11.1454391479492,11.1454391479492,11.1454391479492,11.1454391479492,11.1454391479492,11.1454391479492,9.01304626464844,9.01304626464844,9.01304626464844,9.01304626464844,9.01304626464844,9.01304626464844,10.1539001464844,10.1539001464844,10.8985366821289,10.8985366821289,10.8985366821289,10.8985366821289,10.8985366821289,10.8985366821289,9.12445831298828,9.12445831298828,9.88060760498047,9.88060760498047,11.0106811523438,11.0106811523438,11.0106811523438,11.0106811523438,11.0106811523438,11.0106811523438,8.88729858398438,8.88729858398438,9.99905395507812,9.99905395507812,9.99905395507812,9.99905395507812,9.99905395507812,9.99905395507812,10.7444152832031,10.7444152832031,9.01493835449219,9.01493835449219,9.01493835449219,9.78778076171875,9.78778076171875,10.9211044311523,10.9211044311523,8.77020263671875,8.77020263671875,9.91111755371094,9.91111755371094,9.91111755371094,9.91111755371094,9.91111755371094,9.91111755371094,10.6535797119141,10.6535797119141,8.89026641845703,8.89026641845703,8.89026641845703,8.89026641845703,8.89026641845703,8.89026641845703,9.64104461669922,9.64104461669922,10.7899398803711,10.7899398803711,10.7899398803711,10.7899398803711,10.7899398803711,10.7899398803711,11.3547744750977,11.3547744750977,11.3547744750977,11.3547744750977,11.3547744750977,11.3547744750977,11.3547744750977,9.77243041992188,9.77243041992188,10.5380477905273,10.5380477905273,10.5380477905273,10.5380477905273,10.5380477905273,10.5380477905273,8.79782104492188,8.79782104492188,8.79782104492188,8.79782104492188,8.79782104492188,8.79782104492188,9.52786254882812,9.52786254882812,10.6772079467773,10.6772079467773,10.6772079467773,10.6772079467773,10.6772079467773,10.6772079467773,11.3984298706055,11.3984298706055,11.3984298706055,11.3984298706055,11.3984298706055,11.3984298706055,11.3984298706055,9.65532684326172,9.65532684326172,9.65532684326172,9.65532684326172,9.65532684326172,9.65532684326172,10.4119338989258,10.4119338989258,10.4119338989258,10.4119338989258,10.4119338989258,10.4119338989258,11.3688812255859,11.3688812255859,11.3688812255859,11.3688812255859,11.3688812255859,11.3688812255859,11.3688812255859,9.4149169921875,9.4149169921875,10.5407791137695,10.5407791137695,10.5407791137695,11.3053894042969,11.3053894042969,9.55866241455078,9.55866241455078,9.55866241455078,9.55866241455078,9.55866241455078,9.55866241455078,10.3274917602539,10.3274917602539,11.4220733642578,11.4220733642578,11.4220733642578,11.4220733642578,11.4220733642578,11.4220733642578,11.4220733642578,9.31727600097656,9.31727600097656,9.31727600097656,9.31727600097656,9.31727600097656,9.31727600097656,10.4729232788086,10.4729232788086,11.2138214111328,11.2138214111328,11.2138214111328,11.2138214111328,11.2138214111328,11.2138214111328,9.45043182373047,9.45043182373047,10.2229690551758,10.2229690551758,11.3519744873047,11.3519744873047,11.3519744873047,11.3519744873047,11.3519744873047,11.3519744873047,9.0703125,9.0703125,10.213264465332,10.213264465332,10.213264465332,10.213264465332,10.213264465332,10.213264465332,10.974983215332,10.974983215332,10.974983215332,10.974983215332,10.974983215332,10.974983215332,9.18742370605469,9.18742370605469,9.88278198242188,9.88278198242188,11.0235290527344,11.0235290527344,11.0235290527344,11.0235290527344,11.0235290527344,11.0235290527344,8.91691589355469,8.91691589355469,8.91691589355469,8.91691589355469,8.91691589355469,8.91691589355469,10.0579986572266,10.0579986572266,10.0579986572266,10.0579986572266,10.0579986572266,10.0579986572266,10.8185272216797,10.8185272216797,10.8185272216797,10.8185272216797,10.8185272216797,10.8185272216797,9.04437255859375,9.04437255859375,9.04437255859375,9.04437255859375,9.04437255859375,9.04437255859375,9.76764678955078,9.76764678955078,10.9195556640625,10.9195556640625,8.807861328125,8.807861328125,8.807861328125,8.807861328125,8.807861328125,8.807861328125,9.92285919189453,9.92285919189453,9.92285919189453,9.92285919189453,9.92285919189453,9.92285919189453,10.690071105957,10.690071105957,10.690071105957,10.690071105957,10.690071105957,10.690071105957,8.94710540771484,8.94710540771484,9.71247863769531,9.71247863769531,9.71247863769531,9.71247863769531,9.71247863769531,9.71247863769531,10.8433532714844,10.8433532714844,10.8433532714844,10.8433532714844,10.8433532714844,10.8433532714844,8.72045135498047,8.72045135498047,8.72045135498047,8.72045135498047,8.72045135498047,8.72045135498047],"meminc":[0,0,0.553382873535156,0,0,0,0,0,0.712738037109375,0,0,0,0,0,0.460494995117188,0,0,0,0,0,0.690780639648438,0,0,0,0,0,0.461585998535156,0,-5.28718566894531,0,0,0,0,0,0.769187927246094,0,1.13286590576172,0,0,0,0,0,-2.17449951171875,0,0,0,0,0,1.13901519775391,0,0,0,0,0,0.769050598144531,0,0,0,0,0,-1.79327392578125,0,0.761100769042969,0,0,0,0,0,1.16088104248047,0,0,0,0,0,-2.15721893310547,0,0,0,0,0,1.13130950927734,0,0,0,0,0,0.761734008789062,0,0,0,0,0,-1.75543212890625,0,0,0.751007080078125,0,0,0,0,0,1.15252685546875,0,0,0,0,0,-2.14810943603516,0,1.13157653808594,0,0,0,0,0,0.756736755371094,0,0,0,0,0,-1.77149963378906,0,0,0,0,0,0.755516052246094,0,1.14125061035156,0,-2.12879943847656,0,0,0,0,0,1.12559509277344,0,0,0,0,0,0.756591796875,0,-1.74140930175781,0,0,0,0,0,0.74688720703125,0,0,0,0,0,1.14849853515625,0,0,0,0,0,-2.13609313964844,0,0,0,0,0,1.12552642822266,0,0.770591735839844,0,-1.75990295410156,0,0,0,0,0,0.749717712402344,0,0,0,0,0,1.13221740722656,0,0.669708251953125,0,0,0,0,0,0,-2.27608489990234,0,0,0,0,0,0.663772583007812,0,0,0,0,0,1.02141571044922,0,0.581634521484375,0,0,0,0,0,0,-1.70539093017578,0,0,0,0,0,0.752487182617188,0,0,0,0,0,-1.74634552001953,0,0.743583679199219,0,0,0,0,0,1.16587829589844,0,0.743171691894531,0,0,0,0,0,-1.79812622070312,0,0,0.767127990722656,0,1.06914520263672,0,0,0,0,0,0,-2.07288360595703,0,0,0,0,0,1.14742279052734,0,0,0,0,0,0.761764526367188,0,-1.78558349609375,0,0,0,0,0,0.751182556152344,0,0,0,0,0,1.12162017822266,0,0,0,0,0,-2.09970092773438,0,0,0,0,0,1.12771606445312,0,0.7681884765625,0,-1.75474548339844,0,0.758491516113281,0,1.13152313232422,0,0,0,0,0,-2.13239288330078,0,0,0,0,0,1.14085388183594,0,0.744636535644531,0,0,0,0,0,-1.77407836914062,0,0.756149291992188,0,1.13007354736328,0,0,0,0,0,-2.12338256835938,0,1.11175537109375,0,0,0,0,0,0.745361328125,0,-1.72947692871094,0,0,0.772842407226562,0,1.13332366943359,0,-2.15090179443359,0,1.14091491699219,0,0,0,0,0,0.742462158203125,0,-1.76331329345703,0,0,0,0,0,0.750778198242188,0,1.14889526367188,0,0,0,0,0,0.564834594726562,0,0,0,0,0,0,-1.58234405517578,0,0.765617370605469,0,0,0,0,0,-1.74022674560547,0,0,0,0,0,0.73004150390625,0,1.14934539794922,0,0,0,0,0,0.721221923828125,0,0,0,0,0,0,-1.74310302734375,0,0,0,0,0,0.756607055664062,0,0,0,0,0,0.956947326660156,0,0,0,0,0,0,-1.95396423339844,0,1.12586212158203,0,0,0.764610290527344,0,-1.74672698974609,0,0,0,0,0,0.768829345703125,0,1.09458160400391,0,0,0,0,0,0,-2.10479736328125,0,0,0,0,0,1.15564727783203,0,0.740898132324219,0,0,0,0,0,-1.76338958740234,0,0.772537231445312,0,1.12900543212891,0,0,0,0,0,-2.28166198730469,0,1.14295196533203,0,0,0,0,0,0.76171875,0,0,0,0,0,-1.78755950927734,0,0.695358276367188,0,1.1407470703125,0,0,0,0,0,-2.10661315917969,0,0,0,0,0,1.14108276367188,0,0,0,0,0,0.760528564453125,0,0,0,0,0,-1.77415466308594,0,0,0,0,0,0.723274230957031,0,1.15190887451172,0,-2.1116943359375,0,0,0,0,0,1.11499786376953,0,0,0,0,0,0.7672119140625,0,0,0,0,0,-1.74296569824219,0,0.765373229980469,0,0,0,0,0,1.13087463378906,0,0,0,0,0,-2.12290191650391,0,0,0,0,0],"filename":[null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R","generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R","generate-primes-1.R",null,"generate-primes-1.R",null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R","generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R","generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null,"generate-primes-1.R",null,null,null,null,null]},"interval":10,"files":[{"filename":"generate-primes-1.R","content":"generate.primes.upto.1 <- function(N) {\n  primes <- 2\n  for (i in 3:N) {\n    found.divisor <- FALSE\n    for (j in primes) {\n      if (i %% j == 0) {\n        found.divisor <- TRUE\n      }\n    }\n    if (!found.divisor) primes <- c(primes,i)\n  }\n  return(primes)\n}\n","normpath":"/home/runner/work/sc1/sc1/content/profile-debug/generate-primes-1.R"}],"prof_output":"/tmp/RtmpmJoCr2/fileee091b4365c0.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>We see from the <code>profvis</code> results that most of the time is spent in line 6 performing the integer modulus operation. If we look at the code more closely, we can see that it is possible to eliminate some of these operations by breaking the loop over primes as soon as one divisor is found.</p>
<pre class="r"><code>source(&quot;generate-primes-2.R&quot;, keep.source=TRUE)
profvis(generate.primes.upto.2(10000))</code></pre>
<div class="profvis html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-2" style="width:100%;height:600px;"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"message":{"prof":{"time":[1,1,1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,6,6,7,7,7,7,7,7,8,8,9,9,9,9,9,9,9,10,10,11,11,12,12,12,12,12,12,13,13,13,13,13,13,14,14,15,15,15,15,15,15],"depth":[6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1,2,1,7,6,5,4,3,2,1,2,1,2,1,6,5,4,3,2,1,6,5,4,3,2,1,2,1,6,5,4,3,2,1],"label":["if (i %% j == 0) {","generate.primes.upto.2","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.2","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.2","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.2","eval","eval","eval.parent","local","found.divisor <- FALSE","generate.primes.upto.2","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.2","eval","eval","eval.parent","local","%%","local","<GC>","if (i %% j == 0) {","generate.primes.upto.2","eval","eval","eval.parent","local","%%","local","%%","local","if (i %% j == 0) {","generate.primes.upto.2","eval","eval","eval.parent","local","if (i %% j == 0) {","generate.primes.upto.2","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","generate.primes.upto.2","eval","eval","eval.parent","local"],"filenum":[1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null,1,null,null,1,null,null,null,null,null,1,null,1,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,1,null,null,null,null,null],"linenum":[6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,null,null,null,null,4,null,null,null,null,null,6,null,6,null,null,null,null,null,6,null,null,6,null,null,null,null,null,6,null,6,null,6,null,null,null,null,null,6,null,null,null,null,null,6,null,6,null,null,null,null,null],"memalloc":[10.4768218994141,10.4768218994141,10.4768218994141,10.4768218994141,10.4768218994141,10.4768218994141,11.4277801513672,11.4277801513672,11.4277801513672,11.4277801513672,11.4277801513672,11.4277801513672,12.7629852294922,12.7629852294922,12.7629852294922,12.7629852294922,12.7629852294922,12.7629852294922,10.0874710083008,10.0874710083008,10.0874710083008,10.0874710083008,10.0874710083008,10.0874710083008,11.6683349609375,11.6683349609375,11.6683349609375,11.6683349609375,11.6683349609375,11.6683349609375,12.7054977416992,12.7054977416992,10.4163055419922,10.4163055419922,10.4163055419922,10.4163055419922,10.4163055419922,10.4163055419922,11.4710311889648,11.4710311889648,12.9197082519531,12.9197082519531,12.9197082519531,12.9197082519531,12.9197082519531,12.9197082519531,12.9197082519531,10.2527542114258,10.2527542114258,11.8344955444336,11.8344955444336,12.8827285766602,12.8827285766602,12.8827285766602,12.8827285766602,12.8827285766602,12.8827285766602,10.6179733276367,10.6179733276367,10.6179733276367,10.6179733276367,10.6179733276367,10.6179733276367,11.6704483032227,11.6704483032227,9.42465209960938,9.42465209960938,9.42465209960938,9.42465209960938,9.42465209960938,9.42465209960938],"meminc":[0,0,0,0,0,0,0.950958251953125,0,0,0,0,0,1.335205078125,0,0,0,0,0,-2.67551422119141,0,0,0,0,0,1.58086395263672,0,0,0,0,0,1.03716278076172,0,-2.28919219970703,0,0,0,0,0,1.05472564697266,0,1.44867706298828,0,0,0,0,0,0,-2.66695404052734,0,1.58174133300781,0,1.04823303222656,0,0,0,0,0,-2.26475524902344,0,0,0,0,0,1.05247497558594,0,-2.24579620361328,0,0,0,0,0],"filename":["generate-primes-2.R",null,null,null,null,null,"generate-primes-2.R",null,null,null,null,null,"generate-primes-2.R",null,null,null,null,null,"generate-primes-2.R",null,null,null,null,null,"generate-primes-2.R",null,null,null,null,null,"generate-primes-2.R",null,"generate-primes-2.R",null,null,null,null,null,"generate-primes-2.R",null,null,"generate-primes-2.R",null,null,null,null,null,"generate-primes-2.R",null,"generate-primes-2.R",null,"generate-primes-2.R",null,null,null,null,null,"generate-primes-2.R",null,null,null,null,null,"generate-primes-2.R",null,"generate-primes-2.R",null,null,null,null,null]},"interval":10,"files":[{"filename":"generate-primes-2.R","content":"generate.primes.upto.2 <- function(N) {\n  primes <- 2\n  for (i in 3:N) {\n    found.divisor <- FALSE\n    for (j in primes) {\n      if (i %% j == 0) {\n        found.divisor <- TRUE\n        break\n      }\n    }\n    if (!found.divisor) primes <- c(primes,i)\n  }\n  return(primes)\n}\n","normpath":"/home/runner/work/sc1/sc1/content/profile-debug/generate-primes-2.R"}],"prof_output":"/tmp/RtmpmJoCr2/fileee0959aa53f.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>This has dramatically reduced the running time of the algorithm, by a factor of about 10. Although the function is fairly short, we may feel that the code is not easy to read. In particular, the overall idea of the algorithm can be lost in the implementation details. So we can consider the same algorithm, but where we call a helper function called <code>any.divisors</code> instead.</p>
<pre class="r"><code>source(&quot;generate-primes-3.R&quot;, keep.source=TRUE)
profvis(generate.primes.upto.3(10000))</code></pre>
<div class="profvis html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-3" style="width:100%;height:600px;"></div>
<script type="application/json" data-for="htmlwidget-3">{"x":{"message":{"prof":{"time":[1,1,1,1,1,1,2,2,2,2,2,2,2,3,3,3,3,3,3,3,4,4,5,5,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,9,9,9,9,9,9,9,10,10,11,11,11,11,11,11,11,12,12,12,12,12,12,12,13,13,13,13,13,13,13,14,14,14],"depth":[6,5,4,3,2,1,7,6,5,4,3,2,1,7,6,5,4,3,2,1,2,1,2,1,7,6,5,4,3,2,1,8,7,6,5,4,3,2,1,7,6,5,4,3,2,1,7,6,5,4,3,2,1,2,1,7,6,5,4,3,2,1,7,6,5,4,3,2,1,7,6,5,4,3,2,1,3,2,1],"label":["primes <- c(primes,i)","generate.primes.upto.3","eval","eval","eval.parent","local","if (i %% j == 0) {","any.divisors","generate.primes.upto.3","eval","eval","eval.parent","local","if (i %% j == 0) {","any.divisors","generate.primes.upto.3","eval","eval","eval.parent","local","%%","local","%%","local","if (i %% j == 0) {","any.divisors","generate.primes.upto.3","eval","eval","eval.parent","local","<GC>","if (i %% j == 0) {","any.divisors","generate.primes.upto.3","eval","eval","eval.parent","local","if (i %% j == 0) {","any.divisors","generate.primes.upto.3","eval","eval","eval.parent","local","for (j in ps) {","any.divisors","generate.primes.upto.3","eval","eval","eval.parent","local","%%","local","if (i %% j == 0) {","any.divisors","generate.primes.upto.3","eval","eval","eval.parent","local","if (i %% j == 0) {","any.divisors","generate.primes.upto.3","eval","eval","eval.parent","local","if (i %% j == 0) {","any.divisors","generate.primes.upto.3","eval","eval","eval.parent","local","if (i %% j == 0) {","%%","local"],"filenum":[1,null,null,null,null,null,1,1,null,null,null,null,null,1,1,null,null,null,null,null,1,null,1,null,1,1,null,null,null,null,null,null,1,1,null,null,null,null,null,1,1,null,null,null,null,null,1,1,null,null,null,null,null,1,null,1,1,null,null,null,null,null,1,1,null,null,null,null,null,1,1,null,null,null,null,null,1,1,null],"linenum":[14,null,null,null,null,null,3,13,null,null,null,null,null,3,13,null,null,null,null,null,3,null,3,null,3,13,null,null,null,null,null,null,3,13,null,null,null,null,null,3,13,null,null,null,null,null,2,13,null,null,null,null,null,3,null,3,13,null,null,null,null,null,3,13,null,null,null,null,null,3,13,null,null,null,null,null,3,3,null],"memalloc":[10.3903884887695,10.3903884887695,10.3903884887695,10.3903884887695,10.3903884887695,10.3903884887695,11.0811386108398,11.0811386108398,11.0811386108398,11.0811386108398,11.0811386108398,11.0811386108398,11.0811386108398,12.1246948242188,12.1246948242188,12.1246948242188,12.1246948242188,12.1246948242188,12.1246948242188,12.1246948242188,9.74923706054688,9.74923706054688,10.8155746459961,10.8155746459961,11.522102355957,11.522102355957,11.522102355957,11.522102355957,11.522102355957,11.522102355957,11.522102355957,12.5394744873047,12.5394744873047,12.5394744873047,12.5394744873047,12.5394744873047,12.5394744873047,12.5394744873047,12.5394744873047,10.0438232421875,10.0438232421875,10.0438232421875,10.0438232421875,10.0438232421875,10.0438232421875,10.0438232421875,11.114143371582,11.114143371582,11.114143371582,11.114143371582,11.114143371582,11.114143371582,11.114143371582,11.8285217285156,11.8285217285156,9.59083557128906,9.59083557128906,9.59083557128906,9.59083557128906,9.59083557128906,9.59083557128906,9.59083557128906,10.3048858642578,10.3048858642578,10.3048858642578,10.3048858642578,10.3048858642578,10.3048858642578,10.3048858642578,11.3828964233398,11.3828964233398,11.3828964233398,11.3828964233398,11.3828964233398,11.3828964233398,11.3828964233398,12.1023712158203,12.1023712158203,12.1023712158203],"meminc":[0,0,0,0,0,0,0.690750122070312,0,0,0,0,0,0,1.04355621337891,0,0,0,0,0,0,-2.37545776367188,0,1.06633758544922,0,0.706527709960938,0,0,0,0,0,0,1.01737213134766,0,0,0,0,0,0,0,-2.49565124511719,0,0,0,0,0,0,1.07032012939453,0,0,0,0,0,0,0.714378356933594,0,-2.23768615722656,0,0,0,0,0,0,0.71405029296875,0,0,0,0,0,0,1.07801055908203,0,0,0,0,0,0,0.719474792480469,0,0],"filename":["generate-primes-3.R",null,null,null,null,null,"generate-primes-3.R","generate-primes-3.R",null,null,null,null,null,"generate-primes-3.R","generate-primes-3.R",null,null,null,null,null,"generate-primes-3.R",null,"generate-primes-3.R",null,"generate-primes-3.R","generate-primes-3.R",null,null,null,null,null,null,"generate-primes-3.R","generate-primes-3.R",null,null,null,null,null,"generate-primes-3.R","generate-primes-3.R",null,null,null,null,null,"generate-primes-3.R","generate-primes-3.R",null,null,null,null,null,"generate-primes-3.R",null,"generate-primes-3.R","generate-primes-3.R",null,null,null,null,null,"generate-primes-3.R","generate-primes-3.R",null,null,null,null,null,"generate-primes-3.R","generate-primes-3.R",null,null,null,null,null,"generate-primes-3.R","generate-primes-3.R",null]},"interval":10,"files":[{"filename":"generate-primes-3.R","content":"any.divisors <- function(i, ps) {\n  for (j in ps) {\n    if (i %% j == 0) {\n      return(TRUE)\n    }\n  }\n  return(FALSE)\n}\n\ngenerate.primes.upto.3 <- function(N) {\n  primes <- 2\n  for (i in 3:N) {\n    if (!any.divisors(i, primes)) {\n      primes <- c(primes,i)\n    }\n  }\n  return(primes)\n}\n","normpath":"/home/runner/work/sc1/sc1/content/profile-debug/generate-primes-3.R"}],"prof_output":"/tmp/RtmpmJoCr2/fileee091d3627eb.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>It seems reasonable to say that the third version of the algorithm is easier to understand. Moreover, there is little to no performance penalty.</p>
</div>
<div id="the-sieve-of-eratosthenes" class="section level2">
<h2>The Sieve of Eratosthenes</h2>
<p>A more computationally efficient approach is the <a href="https://en.wikipedia.org/wiki/Sieve_of_Eratosthenes">Sieve of Eratosthenes</a>. In this approach, one does not check whether each number is prime by checking divisors. Instead, one starts with a list of numbers from <span class="math inline">\(1\)</span> to <span class="math inline">\(N\)</span> and successively marks all multiples of each prime, in order, as composite. To identify the next prime after <span class="math inline">\(2\)</span> for marking multiples, one simply needs to find the next number not marked composite.</p>
<p>This approach is so much faster, that we consider finding all primes up to <span class="math inline">\(1000000\)</span> instead of up to <span class="math inline">\(10000\)</span>.</p>
<pre class="r"><code>source(&quot;sieve-1.R&quot;, keep.source=TRUE)
profvis(sieve.1(1000000))</code></pre>
<div class="profvis html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-4" style="width:100%;height:600px;"></div>
<script type="application/json" data-for="htmlwidget-4">{"x":{"message":{"prof":{"time":[1,1,1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,6,6,6,6,6,6,7,7,7,7,7,7,8,8,8,8,8,8,9,9,9,9,9,9,10,10,10,10,10,10,11,11,11,11,11,11,12,12,12,12,12,12,13,13,13,13,13,13,14,14,14,14,14,14,15,15,15,15,15,15,16,16,16,16,16,16,17,17,17,17,17,17,18,18,18,18,18,18,19,19,19,19,19,19,20,20,20,20,20,20,21,21,21,21,21,21,22,22,22,22,22,22,23,23,23,23,23,23,24,24,24,24,24,24,25,25,25,25,25,25,26,26,26,26,26,26,27,27,27,27,27,27,28,28,28,28,28,28,29,29,29,29,29,29],"depth":[6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1],"label":["s <- s + i","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","s <- s + i","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","s <- s + i","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","while (s <= N) {","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","while (s <= N) {","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","s <- s + i","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","while (s <= N) {","sieve.1","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.1","eval","eval","eval.parent","local","while (s <= N) {","sieve.1","eval","eval","eval.parent","local","s <- s + i","sieve.1","eval","eval","eval.parent","local","s <- i*2","sieve.1","eval","eval","eval.parent","local","if (candidates[i]) {","sieve.1","eval","eval","eval.parent","local","for (i in 2:N) {","sieve.1","eval","eval","eval.parent","local","for (i in 2:N) {","sieve.1","eval","eval","eval.parent","local","if (candidates[i]) {","sieve.1","eval","eval","eval.parent","local","if (candidates[i]) {","sieve.1","eval","eval","eval.parent","local"],"filenum":[1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null],"linenum":[10,null,null,null,null,null,9,null,null,null,null,null,9,null,null,null,null,null,9,null,null,null,null,null,10,null,null,null,null,null,9,null,null,null,null,null,9,null,null,null,null,null,9,null,null,null,null,null,10,null,null,null,null,null,9,null,null,null,null,null,9,null,null,null,null,null,8,null,null,null,null,null,9,null,null,null,null,null,9,null,null,null,null,null,8,null,null,null,null,null,9,null,null,null,null,null,10,null,null,null,null,null,9,null,null,null,null,null,9,null,null,null,null,null,8,null,null,null,null,null,9,null,null,null,null,null,8,null,null,null,null,null,10,null,null,null,null,null,7,null,null,null,null,null,5,null,null,null,null,null,4,null,null,null,null,null,4,null,null,null,null,null,5,null,null,null,null,null,5,null,null,null,null,null],"memalloc":[13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695,13.4812088012695],"meminc":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"filename":["sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null,"sieve-1.R",null,null,null,null,null]},"interval":10,"files":[{"filename":"sieve-1.R","content":"sieve.1 <- function(N) {\n  candidates <- rep(TRUE,N)\n  candidates[1] <- FALSE\n  for (i in 2:N) {\n    if (candidates[i]) {\n      # i is prime\n      s <- i*2\n      while (s <= N) {\n        candidates[s] <- FALSE\n        s <- s + i\n      }\n    }\n  }\n  return((1:N)[candidates])\n}\n","normpath":"/home/runner/work/sc1/sc1/content/profile-debug/sieve-1.R"}],"prof_output":"/tmp/RtmpmJoCr2/fileee0928563493.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>We see that most of the time is spent in lines 8–10, which correspond to marking <code>s</code> as composite and incrementing <code>s</code> by the current prime. We can remove some of these computations by noticing that if <span class="math inline">\(i\)</span> is prime then all multiples <span class="math inline">\(2i,3i,\ldots,(i-1)i\)</span> will already have been marked as composite. It follows that one can also stop “sieving” as soon as <span class="math inline">\(i &gt; \sqrt{N}\)</span>.</p>
<pre class="r"><code>source(&quot;sieve-2.R&quot;, keep.source=TRUE)
profvis(sieve.2(1000000))</code></pre>
<div class="profvis html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-5" style="width:100%;height:600px;"></div>
<script type="application/json" data-for="htmlwidget-5">{"x":{"message":{"prof":{"time":[1,1,1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,6,6,6,6,6,6,7,7,7,7,7,7,8,8,8,8,8,8,9,9,9,9,9,9,10,10,10,10,10,10,11,11,11,11,11,11,12,12,12,12,12,12,13,13,13,13,13,13,14,14,14,14,14,14,15,15,15,15,15,15,16,16,16,16,16,16],"depth":[6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1],"label":["while (s <= N) {","sieve.2","eval","eval","eval.parent","local","s <- s + i","sieve.2","eval","eval","eval.parent","local","while (s <= N) {","sieve.2","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.2","eval","eval","eval.parent","local","s <- s + i","sieve.2","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.2","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.2","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.2","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.2","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.2","eval","eval","eval.parent","local","s <- s + i","sieve.2","eval","eval","eval.parent","local","candidates[s] <- FALSE","sieve.2","eval","eval","eval.parent","local","s <- s + i","sieve.2","eval","eval","eval.parent","local","s <- s + i","sieve.2","eval","eval","eval.parent","local","while (s <= N) {","sieve.2","eval","eval","eval.parent","local","s <- s + i","sieve.2","eval","eval","eval.parent","local"],"filenum":[1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null],"linenum":[9,null,null,null,null,null,11,null,null,null,null,null,9,null,null,null,null,null,10,null,null,null,null,null,11,null,null,null,null,null,10,null,null,null,null,null,10,null,null,null,null,null,10,null,null,null,null,null,10,null,null,null,null,null,10,null,null,null,null,null,11,null,null,null,null,null,10,null,null,null,null,null,11,null,null,null,null,null,11,null,null,null,null,null,9,null,null,null,null,null,11,null,null,null,null,null],"memalloc":[13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039,13.4969253540039],"meminc":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"filename":["sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null,"sieve-2.R",null,null,null,null,null]},"interval":10,"files":[{"filename":"sieve-2.R","content":"sieve.2 <- function(N) {\n  candidates <- rep(TRUE,N)\n  candidates[1] <- FALSE\n  sqrt.N <- sqrt(N)\n  for (i in 2:sqrt.N) {\n    if (candidates[i]) {\n      # i is prime\n      s <- i*i\n      while (s <= N) {\n        candidates[s] <- FALSE\n        s <- s + i\n      }\n    }\n  }\n  return((1:N)[candidates])\n}\n","normpath":"/home/runner/work/sc1/sc1/content/profile-debug/sieve-2.R"}],"prof_output":"/tmp/RtmpmJoCr2/fileee093f6dd34d.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>There appears to be a moderate improvement in performance for this size of problem. We notice that a substantial amount of time is spent in the <code>while</code> loop, which mainly involves incrementing <code>s</code> and flagging the corresponding number as composite. We can vectorize this computation and separate it cleanly from the rest of the algorithm, as follows.</p>
<pre class="r"><code>source(&quot;sieve-3.R&quot;, keep.source=TRUE)
profvis(sieve.3(1000000))</code></pre>
<div class="profvis html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-6" style="width:100%;height:600px;"></div>
<script type="application/json" data-for="htmlwidget-6">{"x":{"message":{"prof":{"time":[1,1,1,1,1,1,2,2,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,6,6,6,6,6,6],"depth":[6,5,4,3,2,1,7,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1,6,5,4,3,2,1],"label":["candidates[multiples] <- FALSE","sieve.3","eval","eval","eval.parent","local","seq.default","get.multiples","sieve.3","eval","eval","eval.parent","local","candidates[multiples] <- FALSE","sieve.3","eval","eval","eval.parent","local","candidates[multiples] <- FALSE","sieve.3","eval","eval","eval.parent","local","multiples <- get.multiples(i, N)","sieve.3","eval","eval","eval.parent","local","return((1:N)[candidates])","sieve.3","eval","eval","eval.parent","local"],"filenum":[1,null,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null,1,null,null,null,null,null],"linenum":[15,null,null,null,null,null,null,14,null,null,null,null,null,15,null,null,null,null,null,15,null,null,null,null,null,14,null,null,null,null,null,18,null,null,null,null,null],"memalloc":[23.0713806152344,23.0713806152344,23.0713806152344,23.0713806152344,23.0713806152344,23.0713806152344,28.909912109375,28.909912109375,28.909912109375,28.909912109375,28.909912109375,28.909912109375,28.909912109375,37.3025665283203,37.3025665283203,37.3025665283203,37.3025665283203,37.3025665283203,37.3025665283203,45.5361480712891,45.5361480712891,45.5361480712891,45.5361480712891,45.5361480712891,45.5361480712891,59.1777954101562,59.1777954101562,59.1777954101562,59.1777954101562,59.1777954101562,59.1777954101562,17.1719741821289,17.1719741821289,17.1719741821289,17.1719741821289,17.1719741821289,17.1719741821289],"meminc":[0,0,0,0,0,0,5.83853149414062,0,0,0,0,0,0,8.39265441894531,0,0,0,0,0,8.23358154296875,0,0,0,0,0,13.6416473388672,0,0,0,0,0,-42.0058212280273,0,0,0,0,0],"filename":["sieve-3.R",null,null,null,null,null,null,"sieve-3.R",null,null,null,null,null,"sieve-3.R",null,null,null,null,null,"sieve-3.R",null,null,null,null,null,"sieve-3.R",null,null,null,null,null,"sieve-3.R",null,null,null,null,null]},"interval":10,"files":[{"filename":"sieve-3.R","content":"get.multiples <- function(i, N) {\n  n <- floor(N/i) - i\n  if (n <= 0) return(NULL)\n  multiples <- seq(i*i,(i+n)*i,i)\n  return(multiples)\n}\n\nsieve.3 <- function(N) {\n  candidates <- rep(TRUE,N)\n  candidates[1] <- FALSE\n  sqrt.N <- sqrt(N)\n  for (i in 2:sqrt.N) {\n    if (candidates[i]) {\n      multiples <- get.multiples(i, N)\n      candidates[multiples] <- FALSE\n    }\n  }\n  return((1:N)[candidates])\n}\n","normpath":"/home/runner/work/sc1/sc1/content/profile-debug/sieve-3.R"}],"prof_output":"/tmp/RtmpmJoCr2/fileee0934e53b73.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>This gives another improvement to performance. It is worth noting that creating an array of multiples is faster than iterating through multiples in R, because the cost of allocating memory is negligible in comparison to the benefit of eliminating the loop. In a programming language such as C, the reverse is often true, as allocating memory is typically expensive in comparison to iteration once compiled into machine code.</p>
</div>
<div id="comments" class="section level2">
<h2>Comments</h2>
<p>Profiling in this scenario is already quite useful, as one can see which parts of the code are critical for performance. In larger applications, profiling is even more useful as one can quickly determine which functions are the most important from a performance perspective: if 1% of computation time is spent in a particular function, very little improvement can be derived by improving it, whereas if 99% of computation time is spent in a function one can conceivably improve performance very substantially by accelerating the implementation or improving the corresponding algorithm itself.</p>
<p>Profiling is also helpful for maintaining code readability and modularity: in some cases performance can be improved by sacrificing readability, or modularity of the code. Doing so can make sense if the code is critical to performance, but it makes little sense when the code is unimportant from a performance perspective.</p>
<p>Finally, when profiling code and trying to improve its performance, good testing tools are very useful for ensuring that any improvement in performance has not come at the cost of breaking existing functionality, including in rare, corner cases.</p>
</div>



  <footer>
  

<script src="//yihui.name/js/math-code.js"></script>
<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<script async src="//yihui.name/js/center-img.js"></script>


<script type="text/javascript">
var sc_project=12110974;
var sc_invisible=1;
var sc_security="9b171880";
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="https://statcounter.com/" target="_blank"><img
class="statcounter"
src="https://c.statcounter.com/12110974/0/9b171880/1/"
alt="Web Analytics"></a></div></noscript>








  


<p align=right>

<a href='https://github.com/awllee/sc1/blob/master/content/profile-debug/profile.Rmd'>View source</a>

|

<a href='https://github.com/awllee/sc1/edit/master/content/profile-debug/profile.Rmd'>Edit source</a>

</p>





<script src="https://utteranc.es/client.js"
        repo="awllee/sc1"
        issue-term="pathname"
        label="utterance"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>



  











<script src="//cdn.jsdelivr.net/combine/gh/highlightjs/cdn-release@9.12.0/build/highlight.min.js,gh/highlightjs/cdn-release@9.12.0/build/languages/r.min.js,gh/highlightjs/cdn-release@9.12.0/build/languages/yaml.min.js,gh/highlightjs/cdn-release@9.12.0/build/languages/tex.min.js,npm/@xiee/utils/js/load-highlight.js" defer></script>



  
  <hr>
  <div class="copyright">© 2020 <a href="https://sites.google.com/view/anthonylee">Anthony Lee</a>, <a href="http://www.bristol.ac.uk/maths/people/feng-yu/index.html">Feng Yu</a>, <a href="https://people.maths.bris.ac.uk/~tk18582/">Tobias Kley</a>, <a href="https://mfasiolo.github.io/">Matteo Fasiolo</a></div>
  
  </footer>
  </article>
  
  </body>
</html>

