<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>R apply family, sweep, map, reduce, filter - SC1</title>
    <meta property="og:title" content="R apply family, sweep, map, reduce, filter - SC1">
    
    <meta name="twitter:card" content="summary">

    
      
    

    
      
      <meta property="description" content="The apply family of functions consist of apply(), lapply(), sapply(), and mapply(). The basic idea of the apply family is to apply the same function repetitively across a list or a certain dimension &amp;hellip;">
      <meta property="og:description" content="The apply family of functions consist of apply(), lapply(), sapply(), and mapply(). The basic idea of the apply family is to apply the same function repetitively across a list or a certain dimension &amp;hellip;">
      
    

    
    

    

    
    


<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.12.0/build/styles/github.min.css">



    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Arvo">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Marcellus">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro">

<link rel="stylesheet" href="/css/custom.css" />

<link rel="icon" href="/sc1/favicon.ico" type="image/x-icon" />



























<nav class="breadcrumbs">
    
        <a href="sc1">home / </a>
    
        <a href="sc1/common-r/">common-r / </a>
    
        <a href="sc1/common-r/apply/">apply / </a>
    
</nav>

  </head>

  
  <body class="sc1/common-r/apply/">
    <header class="masthead">
      <h1><a href="/">SC1</a></h1>

<p class="tagline">Statistical Computing 1</p>

      <nav class="menu">
  <input id="menu-check" type="checkbox" hidden/>
  <label id="menu-label" for="menu-check" class="unselectable" hidden>
    <span class="icon close-icon">✕</span>
    <span class="icon open-icon">☰</span>
    <span class="text">Menu</span>
  </label>
  <ul>
  
  
  <li><a href="sc1/">Home</a></li>
  
  <li><a href="sc1/intro-r/">Intro to R</a></li>
  
  <li><a href="sc1/reproducibility/">Reproducibility</a></li>
  
  <li><a href="sc1/packages/">Packages</a></li>
  
  <li><a href="sc1/common-r/">Common R</a></li>
  
  <li><a href="sc1/functional-oo/">Functional / OO</a></li>
  
  <li><a href="sc1/tidyverse/">Tidyverse</a></li>
  
  <li><a href="sc1/profile-debug/">Performance / Bugs</a></li>
  
  <li><a href="sc1/matrices/">Matrices</a></li>
  
  <li><a href="sc1/optimization/">Optimization</a></li>
  
  <li><a href="sc1/integration/">Integration</a></li>
  
  
  </ul>
</nav>

    </header>

    <article class="main">
      <header class="title">
      
<h1>R apply family, sweep, map, reduce, filter</h1>

<h3>
</h3>
<hr>


      </header>








<div id="r-apply-family" class="section level2">
<h2>R apply family</h2>
<p>The apply family of functions consist of <code>apply()</code>, <code>lapply()</code>, <code>sapply()</code>, and <code>mapply()</code>. The basic idea of the apply family is to apply the same function repetitively across a list or a certain dimension of an array or dataframe.</p>
<div id="apply" class="section level3">
<h3>apply</h3>
<p>We start with <code>apply()</code>. Its syntax is <code>apply(X, MARGIN, FUN, ...)</code>, where</p>
<ul>
<li><code>X</code> is an array of dimension <span class="math inline">\(\ge 2\)</span>, including a 2-d matrix.</li>
<li><code>MARGIN</code> is a vector giving the subscripts which the function will be applied over. E.g., for a matrix 1 indicates rows (i.e. output has length equal to number of rows), 2 indicates columns (i.e. output has length equal to number of columns), <code>c(1, 2)</code> indicates rows and columns (i.e. output remains a matrix of the same dimension).</li>
<li><code>FUN</code> is the function to be applied</li>
</ul>
<p>As an example, we construct a matrix of all 1’s and sum across rows and columns:</p>
<pre class="r"><code>x &lt;- matrix(1, nrow=3, ncol=4)
apply(x, 1, sum)</code></pre>
<pre><code>## [1] 4 4 4</code></pre>
<pre class="r"><code>apply(x, 2, sum)</code></pre>
<pre><code>## [1] 3 3 3 3</code></pre>
<pre class="r"><code>apply(x, c(1,2), sum)</code></pre>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    1    1    1
## [2,]    1    1    1    1
## [3,]    1    1    1    1</code></pre>
<p>The function can be defined by the user. For example,</p>
<pre class="r"><code>apply(x, 1, function(x) sum(exp(x)))</code></pre>
<pre><code>## [1] 10.87313 10.87313 10.87313</code></pre>
<p>The input can also be a higher dimensional array</p>
<pre class="r"><code>apply(array(1, dim=c(2,3,4)), c(1,2), sum)</code></pre>
<pre><code>##      [,1] [,2] [,3]
## [1,]    4    4    4
## [2,]    4    4    4</code></pre>
</div>
<div id="lapply" class="section level3">
<h3>lapply</h3>
<p>In contrast to <code>apply</code>, which must be applied to data of higher than one dimension, <code>lapply</code> applies a function over a list or vector and outputs a list. Its basic usage is <code>lapply(X, FUN, …)</code>. For example,</p>
<pre class="r"><code>lapply(rep(1,5), exp)</code></pre>
<pre><code>## [[1]]
## [1] 2.718282
## 
## [[2]]
## [1] 2.718282
## 
## [[3]]
## [1] 2.718282
## 
## [[4]]
## [1] 2.718282
## 
## [[5]]
## [1] 2.718282</code></pre>
<pre class="r"><code>x &lt;- list(a=1:10, b=exp(-3:3), c=c(TRUE,FALSE,FALSE,TRUE))
lapply(x, mean)</code></pre>
<pre><code>## $a
## [1] 5.5
## 
## $b
## [1] 4.535125
## 
## $c
## [1] 0.5</code></pre>
<pre class="r"><code>lapply(x, quantile, probs=(1:3)/4)</code></pre>
<pre><code>## $a
##  25%  50%  75% 
## 3.25 5.50 7.75 
## 
## $b
##       25%       50%       75% 
## 0.2516074 1.0000000 5.0536690 
## 
## $c
## 25% 50% 75% 
## 0.0 0.5 1.0</code></pre>
</div>
<div id="sapply" class="section level3">
<h3>sapply</h3>
<p>The <code>sapply()</code> function works like <code>lapply()</code>, but it tries to simplify the output as much as possible.</p>
<pre class="r"><code>sapply(rep(1,5), exp)</code></pre>
<pre><code>## [1] 2.718282 2.718282 2.718282 2.718282 2.718282</code></pre>
<pre class="r"><code>unlist(lapply(rep(1,5), exp))</code></pre>
<pre><code>## [1] 2.718282 2.718282 2.718282 2.718282 2.718282</code></pre>
<pre class="r"><code>sapply(x, mean)</code></pre>
<pre><code>##        a        b        c 
## 5.500000 4.535125 0.500000</code></pre>
<pre class="r"><code>sapply(x, quantile, probs=(1:3)/4)</code></pre>
<pre><code>##        a         b   c
## 25% 3.25 0.2516074 0.0
## 50% 5.50 1.0000000 0.5
## 75% 7.75 5.0536690 1.0</code></pre>
</div>
<div id="mapply" class="section level3">
<h3>mapply</h3>
<p><code>mapply</code> is a multivariate version of <code>sapply</code>. It is useful if you have more than one input to the function. Its basic usage is <code>mapply(FUN, ...,)</code>, where … stands for the inputs to <code>FUN</code>. Notice that the order of parameters is in a different order to <code>apply</code> or <code>lapply</code>. (Why?)</p>
<pre class="r"><code>mapply(rep, 1:4, 4:1)</code></pre>
<pre><code>## [[1]]
## [1] 1 1 1 1
## 
## [[2]]
## [1] 2 2 2
## 
## [[3]]
## [1] 3 3
## 
## [[4]]
## [1] 4</code></pre>
<pre class="r"><code>mapply(rep, times=1:4, x=4:1)</code></pre>
<pre><code>## [[1]]
## [1] 4
## 
## [[2]]
## [1] 3 3
## 
## [[3]]
## [1] 2 2 2
## 
## [[4]]
## [1] 1 1 1 1</code></pre>
<pre class="r"><code>mapply(function(x, y) seq_len(x) + y, c(a=1, b=2, c=3), c(A=10, B=0, C=-10))</code></pre>
<pre><code>## $a
## [1] 11
## 
## $b
## [1] 1 2
## 
## $c
## [1] -9 -8 -7</code></pre>
</div>
</div>
<div id="speed-vs-for-loop" class="section level2">
<h2>Speed vs for loop</h2>
<p>To compare the performance of a piece of code written using <code>lapply</code> vs <code>for</code> loop, we use the following simple function</p>
<pre class="r"><code>ftest1 &lt;- function(x) log(0.43 * x + 1)
x &lt;- 1:1e6 #runif(1e+06, min=-1, max=1)
ftest1_apply &lt;- function(x) lapply(x, ftest1)
ftest1_loop &lt;- function(x) {
  y &lt;- rep(NA, length(x))
  for (i in 1:length(x)) y[i] &lt;- ftest1(x[i])
  y
}
system.time(ftest1_apply(x))</code></pre>
<pre><code>##    user  system elapsed 
##   1.137   0.207   1.351</code></pre>
<pre class="r"><code>system.time(ftest1_loop(x))</code></pre>
<pre><code>##    user  system elapsed 
##   0.752   0.006   0.760</code></pre>
<pre class="r"><code>system.time(ftest1(x))</code></pre>
<pre><code>##    user  system elapsed 
##   0.012   0.000   0.012</code></pre>
<p>The results show that <code>lapply</code> is the slowest, with for loop being twice as fast as <code>lapply</code>. But obviously applying the function directly (hence vectorised) is the fastest by far.</p>
</div>
<div id="map-reduce-and-filter" class="section level2">
<h2>Map, Reduce and Filter</h2>
<p>First, a word on the lambda notation, which is a short, typically one-line, definition of a function:
<code>{function (x) x+1}</code>. Such a function is also known as an anonymous function as there is no name attached to it. Note that this alone does nothing in <code>R</code>. It has to be used in Map, Reduce, Filter, or another function that takes functions as inputs. Note also that the first letter of the following functions are capped.</p>
<div id="map" class="section level3">
<h3>Map</h3>
<p>The function <code>Map</code> maps the same function to every element in a vector. For example,</p>
<pre class="r"><code>x &lt;- 1:6
y &lt;- Map({function(a) a*a}, x)
y</code></pre>
<pre><code>## [[1]]
## [1] 1
## 
## [[2]]
## [1] 4
## 
## [[3]]
## [1] 9
## 
## [[4]]
## [1] 16
## 
## [[5]]
## [1] 25
## 
## [[6]]
## [1] 36</code></pre>
<pre class="r"><code>unlist(y)</code></pre>
<pre><code>## [1]  1  4  9 16 25 36</code></pre>
</div>
<div id="reduce" class="section level3">
<h3>Reduce</h3>
<p>The function <code>Reduce</code> will perform the function on pairs of elements of a vector, iterate the procedure, and return a single number. For example,</p>
<pre class="r"><code>Reduce(function(a, b) a+b, x)</code></pre>
<pre><code>## [1] 21</code></pre>
<pre class="r"><code>Reduce(function(x, y) x*y, x)</code></pre>
<pre><code>## [1] 720</code></pre>
<p>Note that in the last line, <code>x</code> and <code>y</code> in the lambda definition of the function is internal to the function itself and has no meaning outside.</p>
</div>
<div id="filter" class="section level3">
<h3>Filter</h3>
<p>The function <code>Filter</code> goes down a vector and only keep elements that satisfies the condition determined by the function. For example,</p>
<pre class="r"><code>Filter(function(x) x %% 2 == 0, x)</code></pre>
<pre><code>## [1] 2 4 6</code></pre>
<pre class="r"><code>Filter(function(x) x&gt;3, x)</code></pre>
<pre><code>## [1] 4 5 6</code></pre>
<pre class="r"><code>Filter(function(x) x-1, x) # bad style</code></pre>
<pre><code>## [1] 2 3 4 5 6</code></pre>
<p>Note that in R, 0 is treated as <code>FALSE</code>, whereas any non-zero number is treated as <code>TRUE</code></p>
</div>
</div>



  <footer>
  

<script src="//yihui.name/js/math-code.js"></script>
<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<script async src="//yihui.name/js/center-img.js"></script>


<script type="text/javascript">
var sc_project=12110974;
var sc_invisible=1;
var sc_security="9b171880";
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="https://statcounter.com/" target="_blank"><img
class="statcounter"
src="https://c.statcounter.com/12110974/0/9b171880/1/"
alt="Web Analytics"></a></div></noscript>








  


<p align=right>

<a href='https://github.com/awllee/sc1/blob/master/content/common-r/apply.Rmd'>View source</a>

|

<a href='https://github.com/awllee/sc1/edit/master/content/common-r/apply.Rmd'>Edit source</a>

</p>





<script src="https://utteranc.es/client.js"
        repo="awllee/sc1"
        issue-term="pathname"
        label="utterance"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>



  











<script src="//cdn.jsdelivr.net/combine/gh/highlightjs/cdn-release@9.12.0/build/highlight.min.js,gh/highlightjs/cdn-release@9.12.0/build/languages/r.min.js,gh/highlightjs/cdn-release@9.12.0/build/languages/yaml.min.js,gh/highlightjs/cdn-release@9.12.0/build/languages/tex.min.js,npm/@xiee/utils/js/load-highlight.js" defer></script>



  
  <hr>
  <div class="copyright">© 2020 <a href="https://sites.google.com/view/anthonylee">Anthony Lee</a>, <a href="http://www.bristol.ac.uk/maths/people/feng-yu/index.html">Feng Yu</a>, <a href="https://people.maths.bris.ac.uk/~tk18582/">Tobias Kley</a>, <a href="https://mfasiolo.github.io/">Matteo Fasiolo</a></div>
  
  </footer>
  </article>
  
  </body>
</html>

