<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Data - SC1</title>
    <meta property="og:title" content="Data - SC1">
    
    <meta name="twitter:card" content="summary">

    
      
    

    
      
      <meta property="description" content="This page introduces a few basics ways to deal with data in R.
[&amp;hellip;] R has many functions for simulating random variates from common distributions, as well as evaluating their density / mass &amp;hellip;">
      <meta property="og:description" content="This page introduces a few basics ways to deal with data in R.
[&amp;hellip;] R has many functions for simulating random variates from common distributions, as well as evaluating their density / mass &amp;hellip;">
      
    

    
    

    

    
    


<link href='//cdn.bootcss.com/highlight.js/9.12.0/styles/github.min.css' rel='stylesheet' type='text/css' />



    <link rel="stylesheet" href="/sc1/css/style.css" />
    <link rel="stylesheet" href="/sc1/css/fonts.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Arvo">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Marcellus">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro">

<link rel="stylesheet" href="/sc1/css/custom.css" />

<link rel="icon" href="/sc1/favicon.ico" type="image/x-icon" />























<nav class="breadcrumbs">
    
        <a href="https://awllee.github.io/sc1/">home / </a>
    
        <a href="https://awllee.github.io/sc1/intro-r/">intro-r / </a>
    
        <a href="https://awllee.github.io/sc1/intro-r/data/">data / </a>
    
</nav>

  </head>

  
  <body class="sc1">
    <header class="masthead">
      <h1><a href="/sc1/">SC1</a></h1>

<p class="tagline">Statistical Computing 1</p>

      <nav class="menu">
  <input id="menu-check" type="checkbox" />
  <label id="menu-label" for="menu-check" class="unselectable">
    <span class="icon close-icon">✕</span>
    <span class="icon open-icon">☰</span>
    <span class="text">Menu</span>
  </label>
  <ul>
  
  
  <li><a href="/sc1/">Home</a></li>
  
  <li><a href="/sc1/intro-r/">Intro to R</a></li>
  
  <li><a href="/sc1/reproducibility/">Reproducibility</a></li>
  
  <li><a href="/sc1/common-r/">Common R</a></li>
  
  <li><a href="/sc1/tidyverse/">Tidyverse</a></li>
  
  <li><a href="/sc1/packages/">Packages</a></li>
  
  <li><a href="/sc1/functional-oo/">Functional / OO</a></li>
  
  <li><a href="/sc1/profile-debug/">Performance / Bugs</a></li>
  
  <li><a href="/sc1/matrices/">Matrices</a></li>
  
  <li><a href="/sc1/optimization/">Optimization</a></li>
  
  <li><a href="/sc1/integration/">Integration</a></li>
  
  
  </ul>
</nav>

    </header>

    <article class="main">
      <header class="title">
      
<h1>Data</h1>

<h3>
</h3>
<hr>


      </header>




<link href="/sc1/rmarkdown-libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="/sc1/rmarkdown-libs/anchor-sections/anchor-sections.js"></script>

<div id="TOC">
<ul>
<li><a href="#creating-synthetic-data">Creating synthetic data</a></li>
<li><a href="#creating-a-data-frame">Creating a data frame</a></li>
<li><a href="#saving-and-loading-csv-data">Saving and loading CSV data</a></li>
<li><a href="#saving-and-loading-in-rs-data-format">Saving and loading in R’s data format</a></li>
<li><a href="#performing-a-simple-linear-regression">Performing a simple linear regression</a></li>
</ul>
</div>

<p>This page introduces a few basics ways to deal with data in R.</p>
<div id="creating-synthetic-data" class="section level2">
<h2>Creating synthetic data</h2>
<p>R has many functions for simulating <a href="https://en.wikipedia.org/wiki/Random_variate">random variates</a> from common distributions, as well as evaluating their density / mass functions, distribution functions and quantile functions. For example, the Uniform(0,1) distribution is served by the functions</p>
<ul>
<li><code>runif(n)</code>: simulates <code>n</code> random variates,</li>
<li><code>dunif(x)</code>: evaluates the density at <code>x</code>,</li>
<li><code>punif(x)</code>: evaluates the distribution function at <code>x</code>,</li>
<li><code>qunif(u)</code>: evaluates the quantile function at <code>u</code>.</li>
</ul>
<p>Distributions supported in this way can be found by typing <code>?distributions</code> in the R console.</p>
<p>We can simulate 2 sets of 100 standard normal random variates as follows.</p>
<pre class="r"><code>n &lt;- 100
x1s &lt;- rnorm(n)
x2s &lt;- rnorm(n)</code></pre>
<p>Let us imagine that these are predictors in a linear regression model. We can simulate synthetic responses, and plot them alongside <code>x1s</code> and <code>x2s</code>.</p>
<pre class="r"><code>beta.true &lt;- c(3.2, 0.5, -0.2)
sigmaSq.true &lt;- 2
ys &lt;- beta.true[1] + beta.true[2]*x1s + beta.true[3]*x2s + rnorm(n, mean=0, sd=sqrt(sigmaSq.true))</code></pre>
<pre class="r"><code>plot(ys, pch=20, ylim=range(c(ys, x1s, x2s)))
points(x1s, pch=20, col=&quot;red&quot;)
points(x2s, pch=20, col=&quot;blue&quot;)</code></pre>
<p><img src="/sc1/intro-r/data_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
<div id="creating-a-data-frame" class="section level2">
<h2>Creating a data frame</h2>
<p>A fundamental data structure in R is the data frame. We can create a data frame to hold our synthetic data, and then print the first 10 elements.</p>
<pre class="r"><code>my.data &lt;- data.frame(x1=x1s, x2=x2s, y=ys)
head(my.data, 10)</code></pre>
<pre><code>##            x1         x2        y
## 1   0.5855288  0.2239254 1.416963
## 2   0.7094660 -1.1562233 2.896070
## 3  -0.1093033  0.4224185 3.405256
## 4  -0.4534972 -1.3247553 4.734953
## 5   0.6058875  0.1410843 4.650432
## 6  -1.8179560 -0.5360480 2.547024
## 7   0.6300986 -0.3116061 1.114216
## 8  -0.2761841  1.5561096 3.663203
## 9  -0.2841597 -0.4480333 3.284853
## 10 -0.9193220  0.3211235 2.567596</code></pre>
<p>Each row in a data frame corresponds to an observation of each the relevant variables, in this case an observation of <code>x1</code>, <code>x2</code> and <code>y</code>.</p>
</div>
<div id="saving-and-loading-csv-data" class="section level2">
<h2>Saving and loading CSV data</h2>
<p>A simple way to store small datasets is using a <a href="https://en.wikipedia.org/wiki/Comma-separated_values">comma-separated values</a> (CSV) format. In R, we can save our <code>my.data</code> dataset using the <code>write.csv</code> command.</p>
<pre class="r"><code>write.csv(my.data, file=&quot;synthetic-data.csv&quot;, row.names=FALSE)</code></pre>
<p>The filename is relative to the current working directory, which can be printed by using the <code>getwd</code> command.</p>
<pre class="r"><code>getwd()</code></pre>
<pre><code>## [1] &quot;/home/travis/build/awllee/sc1/content/intro-r&quot;</code></pre>
<p>To change the working directory, one can use the <code>setwd</code> command.</p>
<p>To load data from a CSV file, one can use the <code>read.csv</code> command.</p>
<pre class="r"><code>my.data &lt;- read.csv(file=&quot;synthetic-data.csv&quot;)
head(my.data)</code></pre>
<pre><code>##           x1         x2        y
## 1  0.5855288  0.2239254 1.416963
## 2  0.7094660 -1.1562233 2.896070
## 3 -0.1093033  0.4224185 3.405256
## 4 -0.4534972 -1.3247553 4.734953
## 5  0.6058875  0.1410843 4.650432
## 6 -1.8179560 -0.5360480 2.547024</code></pre>
<p>Using a CSV file has the benefit that the data is in a standard format that can be easily parsed in any programming language that can read from a text file. It can also be viewed in a text editor or spreadsheet program.</p>
</div>
<div id="saving-and-loading-in-rs-data-format" class="section level2">
<h2>Saving and loading in R’s data format</h2>
<p>R has support for saving and loading using an R-specific binary format. In combination with compression (the default), this can substantially reduce large file sizes and speed up the saving/loading process. R data files are usually given the “.Rdata” extension.</p>
<pre class="r"><code>save(my.data, file=&quot;synthetic-data.Rdata&quot;)</code></pre>
<p>Any variable or R function can be saved, and not just data frames. Multiple objects can be saved using a command such as</p>
<pre class="r"><code>save(object1, object2, object3, file=&quot;filename.Rdata&quot;)</code></pre>
<p>The <code>save.image</code> command saves all of the variables in the workspace.</p>
<p>Unlike <code>write.csv</code> and <code>read.csv</code>, the name of a saved variable is associated with the saved value. Loading the .Rdata file associates the same variable name to the same data.</p>
<pre class="r"><code>load(file=&quot;synthetic-data.Rdata&quot;)</code></pre>
</div>
<div id="performing-a-simple-linear-regression" class="section level2">
<h2>Performing a simple linear regression</h2>
<p>With our loaded <code>my.data</code>, we can use some of R’s built-in statistical methods to try to estimate a linear model for <code>y</code> given <code>x1</code> and <code>x2</code>.</p>
<pre class="r"><code>model &lt;- lm(y ~ x1 + x2, my.data)
summary(model)</code></pre>
<pre><code>## 
## Call:
## lm(formula = y ~ x1 + x2, data = my.data)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -2.9243 -0.8558  0.0671  0.9305  3.6348 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   3.1507     0.1353  23.288  &lt; 2e-16 ***
## x1            0.4641     0.1197   3.876 0.000193 ***
## x2           -0.3610     0.1320  -2.735 0.007408 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.321 on 97 degrees of freedom
## Multiple R-squared:  0.1746, Adjusted R-squared:  0.1576 
## F-statistic: 10.26 on 2 and 97 DF,  p-value: 9.069e-05</code></pre>
<p>The linear model says that data point <code>y[i]</code> is a realization of a normal random variable
<span class="math display">\[Y^{(i)} = \beta_0 + \beta_1 x_1^{(i)} + \beta_2 x_2^{(i)} + \sigma Z^{(i)},\]</span>
where <span class="math inline">\(Z^{(1)},\ldots,Z^{(n)}\)</span> is a sequence of independent standard normal random variables.</p>
<p>In particular, the intercept <span class="math inline">\(\beta_0\)</span> is included by default.</p>
<p>We can compare the “true” values of the coefficients with the fitted values.</p>
<pre class="r"><code>beta.true</code></pre>
<pre><code>## [1]  3.2  0.5 -0.2</code></pre>
<pre class="r"><code>model$coefficients</code></pre>
<pre><code>## (Intercept)          x1          x2 
##   3.1507283   0.4641199  -0.3610236</code></pre>
<p>We can similarly compare the “true” variance of the errors with the unbiased estimate.</p>
<pre class="r"><code>sigmaSq.true</code></pre>
<pre><code>## [1] 2</code></pre>
<pre class="r"><code>summary(model)$sigma^2</code></pre>
<pre><code>## [1] 1.744297</code></pre>
<div id="computing-the-estimates-directly" class="section level4">
<h4>Computing the estimates directly</h4>
<p>The estimates obtained in the linear regression example are not difficult to obtain: the <code>lm</code> function is useful because it can be used easily and has been tested extensively.</p>
<p>First we create the design matrix</p>
<pre class="r"><code>X &lt;- cbind(rep(1, n), my.data$x1, my.data$x2)</code></pre>
<p>We can check that this is the same as the design matrix used by <code>lm</code>, via the <code>model.matrix</code> function.</p>
<pre class="r"><code>all(X == model.matrix(model))</code></pre>
<pre><code>## [1] TRUE</code></pre>
<p>The maximum likelihood estimate of the coefficient vector <span class="math inline">\(\beta\)</span> is</p>
<p><span class="math display">\[\hat{\beta}_{\rm ML} = (X^{\rm T}X)^{-1}X^{\rm T}y,\]</span></p>
<p>which is straightforward to compute.</p>
<pre class="r"><code>beta.hat &lt;- solve(t(X)%*%X, t(X)%*%my.data$y)
beta.hat</code></pre>
<pre><code>##            [,1]
## [1,]  3.1507283
## [2,]  0.4641199
## [3,] -0.3610236</code></pre>
<p>A prediction of <span class="math inline">\(y\)</span> given <span class="math inline">\(x = (1,x_1,x_2)\)</span> is</p>
<p><span class="math display">\[f(x) := \hat{\beta}_0 + \hat{\beta}_1 x_1 + \hat{\beta}_2 x_2,\]</span></p>
<p>and the residual sum of squares is</p>
<p><span class="math display">\[{\rm RSS} = \sum_{i=1}^n (y^{(i)} - f(x^{(i)}))^2.\]</span></p>
<p>The maximum likelihood estimate of <span class="math inline">\(\sigma^2\)</span> is</p>
<p><span class="math display">\[\hat{\sigma}^2_{\rm ML} = \frac{1}{n} {\rm RSS},\]</span></p>
<p>The ML estimate <span class="math inline">\(\hat{\sigma}^2_{\rm ML}\)</span> is not what was reported above. Instead, what is reported by <code>summary(model)$sigma^2</code> is the unbiased estimate</p>
<p><span class="math display">\[\hat{\sigma}^2 = \frac{1}{n-3} {\rm RSS}.\]</span></p>
<pre class="r"><code>RSS &lt;- sum((my.data$y - X%*%beta.hat)^2)
sigmaSq.MLE &lt;- RSS / n
sigmaSq.hat &lt;- RSS / (n-3)

sigmaSq.MLE</code></pre>
<pre><code>## [1] 1.691969</code></pre>
<pre class="r"><code>sigmaSq.hat</code></pre>
<pre><code>## [1] 1.744297</code></pre>
<p>The estimator is unbiased because the distribution of <span class="math inline">\({\rm RSS}/\sigma^2\)</span> is <span class="math inline">\(\chi^2_{n-3}\)</span>.</p>
</div>
</div>


  <footer>
  

<script src="//yihui.name/js/math-code.js"></script>
<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<script async src="//yihui.name/js/center-img.js"></script>


<script type="text/javascript">
var sc_project=12110974;
var sc_invisible=1;
var sc_security="9b171880";
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="https://statcounter.com/" target="_blank"><img
class="statcounter"
src="https://c.statcounter.com/12110974/0/9b171880/1/"
alt="Web Analytics"></a></div></noscript>








  


<p align=right>

<a href='https://github.com/awllee/sc1/blob/master/content/intro-r/data.Rmd'>View source</a>

|

<a href='https://github.com/awllee/sc1/edit/master/content/intro-r/data.Rmd'>Edit source</a>

</p>





<script src="https://utteranc.es/client.js"
        repo="awllee/sc1"
        issue-term="pathname"
        label="utterance"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>



  



<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>



<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/tex.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



  
  <hr>
  <div class="copyright">© 2020 <a href="https://sites.google.com/view/anthonylee">Anthony Lee</a>, <a href="http://www.bristol.ac.uk/maths/people/feng-yu/index.html">Feng Yu</a>, <a href="https://people.maths.bris.ac.uk/~tk18582/">Tobias Kley</a>, <a href="https://mfasiolo.github.io/">Matteo Fasiolo</a></div>
  
  </footer>
  </article>
  
  </body>
</html>

